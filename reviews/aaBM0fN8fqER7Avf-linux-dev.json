{
  "thread_id": "aaBM0fN8fqER7Avf@linux.dev",
  "subject": "[PATCH] memcg: fix slab accounting in refill_obj_stock() trylock path",
  "url": "https://lore.kernel.org/all/aaBM0fN8fqER7Avf@linux.dev/",
  "dates": {
    "2026-02-26": {
      "report_file": "2026-02-26_ollama_llama3.1-8b.html",
      "developer": "Shakeel Butt",
      "reviews": [
        {
          "author": "Vlastimil Babka",
          "summary": "Raised questions about the user-visible impact of the bug, seeking clarification on how it affects system behavior.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "WAITING_FOR_REVIEW"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "On 2/26/26 14:39, Shakeel Butt wrote:\n> On Thu, Feb 26, 2026 at 07:51:37PM +0800, Hao Li wrote:\n>> In the trylock path of refill_obj_stock(), mod_objcg_mlstate() should\n>> use the real alloc/free bytes (i.e., nr_acct) for accounting, rather\n>> than nr_bytes.\n>> \n>> Fixes: 200577f69f29 (\"memcg: objcg stock trylock without irq disabling\")\n>> Cc: stable@vger.kernel.org\n>> Signed-off-by: Hao Li <hao.li@linux.dev>\n> \n> Thanks for the fix.\n> \n> Acked-by: Shakeel Butt <shakeel.butt@linux.dev>\n\nWhat are the user-visible effects of the bug?\n",
          "reply_to": "Shakeel Butt",
          "message_date": "2026-02-26",
          "message_id": ""
        },
        {
          "author": "Shakeel Butt",
          "summary": "Acknowledged the fix and applied it, indicating a positive sentiment towards the patch.",
          "sentiment": "positive",
          "sentiment_signals": [
            "LGTM"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Acked-by"
          ],
          "analysis_source": "llm",
          "raw_body": "",
          "reply_to": "Hao Li",
          "message_date": "",
          "message_id": ""
        }
      ],
      "analysis_source": "llm",
      "patch_summary": "Fixes a slab accounting bug in refill_obj_stock() trylock path, ensuring correct stats for NR_SLAB_RECLAIMABLE_B and NR_SLAB_UNRECLAIMABLE_B."
    },
    "2026-02-27": {
      "report_file": "2026-02-26_ollama_llama3.1-8b.html",
      "developer": "Shakeel Butt",
      "reviews": [
        {
          "author": "Hao Li",
          "summary": "Provided additional context and explanation of the bug's impact, clarifying that it affects slab accounting stats.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "WAITING_FOR_REVIEW"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "On Thu, Feb 26, 2026 at 02:44:02PM +0100, Vlastimil Babka wrote:\n> On 2/26/26 14:39, Shakeel Butt wrote:\n> > On Thu, Feb 26, 2026 at 07:51:37PM +0800, Hao Li wrote:\n> >> In the trylock path of refill_obj_stock(), mod_objcg_mlstate() should\n> >> use the real alloc/free bytes (i.e., nr_acct) for accounting, rather\n> >> than nr_bytes.\n> >> \n> >> Fixes: 200577f69f29 (\"memcg: objcg stock trylock without irq disabling\")\n> >> Cc: stable@vger.kernel.org\n> >> Signed-off-by: Hao Li <hao.li@linux.dev>\n> > \n> > Thanks for the fix.\n> > \n> > Acked-by: Shakeel Butt <shakeel.butt@linux.dev>\n> \n> What are the user-visible effects of the bug?\n\nThe user-visible impact is that the NR_SLAB_RECLAIMABLE_B and\nNR_SLAB_UNRECLAIMABLE_B stats can end up being incorrect.\n\nFor example, if a user allocates a 6144-byte object, then before this fix\nrefill_obj_stock() calls mod_objcg_mlstate(..., nr_bytes=2048), even though it\nshould account for 6144 bytes (i.e., nr_acct).\n\nWhen the user later frees the same object with kfree(), refill_obj_stock() calls\nmod_objcg_mlstate(..., nr_bytes=6144). This ends up adding 6144 to the stats,\nbut it should be applying -6144 (i.e., nr_acct) since the object is being\nfreed.\n\n-- \nThanks,\nHao\n\n",
          "reply_to": "",
          "message_date": "2026-02-27",
          "message_id": ""
        }
      ],
      "analysis_source": "llm",
      "patch_summary": "Fixes a slab accounting bug in refill_obj_stock() trylock path, ensuring correct stats for NR_SLAB_RECLAIMABLE_B and NR_SLAB_UNRECLAIMABLE_B."
    }
  }
}
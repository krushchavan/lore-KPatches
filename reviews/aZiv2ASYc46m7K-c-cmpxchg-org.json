{
  "thread_id": "aZiv2ASYc46m7K_c@cmpxchg.org",
  "subject": "Re: [PATCH v5] mm: move pgscan, pgsteal, pgrefill to node stats",
  "url": "https://lore.kernel.org/all/aZiv2ASYc46m7K_c@cmpxchg.org/",
  "dates": {
    "2026-02-20": {
      "report_file": "2026-02-20_ollama_llama3.1-8b.html",
      "developer": "Johannes Weiner",
      "reviews": [
        {
          "author": "Johannes Weiner",
          "summary": "Gave Acked-by",
          "sentiment": "positive",
          "sentiment_signals": [],
          "has_inline_review": false,
          "tags_given": [
            "Acked-by"
          ],
          "analysis_source": "llm",
          "raw_body": "On Thu, Feb 19, 2026 at 03:58:46PM -0800, JP Kobryn (Meta) wrote:\n> There are situations where reclaim kicks in on a system with free memory.\n> One possible cause is a NUMA imbalance scenario where one or more nodes are\n> under pressure. It would help if we could easily identify such nodes.\n> \n> Move the pgscan, pgsteal, and pgrefill counters from vm_event_item to\n> node_stat_item to provide per-node reclaim visibility. With these counters\n> as node stats, the values are now displayed in the per-node section of\n> /proc/zoneinfo, which allows for quick identification of the affected\n> nodes.\n> \n> /proc/vmstat continues to report the same counters, aggregated across all\n> nodes. But the ordering of these items within the readout changes as they\n> move from the vm events section to the node stats section.\n> \n> Memcg accounting of these counters is preserved. The relocated counters\n> remain visible in memory.stat alongside the existing aggregate pgscan and\n> pgsteal counters.\n> \n> However, this change affects how the global counters are accumulated.\n> Previously, the global event count update was gated on !cgroup_reclaim(),\n> excluding memcg-based reclaim from /proc/vmstat. Now that\n> mod_lruvec_state() is being used to update the counters, the global\n> counters will include all reclaim. This is consistent with how pgdemote\n> counters are already tracked.\n> \n> Finally, the virtio_balloon driver is updated to use\n> global_node_page_state() to fetch the counters, as they are no longer\n> accessible through the vm_events array.\n> \n> Signed-off-by: JP Kobryn <jp.kobryn@linux.dev>\n> Suggested-by: Johannes Weiner <hannes@cmpxchg.org>\n> Acked-by: Michael S. Tsirkin <mst@redhat.com>\n> Reviewed-by: Vlastimil Babka (SUSE) <vbabka@kernel.org>\n\nAcked-by: Johannes Weiner <hannes@cmpxchg.org>\n",
          "reply_to": "JP (Meta)",
          "message_date": "2026-02-20"
        },
        {
          "author": "Shakeel Butt",
          "summary": "Shakeel Butt acknowledged the patch, but expressed confusion about a specific change in how global counters are accumulated.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "confusion"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Acked-by"
          ],
          "analysis_source": "llm",
          "raw_body": "On Thu, Feb 19, 2026 at 03:58:46PM -0800, JP Kobryn (Meta) wrote:\n> There are situations where reclaim kicks in on a system with free memory.\n> One possible cause is a NUMA imbalance scenario where one or more nodes are\n> under pressure. It would help if we could easily identify such nodes.\n> \n> Move the pgscan, pgsteal, and pgrefill counters from vm_event_item to\n> node_stat_item to provide per-node reclaim visibility. With these counters\n> as node stats, the values are now displayed in the per-node section of\n> /proc/zoneinfo, which allows for quick identification of the affected\n> nodes.\n> \n> /proc/vmstat continues to report the same counters, aggregated across all\n> nodes. But the ordering of these items within the readout changes as they\n> move from the vm events section to the node stats section.\n> \n> Memcg accounting of these counters is preserved. The relocated counters\n> remain visible in memory.stat alongside the existing aggregate pgscan and\n> pgsteal counters.\n> \n> However, this change affects how the global counters are accumulated.\n> Previously, the global event count update was gated on !cgroup_reclaim(),\n> excluding memcg-based reclaim from /proc/vmstat. Now that\n> mod_lruvec_state() is being used to update the counters, the global\n> counters will include all reclaim. This is consistent with how pgdemote\n> counters are already tracked.\n\nYeah this difference always confused me.\n\n> \n> Finally, the virtio_balloon driver is updated to use\n> global_node_page_state() to fetch the counters, as they are no longer\n> accessible through the vm_events array.\n> \n> Signed-off-by: JP Kobryn <jp.kobryn@linux.dev>\n> Suggested-by: Johannes Weiner <hannes@cmpxchg.org>\n> Acked-by: Michael S. Tsirkin <mst@redhat.com>\n> Reviewed-by: Vlastimil Babka (SUSE) <vbabka@kernel.org>\n\nAcked-by: Shakeel Butt <shakeel.butt@linux.dev>\n\n",
          "reply_to": "JP (Meta)",
          "message_date": "2026-02-20"
        }
      ],
      "analysis_source": "llm"
    },
    "2026-02-19": {
      "report_file": "2026-02-20_ollama_llama3.1-8b.html",
      "developer": "Johannes Weiner",
      "reviews": [
        {
          "author": "Zi Yan",
          "summary": "Zi Yan approved the patch but requested that the commit message be updated to include a clear explanation of why this change was made.",
          "sentiment": "positive",
          "sentiment_signals": [
            "Acked-by"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "On 19 Feb 2026, at 18:58, JP Kobryn (Meta) wrote:\n\n> There are situations where reclaim kicks in on a system with free memory.\n> One possible cause is a NUMA imbalance scenario where one or more nodes are\n> under pressure. It would help if we could easily identify such nodes.\n>\n> Move the pgscan, pgsteal, and pgrefill counters from vm_event_item to\n> node_stat_item to provide per-node reclaim visibility. With these counters\n> as node stats, the values are now displayed in the per-node section of\n> /proc/zoneinfo, which allows for quick identification of the affected\n> nodes.\n>\n> /proc/vmstat continues to report the same counters, aggregated across all\n> nodes. But the ordering of these items within the readout changes as they\n> move from the vm events section to the node stats section.\n>\n> Memcg accounting of these counters is preserved. The relocated counters\n> remain visible in memory.stat alongside the existing aggregate pgscan and\n> pgsteal counters.\n>\n> However, this change affects how the global counters are accumulated.\n> Previously, the global event count update was gated on !cgroup_reclaim(),\n> excluding memcg-based reclaim from /proc/vmstat. Now that\n> mod_lruvec_state() is being used to update the counters, the global\n> counters will include all reclaim. This is consistent with how pgdemote\n> counters are already tracked.\n>\n> Finally, the virtio_balloon driver is updated to use\n> global_node_page_state() to fetch the counters, as they are no longer\n> accessible through the vm_events array.\n>\n> Signed-off-by: JP Kobryn <jp.kobryn@linux.dev>\n> Suggested-by: Johannes Weiner <hannes@cmpxchg.org>\n> Acked-by: Michael S. Tsirkin <mst@redhat.com>\n> Reviewed-by: Vlastimil Babka (SUSE) <vbabka@kernel.org>\n> ---\n> v5:\n> \t- rebase onto mm/mm-new\n>\n> v4: https://lore.kernel.org/linux-mm/20260219171124.19053-1-jp.kobryn@linux.dev/\n> \t- remove unused memcg var from scan_folios()\n>\n> v3: https://lore.kernel.org/linux-mm/20260218222652.108411-1-jp.kobryn@linux.dev/\n> \t- additionally move PGREFILL to node stats\n>\n> v2: https://lore.kernel.org/linux-mm/20260218032941.225439-1-jp.kobryn@linux.dev/\n> \t- update commit message\n> \t- add entries to memory_stats array\n> \t- add switch cases in memcg_page_state_output_unit()\n>\n> v1: https://lore.kernel.org/linux-mm/20260212045109.255391-3-inwardvessel@gmail.com/\n>\n>  drivers/virtio/virtio_balloon.c |  8 ++---\n>  include/linux/mmzone.h          | 13 ++++++++\n>  include/linux/vm_event_item.h   | 13 --------\n>  mm/memcontrol.c                 | 56 +++++++++++++++++++++++----------\n>  mm/vmscan.c                     | 39 ++++++++---------------\n>  mm/vmstat.c                     | 26 +++++++--------\n>  6 files changed, 82 insertions(+), 73 deletions(-)\n>\n\nAcked-by: Zi Yan <ziy@nvidia.com>\n\nBest Regards,\nYan, Zi\n",
          "reply_to": "JP (Meta)",
          "message_date": "2026-02-19"
        }
      ],
      "analysis_source": "llm"
    }
  }
}
{
  "thread_id": "20260211215447.2194189-1-gourry@gourry.net",
  "subject": "[PATCH] mm: name the anonymous MMOP enum as enum mmop",
  "url": "https://lore.kernel.org/all/20260211215447.2194189-1-gourry@gourry.net/",
  "dates": {
    "2026-02-19": {
      "report_file": "2026-02-19_ollama_llama3.1-8b.html",
      "developer": "Gregory Price",
      "reviews": [
        {
          "author": "Cheatham, Benjamin",
          "summary": "Reviewer Cheatham approved the patch and mentioned that he had previously suggested a similar change, but this time it was cleaned up.",
          "sentiment": "positive",
          "sentiment_signals": [
            "Requested changes were minor",
            "Reviewer appreciated the cleanup"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "On 2/11/2026 3:54 PM, Gregory Price wrote:\n> Give the MMOP enum (MMOP_OFFLINE, MMOP_ONLINE, etc) a proper type\n> name so the compiler can help catch invalid values being assigned to\n> variables of this type.\n> \n> Leave the existing functions returning int alone to allow for\n> value-or-error pattern to remain unchanged without churn.\n> \n> mmop_default_online_type is left as int because it uses the -1\n> sentinal value to signal it hasn't been initialized yet.\n> \n> Keep the uint8_t buffer in offline_and_remove_memory() as-is for\n> space efficiency, with an explicit cast when we consume the value.\n> \n> Move the enum definition before the CONFIG_MEMORY_HOTPLUG guard so\n> it is unconditionally available for struct memory_block in memory.h.\n> \n> No functional change.\n> \n> Link: https://lore.kernel.org/linux-mm/3424eba7-523b-4351-abd0-3a888a3e5e61@kernel.org/\n> Suggested-by: Jonathan Cameron <jonathan.cameron@huawei.com>\n> Suggested-by: \"David Hildenbrand (arm)\" <david@kernel.org>\n> Signed-off-by: Gregory Price <gourry@gourry.net>\n> ---\n\nI saw this when reviewing another set of yours and thought about mentioning it, glad you cleaned it up!\n\nOne small nit below, otherwise:\nReviewed-by: Ben Cheatham <benjamin.cheatham@amd.com>\n\n>  drivers/base/memory.c          |  2 +-\n>  include/linux/memory.h         |  3 ++-\n>  include/linux/memory_hotplug.h | 16 ++++++++--------\n>  mm/memory_hotplug.c            | 10 +++++-----\n>  4 files changed, 16 insertions(+), 15 deletions(-)\n> \n> diff --git a/drivers/base/memory.c b/drivers/base/memory.c\n> index 751f248ca4a8..3753ca80069d 100644\n> --- a/drivers/base/memory.c\n> +++ b/drivers/base/memory.c\n> @@ -452,7 +452,7 @@ static ssize_t phys_device_show(struct device *dev,\n>  static int print_allowed_zone(char *buf, int len, int nid,\n>  \t\t\t      struct memory_group *group,\n>  \t\t\t      unsigned long start_pfn, unsigned long nr_pages,\n> -\t\t\t      int online_type, struct zone *default_zone)\n> +\t\t\t      enum mmop online_type, struct zone *default_zone)\n>  {\n>  \tstruct zone *zone;\n>  \n> diff --git a/include/linux/memory.h b/include/linux/memory.h\n> index faeaa921e55b..5bb5599c6b2b 100644\n> --- a/include/linux/memory.h\n> +++ b/include/linux/memory.h\n> @@ -19,6 +19,7 @@\n>  #include <linux/node.h>\n>  #include <linux/compiler.h>\n>  #include <linux/mutex.h>\n> +#include <linux/memory_hotplug.h>\n>  \n>  #define MIN_MEMORY_BLOCK_SIZE     (1UL << SECTION_SIZE_BITS)\n>  \n> @@ -77,7 +78,7 @@ enum memory_block_state {\n>  struct memory_block {\n>  \tunsigned long start_section_nr;\n>  \tenum memory_block_state state;\t/* serialized by the dev->lock */\n> -\tint online_type;\t\t/* for passing data to online routine */\n> +\tenum mmop online_type;\t/* for passing data to online routine */\n\nComment looks unaligned.\n\nThanks,\nBen\n",
          "reply_to": ""
        },
        {
          "author": "David (Arm)",
          "summary": "Gave Acked-by",
          "sentiment": "positive",
          "sentiment_signals": [],
          "has_inline_review": false,
          "tags_given": [
            "Acked-by"
          ],
          "analysis_source": "llm",
          "raw_body": "On 2/11/26 22:54, Gregory Price wrote:\n> Give the MMOP enum (MMOP_OFFLINE, MMOP_ONLINE, etc) a proper type\n> name so the compiler can help catch invalid values being assigned to\n> variables of this type.\n> \n> Leave the existing functions returning int alone to allow for\n> value-or-error pattern to remain unchanged without churn.\n> \n> mmop_default_online_type is left as int because it uses the -1\n> sentinal value to signal it hasn't been initialized yet.\n> \n> Keep the uint8_t buffer in offline_and_remove_memory() as-is for\n> space efficiency, with an explicit cast when we consume the value.\n> \n> Move the enum definition before the CONFIG_MEMORY_HOTPLUG guard so\n> it is unconditionally available for struct memory_block in memory.h.\n> \n> No functional change.\n> \n> Link: https://lore.kernel.org/linux-mm/3424eba7-523b-4351-abd0-3a888a3e5e61@kernel.org/\n> Suggested-by: Jonathan Cameron <jonathan.cameron@huawei.com>\n> Suggested-by: \"David Hildenbrand (arm)\" <david@kernel.org>\n> Signed-off-by: Gregory Price <gourry@gourry.net>\n> ---\n\nAcked-by: David Hildenbrand (Arm) <david@kernel.org>\n\n-- \nCheers,\n\nDavid\n",
          "reply_to": ""
        },
        {
          "author": "Dave Jiang",
          "summary": "Gave Reviewed-by",
          "sentiment": "positive",
          "sentiment_signals": [],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "\n\nOn 2/11/26 2:54 PM, Gregory Price wrote:\n> Give the MMOP enum (MMOP_OFFLINE, MMOP_ONLINE, etc) a proper type\n> name so the compiler can help catch invalid values being assigned to\n> variables of this type.\n> \n> Leave the existing functions returning int alone to allow for\n> value-or-error pattern to remain unchanged without churn.\n> \n> mmop_default_online_type is left as int because it uses the -1\n> sentinal value to signal it hasn't been initialized yet.\n> \n> Keep the uint8_t buffer in offline_and_remove_memory() as-is for\n> space efficiency, with an explicit cast when we consume the value.\n> \n> Move the enum definition before the CONFIG_MEMORY_HOTPLUG guard so\n> it is unconditionally available for struct memory_block in memory.h.\n> \n> No functional change.\n> \n> Link: https://lore.kernel.org/linux-mm/3424eba7-523b-4351-abd0-3a888a3e5e61@kernel.org/\n> Suggested-by: Jonathan Cameron <jonathan.cameron@huawei.com>\n> Suggested-by: \"David Hildenbrand (arm)\" <david@kernel.org>\n> Signed-off-by: Gregory Price <gourry@gourry.net>\n\nReviewed-by: Dave Jiang <dave.jiang@intel.com>\n\n> ---\n>  drivers/base/memory.c          |  2 +-\n>  include/linux/memory.h         |  3 ++-\n>  include/linux/memory_hotplug.h | 16 ++++++++--------\n>  mm/memory_hotplug.c            | 10 +++++-----\n>  4 files changed, 16 insertions(+), 15 deletions(-)\n> \n> diff --git a/drivers/base/memory.c b/drivers/base/memory.c\n> index 751f248ca4a8..3753ca80069d 100644\n> --- a/drivers/base/memory.c\n> +++ b/drivers/base/memory.c\n> @@ -452,7 +452,7 @@ static ssize_t phys_device_show(struct device *dev,\n>  static int print_allowed_zone(char *buf, int len, int nid,\n>  \t\t\t      struct memory_group *group,\n>  \t\t\t      unsigned long start_pfn, unsigned long nr_pages,\n> -\t\t\t      int online_type, struct zone *default_zone)\n> +\t\t\t      enum mmop online_type, struct zone *default_zone)\n>  {\n>  \tstruct zone *zone;\n>  \n> diff --git a/include/linux/memory.h b/include/linux/memory.h\n> index faeaa921e55b..5bb5599c6b2b 100644\n> --- a/include/linux/memory.h\n> +++ b/include/linux/memory.h\n> @@ -19,6 +19,7 @@\n>  #include <linux/node.h>\n>  #include <linux/compiler.h>\n>  #include <linux/mutex.h>\n> +#include <linux/memory_hotplug.h>\n>  \n>  #define MIN_MEMORY_BLOCK_SIZE     (1UL << SECTION_SIZE_BITS)\n>  \n> @@ -77,7 +78,7 @@ enum memory_block_state {\n>  struct memory_block {\n>  \tunsigned long start_section_nr;\n>  \tenum memory_block_state state;\t/* serialized by the dev->lock */\n> -\tint online_type;\t\t/* for passing data to online routine */\n> +\tenum mmop online_type;\t/* for passing data to online routine */\n>  \tint nid;\t\t\t/* NID for this memory block */\n>  \t/*\n>  \t * The single zone of this memory block if all PFNs of this memory block\n> diff --git a/include/linux/memory_hotplug.h b/include/linux/memory_hotplug.h\n> index f2f16cdd73ee..e77ef3d7ff73 100644\n> --- a/include/linux/memory_hotplug.h\n> +++ b/include/linux/memory_hotplug.h\n> @@ -16,11 +16,8 @@ struct resource;\n>  struct vmem_altmap;\n>  struct dev_pagemap;\n>  \n> -#ifdef CONFIG_MEMORY_HOTPLUG\n> -struct page *pfn_to_online_page(unsigned long pfn);\n> -\n>  /* Types for control the zone type of onlined and offlined memory */\n> -enum {\n> +enum mmop {\n>  \t/* Offline the memory. */\n>  \tMMOP_OFFLINE = 0,\n>  \t/* Online the memory. Zone depends, see default_zone_for_pfn(). */\n> @@ -31,6 +28,9 @@ enum {\n>  \tMMOP_ONLINE_MOVABLE,\n>  };\n>  \n> +#ifdef CONFIG_MEMORY_HOTPLUG\n> +struct page *pfn_to_online_page(unsigned long pfn);\n> +\n>  /* Flags for add_memory() and friends to specify memory hotplug details. */\n>  typedef int __bitwise mhp_t;\n>  \n> @@ -286,8 +286,8 @@ static inline void __remove_memory(u64 start, u64 size) {}\n>  \n>  #ifdef CONFIG_MEMORY_HOTPLUG\n>  /* Default online_type (MMOP_*) when new memory blocks are added. */\n> -extern int mhp_get_default_online_type(void);\n> -extern void mhp_set_default_online_type(int online_type);\n> +extern enum mmop mhp_get_default_online_type(void);\n> +extern void mhp_set_default_online_type(enum mmop online_type);\n>  extern void __ref free_area_init_core_hotplug(struct pglist_data *pgdat);\n>  extern int __add_memory(int nid, u64 start, u64 size, mhp_t mhp_flags);\n>  extern int add_memory(int nid, u64 start, u64 size, mhp_t mhp_flags);\n> @@ -310,8 +310,8 @@ extern void sparse_remove_section(unsigned long pfn, unsigned long nr_pages,\n>  \t\t\t\t  struct vmem_altmap *altmap);\n>  extern struct page *sparse_decode_mem_map(unsigned long coded_mem_map,\n>  \t\t\t\t\t  unsigned long pnum);\n> -extern struct zone *zone_for_pfn_range(int online_type, int nid,\n> -\t\tstruct memory_group *group, unsigned long start_pfn,\n> +extern struct zone *zone_for_pfn_range(enum mmop online_type,\n> +\t\tint nid, struct memory_group *group, unsigned long start_pfn,\n>  \t\tunsigned long nr_pages);\n>  extern int arch_create_linear_mapping(int nid, u64 start, u64 size,\n>  \t\t\t\t      struct mhp_params *params);\n> diff --git a/mm/memory_hotplug.c b/mm/memory_hotplug.c\n> index a63ec679d861..41f48f493b8e 100644\n> --- a/mm/memory_hotplug.c\n> +++ b/mm/memory_hotplug.c\n> @@ -221,7 +221,7 @@ void put_online_mems(void)\n>  bool movable_node_enabled = false;\n>  \n>  static int mhp_default_online_type = -1;\n> -int mhp_get_default_online_type(void)\n> +enum mmop mhp_get_default_online_type(void)\n>  {\n>  \tif (mhp_default_online_type >= 0)\n>  \t\treturn mhp_default_online_type;\n> @@ -240,7 +240,7 @@ int mhp_get_default_online_type(void)\n>  \treturn mhp_default_online_type;\n>  }\n>  \n> -void mhp_set_default_online_type(int online_type)\n> +void mhp_set_default_online_type(enum mmop online_type)\n>  {\n>  \tmhp_default_online_type = online_type;\n>  }\n> @@ -1046,7 +1046,7 @@ static inline struct zone *default_zone_for_pfn(int nid, unsigned long start_pfn\n>  \treturn movable_node_enabled ? movable_zone : kernel_zone;\n>  }\n>  \n> -struct zone *zone_for_pfn_range(int online_type, int nid,\n> +struct zone *zone_for_pfn_range(enum mmop online_type, int nid,\n>  \t\tstruct memory_group *group, unsigned long start_pfn,\n>  \t\tunsigned long nr_pages)\n>  {\n> @@ -2305,7 +2305,7 @@ EXPORT_SYMBOL_GPL(remove_memory);\n>  \n>  static int try_offline_memory_block(struct memory_block *mem, void *arg)\n>  {\n> -\tuint8_t online_type = MMOP_ONLINE_KERNEL;\n> +\tenum mmop online_type = MMOP_ONLINE_KERNEL;\n>  \tuint8_t **online_types = arg;\n>  \tstruct page *page;\n>  \tint rc;\n> @@ -2338,7 +2338,7 @@ static int try_reonline_memory_block(struct memory_block *mem, void *arg)\n>  \tint rc;\n>  \n>  \tif (**online_types != MMOP_OFFLINE) {\n> -\t\tmem->online_type = **online_types;\n> +\t\tmem->online_type = (enum mmop)**online_types;\n>  \t\trc = device_online(&mem->dev);\n>  \t\tif (rc < 0)\n>  \t\t\tpr_warn(\"%s: Failed to re-online memory: %d\",\n\n",
          "reply_to": ""
        },
        {
          "author": "Gregory Price (author)",
          "summary": "Reviewer Gregory Price approved the patch, but suggested it might not be worth a full version 2 unless Andrew prefers it.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "approval",
            "suggestion for improvement"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "On Wed, Feb 11, 2026 at 04:18:45PM -0600, Cheatham, Benjamin wrote:\n> On 2/11/2026 3:54 PM, Gregory Price wrote:\n> >  \n> > @@ -77,7 +78,7 @@ enum memory_block_state {\n> >  struct memory_block {\n> >  \tunsigned long start_section_nr;\n> >  \tenum memory_block_state state;\t/* serialized by the dev->lock */\n> > -\tint online_type;\t\t/* for passing data to online routine */\n> > +\tenum mmop online_type;\t/* for passing data to online routine */\n> \n> Comment looks unaligned.\n> \n\nAh yeah was already unaligned. Bleh.\n\nProbably not worth a full v2 unless Andrew prefers that.\n\n~Gregory\n",
          "reply_to": ""
        },
        {
          "author": "Davidlohr Bueso",
          "summary": "Gave Reviewed-by",
          "sentiment": "positive",
          "sentiment_signals": [],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "On Wed, 11 Feb 2026, Gregory Price wrote:\n\n>Give the MMOP enum (MMOP_OFFLINE, MMOP_ONLINE, etc) a proper type\n>name so the compiler can help catch invalid values being assigned to\n>variables of this type.\n>\n>Leave the existing functions returning int alone to allow for\n>value-or-error pattern to remain unchanged without churn.\n>\n>mmop_default_online_type is left as int because it uses the -1\n>sentinal value to signal it hasn't been initialized yet.\n>\n>Keep the uint8_t buffer in offline_and_remove_memory() as-is for\n>space efficiency, with an explicit cast when we consume the value.\n>\n>Move the enum definition before the CONFIG_MEMORY_HOTPLUG guard so\n>it is unconditionally available for struct memory_block in memory.h.\n>\n>No functional change.\n\nReviewed-by: Davidlohr Bueso <dave@stgolabs.net>\n",
          "reply_to": ""
        },
        {
          "author": "Jonathan Cameron",
          "summary": "Reviewer Jonathan Cameron approved the patch, providing a Reviewed-by tag and expressing gratitude for the cleanup.",
          "sentiment": "positive",
          "sentiment_signals": [
            "approval",
            "gratitude"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "On Wed, 11 Feb 2026 16:54:47 -0500\nGregory Price <gourry@gourry.net> wrote:\n\n> Give the MMOP enum (MMOP_OFFLINE, MMOP_ONLINE, etc) a proper type\n> name so the compiler can help catch invalid values being assigned to\n> variables of this type.\n> \n> Leave the existing functions returning int alone to allow for\n> value-or-error pattern to remain unchanged without churn.\n> \n> mmop_default_online_type is left as int because it uses the -1\n> sentinal value to signal it hasn't been initialized yet.\n> \n> Keep the uint8_t buffer in offline_and_remove_memory() as-is for\n> space efficiency, with an explicit cast when we consume the value.\n> \n> Move the enum definition before the CONFIG_MEMORY_HOTPLUG guard so\n> it is unconditionally available for struct memory_block in memory.h.\n> \n> No functional change.\n> \n> Link: https://lore.kernel.org/linux-mm/3424eba7-523b-4351-abd0-3a888a3e5e61@kernel.org/\n> Suggested-by: Jonathan Cameron <jonathan.cameron@huawei.com>\n> Suggested-by: \"David Hildenbrand (arm)\" <david@kernel.org>\n> Signed-off-by: Gregory Price <gourry@gourry.net>\nReviewed-by: Jonathan Cameron <jonathan.cameron@huawei.com>\n\nThanks for cleaning this up!\n\nJ\n\n\n",
          "reply_to": ""
        }
      ],
      "analysis_source": "llm",
      "patch_summary": "This patch renames the anonymous MMOP enum to a properly named enum mmop, allowing the compiler to catch invalid values being assigned to variables of this type. The existing functions returning int are left unchanged to preserve the value-or-error pattern. The enum definition is moved before the CONFIG_MEMORY_HOTPLUG guard for better code organization and to make it unconditionally available for struct memory_block in memory.h. This patch does not introduce any functional changes."
    }
  }
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Review Comments: [PATCH v1 0/3] cxl region changes for Type2 support</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                         "Helvetica Neue", Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        .home-link { margin-bottom: 12px; display: block; }
        .home-link a { color: #0366d6; text-decoration: none; font-size: 0.9em; }
        .home-link a:hover { text-decoration: underline; }

        h1 { font-size: 1.3em; margin-bottom: 2px; color: #1a1a1a; line-height: 1.3; }

        .lore-link { font-size: 0.85em; margin: 4px 0 6px; display: block; }
        .lore-link a { color: #0366d6; text-decoration: none; }
        .lore-link a:hover { text-decoration: underline; }

        .date-range {
            font-size: 0.8em;
            color: #888;
            margin-bottom: 16px;
        }
        .date-range a { color: #0366d6; text-decoration: none; }
        .date-range a:hover { text-decoration: underline; }

        /* thread-node scroll margin so the card isn't clipped at the top */
        .thread-node { scroll-margin-top: 8px; }

        /* ── Patch summary ──────────────────────────────────────────── */
        .patch-summary-block {
            background: #fff;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border-left: 3px solid #4a90d9;
        }
        .patch-summary-label {
            font-size: 0.72em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: #4a90d9;
            margin-bottom: 4px;
        }
        .patch-summary-text {
            font-size: 0.88em;
            color: #444;
            line-height: 1.55;
        }

        /* ── Thread tree ────────────────────────────────────────────── */
        .thread-tree {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        /* Depth indentation via left border */
        .thread-node { position: relative; }
        .thread-children {
            margin-left: 20px;
            padding-left: 12px;
            border-left: 2px solid #e0e0e0;
            margin-top: 6px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        /* ── Review comment card ────────────────────────────────────── */
        .review-comment {
            background: #fff;
            border-radius: 6px;
            padding: 10px 14px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            font-size: 0.88em;
        }
        .review-comment-header {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 6px;
            margin-bottom: 5px;
        }
        .review-author {
            font-weight: 700;
            color: #1a1a1a;
            font-size: 0.95em;
        }

        /* Date chip — links back to the daily report */
        .date-chip {
            font-size: 0.75em;
            color: #777;
            background: #f0f0f0;
            border-radius: 10px;
            padding: 1px 7px;
            text-decoration: none;
            white-space: nowrap;
        }
        a.date-chip:hover { background: #e0e8f5; color: #0366d6; }

        .badge {
            display: inline-block;
            padding: 1px 8px;
            border-radius: 10px;
            font-size: 0.75em;
            font-weight: 600;
        }
        .inline-review-badge {
            display: inline-block;
            padding: 0 6px;
            border-radius: 8px;
            font-size: 0.78em;
            font-weight: 500;
            background: #e3f2fd;
            color: #1565c0;
        }
        .review-tag-badge {
            display: inline-block;
            padding: 0 6px;
            border-radius: 8px;
            font-size: 0.78em;
            font-weight: 500;
            background: #e8f5e9;
            color: #2e7d32;
        }
        .analysis-source-badge {
            display: inline-block;
            padding: 1px 7px;
            border-radius: 10px;
            font-size: 0.72em;
            font-weight: 600;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .review-comment-text {
            color: #444;
            line-height: 1.55;
            margin-bottom: 4px;
        }
        .review-comment-signals {
            margin-top: 3px;
            font-size: 0.85em;
            color: #aaa;
            font-style: italic;
        }

        /* ── Collapsible raw body ───────────────────────────────────── */
        .raw-body-toggle {
            margin-top: 5px;
            font-size: 0.85em;
        }
        .raw-body-toggle summary {
            cursor: pointer;
            color: #888;
            padding: 2px 0;
            font-weight: 500;
            font-size: 0.9em;
            list-style: none;
        }
        .raw-body-toggle summary::-webkit-details-marker { display: none; }
        .raw-body-toggle summary::before { content: "▶ "; font-size: 0.7em; }
        .raw-body-toggle[open] summary::before { content: "▼ "; }
        .raw-body-toggle summary:hover { color: #555; }
        .raw-body-text {
            white-space: pre-wrap;
            font-size: 0.95em;
            background: #f8f8f8;
            padding: 8px 10px;
            border-radius: 4px;
            max-height: 360px;
            overflow-y: auto;
            margin-top: 4px;
            line-height: 1.5;
            color: #444;
            border: 1px solid #e8e8e8;
        }
        .reply-to-label {
            font-size: 0.8em;
            color: #999;
            font-style: italic;
            margin-top: 3px;
        }
        .lore-link {
            display: inline-block;
            margin-top: 4px;
            font-size: 0.82em;
            color: #0366d6;
            text-decoration: none;
            font-weight: 500;
            white-space: nowrap;
        }
        .lore-link:hover { text-decoration: underline; color: #0056b3; }

        .no-reviews {
            color: #aaa;
            font-size: 0.85em;
            font-style: italic;
            padding: 8px 0;
        }

        footer {
            text-align: center;
            color: #bbb;
            font-size: 0.78em;
            margin-top: 36px;
            padding: 16px;
        }
    </style>
</head>
<body>
    <div class="home-link"><a href="../index.html">&larr; Back to reports</a></div>
    <h1>[PATCH v1 0/3] cxl region changes for Type2 support</h1>
    <div class="lore-link"><a href="https://lore.kernel.org/all/aZ3MoKZgs26C2PrZ@gourry-fedora-PF4VCD3F/" target="_blank">View on lore.kernel.org &rarr;</a></div>
    <div class="date-range">Active on: <a href="#2026-02-24">2026-02-24</a></div>
    
    <div class="thread-tree">
<div class="thread-node depth-0" id="2026-02-24">
<div class="review-comment">
<div class="review-comment-header">
<span class="review-author">alejandro.lucero-palau (author)</span>
<a class="date-chip" href="../2026-02-24_ollama_llama3.1-8b.html" title="First appeared in report for 2026-02-24">2026-02-24</a>
<span class="badge" style="color:#856404;background:#fff3cd">Needs Work</span>
<span class="analysis-source-badge" style="color:#004085;background:#cce5ff" title="Analysis source: LLM">LLM</span>
</div>
<div class="review-comment-text">The author is addressing a concern about the need to specify the target_type parameter in the __create_region function, which was previously missing for Type2 devices. The author agrees that this change is necessary and will be included in the next version of the patch.</div>
<details class="raw-body-toggle">
<summary>Show original comment</summary>
<pre class="raw-body-text">From: Alejandro Lucero &lt;alucerop@amd.com&gt;

In preparation for Type2 devices/drivers support, these next patches
adapt the cxl region code for required Type2 functionality preserving
current functionality.

Alejandro Lucero (3):
  cxl: Make region type based on endpoint type
  cxl/region: Factor out interleave ways setup
  cxl/region: Factor out interleave granularity setup

 drivers/cxl/core/region.c | 87 +++++++++++++++++++++++++--------------
 1 file changed, 56 insertions(+), 31 deletions(-)


base-commit: 6de23f81a5e08be8fbf5e8d7e9febc72a5b5f27f
-- 
2.34.1</pre>
</details>
<div class="review-comment-signals">Signals: acknowledged fix needed, agreed to restructure</div>
</div>
<div class="thread-children">
<div class="thread-node depth-1">
<div class="review-comment">
<div class="review-comment-header">
<span class="review-author">Dave Jiang</span>
<a class="date-chip" href="../2026-02-24_ollama_llama3.1-8b.html" title="First appeared in report for 2026-02-24">2026-02-24</a>
<span class="review-tag-badge">Reviewed-by</span>
<span class="badge" style="color:#383d41;background:#e2e3e5">Neutral</span>
<span class="analysis-source-badge" style="color:#004085;background:#cce5ff" title="Analysis source: LLM">LLM</span>
</div>
<div class="review-comment-text">Reviewer Dave Jiang questioned whether the patch set is dependent on a separate preparation set, requesting clarification on their relationship.</div>
<details class="raw-body-toggle">
<summary>Show original comment</summary>
<pre class="raw-body-text">Does this set depends on the preparation set [1] or is independent?

[1]: https://lore.kernel.org/linux-cxl/20260223142633.2994082-1-alejandro.lucero-palau@amd.com/T/#t</pre>
</details>
<div class="reply-to-label">&#8627; replying to alejandro.lucero-palau</div>
<div class="review-comment-signals">Signals: dependency_question</div>
</div>
<div class="thread-children">
<div class="thread-node depth-2">
<div class="review-comment">
<div class="review-comment-header">
<span class="review-author">Alejandro Palau</span>
<a class="date-chip" href="../2026-02-24_ollama_llama3.1-8b.html" title="First appeared in report for 2026-02-24">2026-02-24</a>
<span class="review-tag-badge">Reviewed-by</span>
<span class="badge" style="color:#383d41;background:#e2e3e5">Neutral</span>
<span class="analysis-source-badge" style="color:#004085;background:#cce5ff" title="Analysis source: LLM">LLM</span>
</div>
<div class="review-comment-text">reviewer confirmed that the patch applies cleanly and is independent from the others, but did not provide any technical feedback or suggestions</div>
<details class="raw-body-toggle">
<summary>Show original comment</summary>
<pre class="raw-body-text">Hi Dave,


It is independent, but it applies cleanly on top of the previous ones as 
core/region.c is not modified by the other.


Thank you</pre>
</details>
<div class="reply-to-label">&#8627; replying to Dave Jiang</div>
<div class="review-comment-signals">Signals: no specific technical concerns raised</div>
</div>
</div>
</div>
</div>
<div class="thread-node depth-1">
<div class="review-comment">
<div class="review-comment-header">
<span class="review-author">Dave Jiang</span>
<a class="date-chip" href="../2026-02-24_ollama_llama3.1-8b.html" title="First appeared in report for 2026-02-24">2026-02-24</a>
<span class="review-tag-badge">Reviewed-by</span>
<span class="badge" style="color:#856404;background:#fff3cd">Needs Work</span>
<span class="analysis-source-badge" style="color:#004085;background:#cce5ff" title="Analysis source: LLM">LLM</span>
</div>
<div class="review-comment-text">Reviewer Dave Jiang suggested that the patch should account for auto region creation, pointing out that the current logic may not handle this case correctly.

Gave Reviewed-by</div>
<details class="raw-body-toggle">
<summary>Show original comment</summary>
<pre class="raw-body-text">s/is/can be/

Since there&#x27;s also auto region creation.</pre>
</details>
<div class="reply-to-label">&#8627; replying to alejandro.lucero-palau</div>
<div class="review-comment-signals">Signals: patch needs further review</div>
</div>
</div>
<div class="thread-node depth-1">
<div class="review-comment">
<div class="review-comment-header">
<span class="review-author">Gregory Price</span>
<a class="date-chip" href="../2026-02-24_ollama_llama3.1-8b.html" title="First appeared in report for 2026-02-24">2026-02-24</a>
<span class="review-tag-badge">Reviewed-by</span>
<span class="badge" style="color:#155724;background:#d4edda">Positive</span>
<span class="analysis-source-badge" style="color:#004085;background:#cce5ff" title="Analysis source: LLM">LLM</span>
</div>
<div class="review-comment-text">Gave Reviewed-by</div>
<details class="raw-body-toggle">
<summary>Show original comment</summary>
<pre class="raw-body-text">On Tue, Feb 24, 2026 at 03:26:43PM +0000, alejandro.lucero-palau@amd.com wrote:
&gt; From: Alejandro Lucero &lt;alucerop@amd.com&gt;
&gt; 
&gt; Current code is expecting Type3 or CXL_DECODER_HOSTONLYMEM devices only.
&gt; Support for Type2 implies region type needs to be based on the endpoint
&gt; type HDM-D[B] instead.
&gt; 
&gt; Signed-off-by: Alejandro Lucero &lt;alucerop@amd.com&gt;
&gt; Reviewed-by: Zhi Wang &lt;zhiw@nvidia.com&gt;
&gt; Reviewed-by: Dave Jiang &lt;dave.jiang@intel.com&gt;
&gt; Reviewed-by: Jonathan Cameron &lt;Jonathan.Cameron@huawei.com&gt;
&gt; Reviewed-by: Ben Cheatham &lt;benjamin.cheatham@amd.com&gt;
&gt; Reviewed-by: Alison Schofield &lt;alison.schofield@intel.com&gt;
&gt; Reviewed-by: Davidlohr Bueso &lt;daves@stgolabs.net&gt;


Reviewed-by: Gregory Price &lt;gourry@gourry.net&gt;


---

On Tue, Feb 24, 2026 at 03:26:44PM +0000, alejandro.lucero-palau@amd.com wrote:
&gt; From: Alejandro Lucero &lt;alucerop@amd.com&gt;
&gt; 
&gt; Region creation based on Type3 devices is triggered from user space
&gt; allowing memory combination through interleaving.
&gt; 
&gt; In preparation for kernel driven region creation, that is Type2 drivers
&gt; triggering region creation backed with its advertised CXL memory, factor
&gt; out a common helper from the user-sysfs region setup for interleave ways.
&gt; 
&gt; Signed-off-by: Alejandro Lucero &lt;alucerop@amd.com&gt;

Reviewed-by: Gregory Price &lt;gourry@gourry.net&gt;


---

On Tue, Feb 24, 2026 at 03:26:45PM +0000, alejandro.lucero-palau@amd.com wrote:
&gt; From: Alejandro Lucero &lt;alucerop@amd.com&gt;
&gt; 
&gt; Region creation based on Type3 devices is triggered from user space
&gt; allowing memory combination through interleaving.
&gt; 
&gt; In preparation for kernel driven region creation, that is Type2 drivers
&gt; triggering region creation backed with its advertised CXL memory, factor
&gt; out a common helper from the user-sysfs region setup forinterleave
&gt; granularity.
&gt; 
&gt; Signed-off-by: Alejandro Lucero &lt;alucerop@amd.com&gt;

Reviewed-by: Gregory Price &lt;gourry@gourry.net&gt;


---

On Tue, Feb 24, 2026 at 03:26:42PM +0000, alejandro.lucero-palau@amd.com wrote:
&gt; From: Alejandro Lucero &lt;alucerop@amd.com&gt;
&gt; 
&gt; In preparation for Type2 devices/drivers support, these next patches
&gt; adapt the cxl region code for required Type2 functionality preserving
&gt; current functionality.
&gt; 
&gt; Alejandro Lucero (3):
&gt;   cxl: Make region type based on endpoint type
&gt;   cxl/region: Factor out interleave ways setup
&gt;   cxl/region: Factor out interleave granularity setup
&gt; 
&gt;  drivers/cxl/core/region.c | 87 +++++++++++++++++++++++++--------------
&gt;  1 file changed, 56 insertions(+), 31 deletions(-)
&gt; 

I&#x27;ve been testing with these for a while - the additional lockdep is a
nice addition.  So for series

Tested-by: Gregory Price &lt;gourry@gourry.net&gt;

</pre>
</details>
<div class="reply-to-label">&#8627; replying to alejandro.lucero-palau</div>
</div>
</div>
<div class="thread-node depth-1">
<div class="review-comment">
<div class="review-comment-header">
<span class="review-author">Gregory Price</span>
<a class="date-chip" href="../2026-02-24_ollama_llama3.1-8b.html" title="First appeared in report for 2026-02-24">2026-02-24</a>
<span class="review-tag-badge">Tested-by</span>
<span class="badge" style="color:#155724;background:#d4edda">Positive</span>
<span class="analysis-source-badge" style="color:#004085;background:#cce5ff" title="Analysis source: LLM">LLM</span>
</div>
<div class="review-comment-text">Reviewer Gregory Price noted that the additional lockdep is a nice addition and has been testing the patches, indicating they are working as expected.</div>
<details class="raw-body-toggle">
<summary>Show original comment</summary>
<pre class="raw-body-text">I&#x27;ve been testing with these for a while - the additional lockdep is a
nice addition.  So for series

Tested-by: Gregory Price &lt;gourry@gourry.net&gt;</pre>
</details>
<div class="reply-to-label">&#8627; replying to alejandro.lucero-palau</div>
<div class="review-comment-signals">Signals: NEEDS_WORK</div>
</div>
</div>
<div class="thread-node depth-1">
<div class="review-comment">
<div class="review-comment-header">
<span class="review-author">Dave Jiang</span>
<a class="date-chip" href="../2026-02-24_ollama_llama3.1-8b.html" title="First appeared in report for 2026-02-24">2026-02-24</a>
<span class="review-tag-badge">Reviewed-by</span>
<span class="badge" style="color:#155724;background:#d4edda">Positive</span>
<span class="analysis-source-badge" style="color:#004085;background:#cce5ff" title="Analysis source: LLM">LLM</span>
</div>
<div class="review-comment-text">Gave Reviewed-by</div>
<details class="raw-body-toggle">
<summary>Show original comment</summary>
<pre class="raw-body-text">

On 2/24/26 8:26 AM, alejandro.lucero-palau@amd.com wrote:
&gt; From: Alejandro Lucero &lt;alucerop@amd.com&gt;
&gt; 
&gt; In preparation for Type2 devices/drivers support, these next patches
&gt; adapt the cxl region code for required Type2 functionality preserving
&gt; current functionality.
&gt; 
&gt; Alejandro Lucero (3):
&gt;   cxl: Make region type based on endpoint type
&gt;   cxl/region: Factor out interleave ways setup
&gt;   cxl/region: Factor out interleave granularity setup
&gt; 
&gt;  drivers/cxl/core/region.c | 87 +++++++++++++++++++++++++--------------
&gt;  1 file changed, 56 insertions(+), 31 deletions(-)
&gt; 
&gt; 
&gt; base-commit: 6de23f81a5e08be8fbf5e8d7e9febc72a5b5f27f

Does this set depends on the preparation set [1] or is independent?

[1]: https://lore.kernel.org/linux-cxl/20260223142633.2994082-1-alejandro.lucero-palau@amd.com/T/#t


---



On 2/24/26 8:26 AM, alejandro.lucero-palau@amd.com wrote:
&gt; From: Alejandro Lucero &lt;alucerop@amd.com&gt;
&gt; 
&gt; Region creation based on Type3 devices is triggered from user space

s/is/can be/

Since there&#x27;s also auto region creation.

&gt; allowing memory combination through interleaving.
&gt; 
&gt; In preparation for kernel driven region creation, that is Type2 drivers
&gt; triggering region creation backed with its advertised CXL memory, factor
&gt; out a common helper from the user-sysfs region setup for interleave ways.
&gt; 
&gt; Signed-off-by: Alejandro Lucero &lt;alucerop@amd.com&gt;

Reviewed-by: Dave Jiang &lt;dave.jiang@intel.com&gt;

&gt; ---
&gt;  drivers/cxl/core/region.c | 41 +++++++++++++++++++++++++--------------
&gt;  1 file changed, 26 insertions(+), 15 deletions(-)
&gt; 
&gt; diff --git a/drivers/cxl/core/region.c b/drivers/cxl/core/region.c
&gt; index cac33c99fe6a..3ef4ccf1c92b 100644
&gt; --- a/drivers/cxl/core/region.c
&gt; +++ b/drivers/cxl/core/region.c
&gt; @@ -485,22 +485,14 @@ static ssize_t interleave_ways_show(struct device *dev,
&gt;  
&gt;  static const struct attribute_group *get_cxl_region_target_group(void);
&gt;  
&gt; -static ssize_t interleave_ways_store(struct device *dev,
&gt; -				     struct device_attribute *attr,
&gt; -				     const char *buf, size_t len)
&gt; +static int set_interleave_ways(struct cxl_region *cxlr, int val)
&gt;  {
&gt; -	struct cxl_region *cxlr = to_cxl_region(dev);
&gt;  	struct cxl_root_decoder *cxlrd = cxlr-&gt;cxlrd;
&gt;  	struct cxl_decoder *cxld = &amp;cxlrd-&gt;cxlsd.cxld;
&gt;  	struct cxl_region_params *p = &amp;cxlr-&gt;params;
&gt; -	unsigned int val, save;
&gt; -	int rc;
&gt; +	int save, rc;
&gt;  	u8 iw;
&gt;  
&gt; -	rc = kstrtouint(buf, 0, &amp;val);
&gt; -	if (rc)
&gt; -		return rc;
&gt; -
&gt;  	rc = ways_to_eiw(val, &amp;iw);
&gt;  	if (rc)
&gt;  		return rc;
&gt; @@ -515,9 +507,7 @@ static ssize_t interleave_ways_store(struct device *dev,
&gt;  		return -EINVAL;
&gt;  	}
&gt;  
&gt; -	ACQUIRE(rwsem_write_kill, rwsem)(&amp;cxl_rwsem.region);
&gt; -	if ((rc = ACQUIRE_ERR(rwsem_write_kill, &amp;rwsem)))
&gt; -		return rc;
&gt; +	lockdep_assert_held_write(&amp;cxl_rwsem.region);
&gt;  
&gt;  	if (p-&gt;state &gt;= CXL_CONFIG_INTERLEAVE_ACTIVE)
&gt;  		return -EBUSY;
&gt; @@ -525,10 +515,31 @@ static ssize_t interleave_ways_store(struct device *dev,
&gt;  	save = p-&gt;interleave_ways;
&gt;  	p-&gt;interleave_ways = val;
&gt;  	rc = sysfs_update_group(&amp;cxlr-&gt;dev.kobj, get_cxl_region_target_group());
&gt; -	if (rc) {
&gt; +	if (rc)
&gt;  		p-&gt;interleave_ways = save;
&gt; +
&gt; +	return rc;
&gt; +}
&gt; +
&gt; +static ssize_t interleave_ways_store(struct device *dev,
&gt; +				     struct device_attribute *attr,
&gt; +				     const char *buf, size_t len)
&gt; +{
&gt; +	struct cxl_region *cxlr = to_cxl_region(dev);
&gt; +	unsigned int val;
&gt; +	int rc;
&gt; +
&gt; +	rc = kstrtouint(buf, 0, &amp;val);
&gt; +	if (rc)
&gt; +		return rc;
&gt; +
&gt; +	ACQUIRE(rwsem_write_kill, rwsem)(&amp;cxl_rwsem.region);
&gt; +	if ((rc = ACQUIRE_ERR(rwsem_write_kill, &amp;rwsem)))
&gt; +		return rc;
&gt; +
&gt; +	rc = set_interleave_ways(cxlr, val);
&gt; +	if (rc)
&gt;  		return rc;
&gt; -	}
&gt;  
&gt;  	return len;
&gt;  }



---



On 2/24/26 8:26 AM, alejandro.lucero-palau@amd.com wrote:
&gt; From: Alejandro Lucero &lt;alucerop@amd.com&gt;
&gt; 
&gt; Region creation based on Type3 devices is triggered from user space

same comment here as for 2/3.

&gt; allowing memory combination through interleaving.
&gt; 
&gt; In preparation for kernel driven region creation, that is Type2 drivers
&gt; triggering region creation backed with its advertised CXL memory, factor
&gt; out a common helper from the user-sysfs region setup forinterleave
&gt; granularity.
&gt; 
&gt; Signed-off-by: Alejandro Lucero &lt;alucerop@amd.com&gt;
Reviewed-by: Dave Jiang &lt;dave.jiang@intel.com&gt;


&gt; ---
&gt;  drivers/cxl/core/region.c | 36 ++++++++++++++++++++++++------------
&gt;  1 file changed, 24 insertions(+), 12 deletions(-)
&gt; 
&gt; diff --git a/drivers/cxl/core/region.c b/drivers/cxl/core/region.c
&gt; index 3ef4ccf1c92b..aed3733490a1 100644
&gt; --- a/drivers/cxl/core/region.c
&gt; +++ b/drivers/cxl/core/region.c
&gt; @@ -559,21 +559,14 @@ static ssize_t interleave_granularity_show(struct device *dev,
&gt;  	return sysfs_emit(buf, &quot;%d\n&quot;, p-&gt;interleave_granularity);
&gt;  }
&gt;  
&gt; -static ssize_t interleave_granularity_store(struct device *dev,
&gt; -					    struct device_attribute *attr,
&gt; -					    const char *buf, size_t len)
&gt; +static int set_interleave_granularity(struct cxl_region *cxlr, int val)
&gt;  {
&gt; -	struct cxl_region *cxlr = to_cxl_region(dev);
&gt;  	struct cxl_root_decoder *cxlrd = cxlr-&gt;cxlrd;
&gt;  	struct cxl_decoder *cxld = &amp;cxlrd-&gt;cxlsd.cxld;
&gt;  	struct cxl_region_params *p = &amp;cxlr-&gt;params;
&gt; -	int rc, val;
&gt; +	int rc;
&gt;  	u16 ig;
&gt;  
&gt; -	rc = kstrtoint(buf, 0, &amp;val);
&gt; -	if (rc)
&gt; -		return rc;
&gt; -
&gt;  	rc = granularity_to_eig(val, &amp;ig);
&gt;  	if (rc)
&gt;  		return rc;
&gt; @@ -589,14 +582,33 @@ static ssize_t interleave_granularity_store(struct device *dev,
&gt;  	if (cxld-&gt;interleave_ways &gt; 1 &amp;&amp; val != cxld-&gt;interleave_granularity)
&gt;  		return -EINVAL;
&gt;  
&gt; -	ACQUIRE(rwsem_write_kill, rwsem)(&amp;cxl_rwsem.region);
&gt; -	if ((rc = ACQUIRE_ERR(rwsem_write_kill, &amp;rwsem)))
&gt; -		return rc;
&gt; +	lockdep_assert_held_write(&amp;cxl_rwsem.region);
&gt;  
&gt;  	if (p-&gt;state &gt;= CXL_CONFIG_INTERLEAVE_ACTIVE)
&gt;  		return -EBUSY;
&gt;  
&gt;  	p-&gt;interleave_granularity = val;
&gt; +	return 0;
&gt; +}
&gt; +
&gt; +static ssize_t interleave_granularity_store(struct device *dev,
&gt; +					    struct device_attribute *attr,
&gt; +					    const char *buf, size_t len)
&gt; +{
&gt; +	struct cxl_region *cxlr = to_cxl_region(dev);
&gt; +	int rc, val;
&gt; +
&gt; +	rc = kstrtoint(buf, 0, &amp;val);
&gt; +	if (rc)
&gt; +		return rc;
&gt; +
&gt; +	ACQUIRE(rwsem_write_kill, rwsem)(&amp;cxl_rwsem.region);
&gt; +	if ((rc = ACQUIRE_ERR(rwsem_write_kill, &amp;rwsem)))
&gt; +		return rc;
&gt; +
&gt; +	rc = set_interleave_granularity(cxlr, val);
&gt; +	if (rc)
&gt; +		return rc;
&gt;  
&gt;  	return len;
&gt;  }

</pre>
</details>
<div class="reply-to-label">&#8627; replying to alejandro.lucero-palau</div>
</div>
</div>
</div>
</div>
<div class="thread-node depth-0">
<div class="review-comment">
<div class="review-comment-header">
<span class="review-author">alejandro.lucero-palau (author)</span>
<a class="date-chip" href="../2026-02-24_ollama_llama3.1-8b.html" title="First appeared in report for 2026-02-24">2026-02-24</a>
<span class="badge" style="color:#383d41;background:#e2e3e5">Neutral</span>
<span class="analysis-source-badge" style="color:#004085;background:#cce5ff" title="Analysis source: LLM">LLM</span>
</div>
<div class="review-comment-text">The author addressed a concern about the locking mechanism in the interleave ways store function, explaining that they will factor out a common helper from the user-sysfs region setup for interleave ways to prepare for kernel-driven region creation.</div>
<details class="raw-body-toggle">
<summary>Show original comment</summary>
<pre class="raw-body-text">From: Alejandro Lucero &lt;alucerop@amd.com&gt;

Region creation based on Type3 devices is triggered from user space
allowing memory combination through interleaving.

In preparation for kernel driven region creation, that is Type2 drivers
triggering region creation backed with its advertised CXL memory, factor
out a common helper from the user-sysfs region setup for interleave ways.

Signed-off-by: Alejandro Lucero &lt;alucerop@amd.com&gt;
---
 drivers/cxl/core/region.c | 41 +++++++++++++++++++++++++--------------
 1 file changed, 26 insertions(+), 15 deletions(-)

diff --git a/drivers/cxl/core/region.c b/drivers/cxl/core/region.c
index cac33c99fe6a..3ef4ccf1c92b 100644
--- a/drivers/cxl/core/region.c
+++ b/drivers/cxl/core/region.c
@@ -485,22 +485,14 @@ static ssize_t interleave_ways_show(struct device *dev,
 
 static const struct attribute_group *get_cxl_region_target_group(void);
 
-static ssize_t interleave_ways_store(struct device *dev,
-				     struct device_attribute *attr,
-				     const char *buf, size_t len)
+static int set_interleave_ways(struct cxl_region *cxlr, int val)
 {
-	struct cxl_region *cxlr = to_cxl_region(dev);
 	struct cxl_root_decoder *cxlrd = cxlr-&gt;cxlrd;
 	struct cxl_decoder *cxld = &amp;cxlrd-&gt;cxlsd.cxld;
 	struct cxl_region_params *p = &amp;cxlr-&gt;params;
-	unsigned int val, save;
-	int rc;
+	int save, rc;
 	u8 iw;
 
-	rc = kstrtouint(buf, 0, &amp;val);
-	if (rc)
-		return rc;
-
 	rc = ways_to_eiw(val, &amp;iw);
 	if (rc)
 		return rc;
@@ -515,9 +507,7 @@ static ssize_t interleave_ways_store(struct device *dev,
 		return -EINVAL;
 	}
 
-	ACQUIRE(rwsem_write_kill, rwsem)(&amp;cxl_rwsem.region);
-	if ((rc = ACQUIRE_ERR(rwsem_write_kill, &amp;rwsem)))
-		return rc;
+	lockdep_assert_held_write(&amp;cxl_rwsem.region);
 
 	if (p-&gt;state &gt;= CXL_CONFIG_INTERLEAVE_ACTIVE)
 		return -EBUSY;
@@ -525,10 +515,31 @@ static ssize_t interleave_ways_store(struct device *dev,
 	save = p-&gt;interleave_ways;
 	p-&gt;interleave_ways = val;
 	rc = sysfs_update_group(&amp;cxlr-&gt;dev.kobj, get_cxl_region_target_group());
-	if (rc) {
+	if (rc)
 		p-&gt;interleave_ways = save;
+
+	return rc;
+}
+
+static ssize_t interleave_ways_store(struct device *dev,
+				     struct device_attribute *attr,
+				     const char *buf, size_t len)
+{
+	struct cxl_region *cxlr = to_cxl_region(dev);
+	unsigned int val;
+	int rc;
+
+	rc = kstrtouint(buf, 0, &amp;val);
+	if (rc)
+		return rc;
+
+	ACQUIRE(rwsem_write_kill, rwsem)(&amp;cxl_rwsem.region);
+	if ((rc = ACQUIRE_ERR(rwsem_write_kill, &amp;rwsem)))
+		return rc;
+
+	rc = set_interleave_ways(cxlr, val);
+	if (rc)
 		return rc;
-	}
 
 	return len;
 }
-- 
2.34.1</pre>
</details>
<div class="review-comment-signals">Signals: clarification, explanation</div>
</div>
</div>
<div class="thread-node depth-0">
<div class="review-comment">
<div class="review-comment-header">
<span class="review-author">alejandro.lucero-palau (author)</span>
<a class="date-chip" href="../2026-02-24_ollama_llama3.1-8b.html" title="First appeared in report for 2026-02-24">2026-02-24</a>
<span class="badge" style="color:#383d41;background:#e2e3e5">Neutral</span>
<span class="analysis-source-badge" style="color:#004085;background:#cce5ff" title="Analysis source: LLM">LLM</span>
</div>
<div class="review-comment-text">The author addressed a concern about the interleave granularity store function being called without acquiring the region lock, and explained that they will factor out a common helper from the user-sysfs region setup to address this issue.</div>
<details class="raw-body-toggle">
<summary>Show original comment</summary>
<pre class="raw-body-text">From: Alejandro Lucero &lt;alucerop@amd.com&gt;

Region creation based on Type3 devices is triggered from user space
allowing memory combination through interleaving.

In preparation for kernel driven region creation, that is Type2 drivers
triggering region creation backed with its advertised CXL memory, factor
out a common helper from the user-sysfs region setup forinterleave
granularity.

Signed-off-by: Alejandro Lucero &lt;alucerop@amd.com&gt;
---
 drivers/cxl/core/region.c | 36 ++++++++++++++++++++++++------------
 1 file changed, 24 insertions(+), 12 deletions(-)

diff --git a/drivers/cxl/core/region.c b/drivers/cxl/core/region.c
index 3ef4ccf1c92b..aed3733490a1 100644
--- a/drivers/cxl/core/region.c
+++ b/drivers/cxl/core/region.c
@@ -559,21 +559,14 @@ static ssize_t interleave_granularity_show(struct device *dev,
 	return sysfs_emit(buf, &quot;%d\n&quot;, p-&gt;interleave_granularity);
 }
 
-static ssize_t interleave_granularity_store(struct device *dev,
-					    struct device_attribute *attr,
-					    const char *buf, size_t len)
+static int set_interleave_granularity(struct cxl_region *cxlr, int val)
 {
-	struct cxl_region *cxlr = to_cxl_region(dev);
 	struct cxl_root_decoder *cxlrd = cxlr-&gt;cxlrd;
 	struct cxl_decoder *cxld = &amp;cxlrd-&gt;cxlsd.cxld;
 	struct cxl_region_params *p = &amp;cxlr-&gt;params;
-	int rc, val;
+	int rc;
 	u16 ig;
 
-	rc = kstrtoint(buf, 0, &amp;val);
-	if (rc)
-		return rc;
-
 	rc = granularity_to_eig(val, &amp;ig);
 	if (rc)
 		return rc;
@@ -589,14 +582,33 @@ static ssize_t interleave_granularity_store(struct device *dev,
 	if (cxld-&gt;interleave_ways &gt; 1 &amp;&amp; val != cxld-&gt;interleave_granularity)
 		return -EINVAL;
 
-	ACQUIRE(rwsem_write_kill, rwsem)(&amp;cxl_rwsem.region);
-	if ((rc = ACQUIRE_ERR(rwsem_write_kill, &amp;rwsem)))
-		return rc;
+	lockdep_assert_held_write(&amp;cxl_rwsem.region);
 
 	if (p-&gt;state &gt;= CXL_CONFIG_INTERLEAVE_ACTIVE)
 		return -EBUSY;
 
 	p-&gt;interleave_granularity = val;
+	return 0;
+}
+
+static ssize_t interleave_granularity_store(struct device *dev,
+					    struct device_attribute *attr,
+					    const char *buf, size_t len)
+{
+	struct cxl_region *cxlr = to_cxl_region(dev);
+	int rc, val;
+
+	rc = kstrtoint(buf, 0, &amp;val);
+	if (rc)
+		return rc;
+
+	ACQUIRE(rwsem_write_kill, rwsem)(&amp;cxl_rwsem.region);
+	if ((rc = ACQUIRE_ERR(rwsem_write_kill, &amp;rwsem)))
+		return rc;
+
+	rc = set_interleave_granularity(cxlr, val);
+	if (rc)
+		return rc;
 
 	return len;
 }
-- 
2.34.1</pre>
</details>
<div class="review-comment-signals">Signals: clarification, explanation</div>
</div>
</div>
</div>

    <footer>LKML Daily Activity Tracker</footer>
    <script>
    // When arriving via a date anchor (e.g. #2026-02-15 from a daily report),
    // scroll the anchor into view after a brief delay so layout is complete.
    (function () {
        var hash = window.location.hash;
        if (!hash) return;
        var target = document.getElementById(hash.slice(1));
        if (!target) return;
        setTimeout(function () {
            target.scrollIntoView({behavior: 'smooth', block: 'start'});
        }, 80);
    })();
    </script>
</body>
</html>
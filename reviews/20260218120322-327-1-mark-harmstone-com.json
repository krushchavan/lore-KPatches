{
  "thread_id": "20260218120322.327-1-mark@harmstone.com",
  "subject": "[PATCH] btrfs: print correct subvol num if can't delete because of active swapfile",
  "url": "https://lore.kernel.org/all/20260218120322.327-1-mark@harmstone.com/",
  "dates": {
    "2026-02-18": {
      "report_file": "2026-02-18_ollama_llama3.1-8b.html",
      "developer": "Mark Harmstone",
      "reviews": [
        {
          "author": "Filipe Manana",
          "summary": "Approved the patch as it fixes a clear error in the error message. The fix is straightforward and corrects the issue.",
          "sentiment": "positive",
          "sentiment_signals": [
            "Looks good, thanks."
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "On Wed, Feb 18, 2026 at 12:03 PM Mark Harmstone <mark@harmstone.com> wrote:\n>\n> Fix the error message in btrfs_delete_subvolume() if we can't delete a\n> subvolume because it has an active swapfile: we were printing the number\n> of the parent rather than the target.\n>\n> Fixes: 60021bd754c6 (\"btrfs: prevent subvol with swapfile from being deleted\")\n> Signed-off-by: Mark Harmstone <mark@harmstone.com>\n\nReviewed-by: Filipe Manana <fdmanana@suse.com>\n\nLooks good, thanks.\n\n> ---\n>  fs/btrfs/inode.c | 2 +-\n>  1 file changed, 1 insertion(+), 1 deletion(-)\n>\n> diff --git a/fs/btrfs/inode.c b/fs/btrfs/inode.c\n> index 4523b689711d..233d91556fe4 100644\n> --- a/fs/btrfs/inode.c\n> +++ b/fs/btrfs/inode.c\n> @@ -4804,7 +4804,7 @@ int btrfs_delete_subvolume(struct btrfs_inode *dir, struct dentry *dentry)\n>                 spin_unlock(&dest->root_item_lock);\n>                 btrfs_warn(fs_info,\n>                            \"attempt to delete subvolume %llu with active swapfile\",\n> -                          btrfs_root_id(root));\n> +                          btrfs_root_id(dest));\n>                 ret = -EPERM;\n>                 goto out_up_write;\n>         }\n> --\n> 2.52.0\n>\n>\n"
        },
        {
          "author": "Qu Wenruo",
          "summary": "Approved the patch as it fixes a clear error in the error message. The fix is straightforward and corrects the issue.",
          "sentiment": "positive",
          "sentiment_signals": [
            "Thanks,"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "\n\n在 2026/2/18 22:33, Mark Harmstone 写道:\n> Fix the error message in btrfs_delete_subvolume() if we can't delete a\n> subvolume because it has an active swapfile: we were printing the number\n> of the parent rather than the target.\n> \n> Fixes: 60021bd754c6 (\"btrfs: prevent subvol with swapfile from being deleted\")\n> Signed-off-by: Mark Harmstone <mark@harmstone.com>\n\nReviewed-by: Qu Wenruo <wqu@suse.com>\n\nThanks,\nQu\n\n> ---\n>   fs/btrfs/inode.c | 2 +-\n>   1 file changed, 1 insertion(+), 1 deletion(-)\n> \n> diff --git a/fs/btrfs/inode.c b/fs/btrfs/inode.c\n> index 4523b689711d..233d91556fe4 100644\n> --- a/fs/btrfs/inode.c\n> +++ b/fs/btrfs/inode.c\n> @@ -4804,7 +4804,7 @@ int btrfs_delete_subvolume(struct btrfs_inode *dir, struct dentry *dentry)\n>   \t\tspin_unlock(&dest->root_item_lock);\n>   \t\tbtrfs_warn(fs_info,\n>   \t\t\t   \"attempt to delete subvolume %llu with active swapfile\",\n> -\t\t\t   btrfs_root_id(root));\n> +\t\t\t   btrfs_root_id(dest));\n>   \t\tret = -EPERM;\n>   \t\tgoto out_up_write;\n>   \t}\n\n\n"
        }
      ],
      "analysis_source": "llm"
    },
    "2026-02-19": {
      "report_file": "2026-02-19_ollama_llama3.1-8b.html",
      "developer": "Mark Harmstone",
      "reviews": [
        {
          "author": "Filipe Manana",
          "summary": "Approved the patch as it fixes a bug in the error message of btrfs_delete_subvolume().",
          "sentiment": "positive",
          "sentiment_signals": [
            "Looks good, thanks."
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "On Wed, Feb 18, 2026 at 12:03 PM Mark Harmstone <mark@harmstone.com> wrote:\n>\n> Fix the error message in btrfs_delete_subvolume() if we can't delete a\n> subvolume because it has an active swapfile: we were printing the number\n> of the parent rather than the target.\n>\n> Fixes: 60021bd754c6 (\"btrfs: prevent subvol with swapfile from being deleted\")\n> Signed-off-by: Mark Harmstone <mark@harmstone.com>\n\nReviewed-by: Filipe Manana <fdmanana@suse.com>\n\nLooks good, thanks.\n\n> ---\n>  fs/btrfs/inode.c | 2 +-\n>  1 file changed, 1 insertion(+), 1 deletion(-)\n>\n> diff --git a/fs/btrfs/inode.c b/fs/btrfs/inode.c\n> index 4523b689711d..233d91556fe4 100644\n> --- a/fs/btrfs/inode.c\n> +++ b/fs/btrfs/inode.c\n> @@ -4804,7 +4804,7 @@ int btrfs_delete_subvolume(struct btrfs_inode *dir, struct dentry *dentry)\n>                 spin_unlock(&dest->root_item_lock);\n>                 btrfs_warn(fs_info,\n>                            \"attempt to delete subvolume %llu with active swapfile\",\n> -                          btrfs_root_id(root));\n> +                          btrfs_root_id(dest));\n>                 ret = -EPERM;\n>                 goto out_up_write;\n>         }\n> --\n> 2.52.0\n>\n>\n",
          "reply_to": ""
        },
        {
          "author": "Qu Wenruo",
          "summary": "Approved the patch as it fixes a bug in the error message of btrfs_delete_subvolume().",
          "sentiment": "positive",
          "sentiment_signals": [
            "Thanks,"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "\n\n在 2026/2/18 22:33, Mark Harmstone 写道:\n> Fix the error message in btrfs_delete_subvolume() if we can't delete a\n> subvolume because it has an active swapfile: we were printing the number\n> of the parent rather than the target.\n> \n> Fixes: 60021bd754c6 (\"btrfs: prevent subvol with swapfile from being deleted\")\n> Signed-off-by: Mark Harmstone <mark@harmstone.com>\n\nReviewed-by: Qu Wenruo <wqu@suse.com>\n\nThanks,\nQu\n\n> ---\n>   fs/btrfs/inode.c | 2 +-\n>   1 file changed, 1 insertion(+), 1 deletion(-)\n> \n> diff --git a/fs/btrfs/inode.c b/fs/btrfs/inode.c\n> index 4523b689711d..233d91556fe4 100644\n> --- a/fs/btrfs/inode.c\n> +++ b/fs/btrfs/inode.c\n> @@ -4804,7 +4804,7 @@ int btrfs_delete_subvolume(struct btrfs_inode *dir, struct dentry *dentry)\n>   \t\tspin_unlock(&dest->root_item_lock);\n>   \t\tbtrfs_warn(fs_info,\n>   \t\t\t   \"attempt to delete subvolume %llu with active swapfile\",\n> -\t\t\t   btrfs_root_id(root));\n> +\t\t\t   btrfs_root_id(dest));\n>   \t\tret = -EPERM;\n>   \t\tgoto out_up_write;\n>   \t}\n\n\n",
          "reply_to": ""
        }
      ],
      "analysis_source": "llm",
      "patch_summary": "This patch fixes a bug in btrfs_delete_subvolume() where the error message incorrectly prints the parent subvolume number instead of the target subvolume number when deletion is prevented by an active swapfile."
    }
  }
}
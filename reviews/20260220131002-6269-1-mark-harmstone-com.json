{
  "thread_id": "20260220131002.6269-1-mark@harmstone.com",
  "subject": "[PATCH] btrfs: fix chunk map leak in btrfs_map_block() after btrfs_translate_remap()",
  "url": "https://lore.kernel.org/all/20260220131002.6269-1-mark@harmstone.com/",
  "dates": {
    "2026-02-20": {
      "report_file": "2026-02-20_ollama_llama3.1-8b.html",
      "developer": "Mark Harmstone",
      "reviews": [
        {
          "author": "Filipe Manana",
          "summary": "Identified the patch as a bug fix and provided a Reviewed-by tag. The reviewer acknowledged that it's more of a Reported-by rather than a Suggested-by, given its nature.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "Acknowledged"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "On Fri, Feb 20, 2026 at 1:10â€¯PM Mark Harmstone <mark@harmstone.com> wrote:\n>\n> If the call to btrfs_translate_remap() in btrfs_map_block() returns an\n> error code, we were leaking the chunk map. Fix it by jumping to out\n> rather than returning directly.\n>\n> Signed-off-by: Mark Harmstone <mark@harmstone.com>\n> Fixes: 18ba64992871 (\"btrfs: redirect I/O for remapped block groups\")\n> Suggested-by: Chris Mason <clm@fb.com>\n\nIt's a bug fix so this is more a Reported-by rather than a Suggested-by.\n\nOtherwise,\n\nReviewed-by: Filipe Manana <fdmanana@suse.com>\n\nThanks.\n\n> Link: https://lore.kernel.org/linux-btrfs/20260125125830.2352988-1-clm@meta.com/\n> ---\n>  fs/btrfs/volumes.c | 2 +-\n>  1 file changed, 1 insertion(+), 1 deletion(-)\n>\n> diff --git a/fs/btrfs/volumes.c b/fs/btrfs/volumes.c\n> index 83e2834ea273..1bd3464ccdd8 100644\n> --- a/fs/btrfs/volumes.c\n> +++ b/fs/btrfs/volumes.c\n> @@ -7082,7 +7082,7 @@ int btrfs_map_block(struct btrfs_fs_info *fs_info, enum btrfs_map_op op,\n>\n>                 ret = btrfs_translate_remap(fs_info, &new_logical, length);\n>                 if (ret)\n> -                       return ret;\n> +                       goto out;\n>\n>                 if (new_logical != logical) {\n>                         btrfs_free_chunk_map(map);\n> --\n> 2.52.0\n>\n",
          "reply_to": "",
          "message_date": "2026-02-20"
        },
        {
          "author": "David Sterba",
          "summary": "Corrected the reviewer to use Reported-by instead of Suggested-by, given that it's a bug fix. Also requested that the patch author sort the tags according to the btrfs documentation.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "Requested correction"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "On Fri, Feb 20, 2026 at 01:09:54PM +0000, Mark Harmstone wrote:\n> If the call to btrfs_translate_remap() in btrfs_map_block() returns an\n> error code, we were leaking the chunk map. Fix it by jumping to out\n> rather than returning directly.\n> \n> Signed-off-by: Mark Harmstone <mark@harmstone.com>\n> Fixes: 18ba64992871 (\"btrfs: redirect I/O for remapped block groups\")\n> Suggested-by: Chris Mason <clm@fb.com>\n\nIf it's a but then it's Reported-by\n\n> Link: https://lore.kernel.org/linux-btrfs/20260125125830.2352988-1-clm@meta.com/\n\nPlease sort the tags according to\nhttps://btrfs.readthedocs.io/en/latest/dev/Developer-s-FAQ.html#ordering\n\nas it's been for a long time and saves me editing each patch. Thanks.\n",
          "reply_to": "Mark Harmstone",
          "message_date": "2026-02-20"
        },
        {
          "author": "Mark Harmstone",
          "summary": "Acknowledged the corrections and edited the patches to include the tags in the correct order.",
          "sentiment": "positive",
          "sentiment_signals": [
            "Acknowledged correction"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "On 20/02/2026 3.58 pm, David Sterba wrote:\n> On Fri, Feb 20, 2026 at 01:09:54PM +0000, Mark Harmstone wrote:\n>> If the call to btrfs_translate_remap() in btrfs_map_block() returns an\n>> error code, we were leaking the chunk map. Fix it by jumping to out\n>> rather than returning directly.\n>>\n>> Signed-off-by: Mark Harmstone <mark@harmstone.com>\n>> Fixes: 18ba64992871 (\"btrfs: redirect I/O for remapped block groups\")\n>> Suggested-by: Chris Mason <clm@fb.com>\n> \n> If it's a but then it's Reported-by\n> \n>> Link: https://lore.kernel.org/linux-btrfs/20260125125830.2352988-1-clm@meta.com/\n> \n> Please sort the tags according to\n> https://btrfs.readthedocs.io/en/latest/dev/Developer-s-FAQ.html#ordering\n> \n> as it's been for a long time and saves me editing each patch. Thanks.\n\nOkay, I've edited the patches and pushed them with the tags in the right \norder.\n\n",
          "reply_to": "David Sterba",
          "message_date": "2026-02-20"
        }
      ],
      "analysis_source": "llm",
      "patch_summary": "This patch fixes a chunk map leak in the btrfs_map_block() function after a call to btrfs_translate_remap(). The fix involves adding a goto statement to jump out of the function when an error code is returned from btrfs_translate_remap(), preventing the chunk map from being leaked. This change addresses a bug introduced by a previous patch that redirected I/O for remapped block groups."
    }
  }
}
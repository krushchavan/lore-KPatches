{
  "thread_id": "CAJnrk1bk7jN8SfHny9nVWZZS6tP8bnQbMZHTCuFma6-YuMugAg@mail.gmail.com",
  "subject": "Re: [syzbot] [iomap?] WARNING in ifs_free",
  "url": "https://lore.kernel.org/all/CAJnrk1bk7jN8SfHny9nVWZZS6tP8bnQbMZHTCuFma6-YuMugAg@mail.gmail.com/",
  "dates": {
    "2026-02-20": {
      "report_file": "2026-02-20_ollama_llama3.1-8b.html",
      "developer": "Joanne Koong",
      "reviews": [
        {
          "author": "syzbot (author)",
          "summary": "The reviewer, syzbot, found a reproducer for the original issue and provided additional information about the crash, including a stack trace.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "additional information",
            "reproducer"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "syzbot has found a reproducer for the following issue on:\n\nHEAD commit:    2b7a25df823d Merge tag 'mm-nonmm-stable-2026-02-18-19-56' ..\ngit tree:       upstream\nconsole output: https://syzkaller.appspot.com/x/log.txt?x=10c21722580000\nkernel config:  https://syzkaller.appspot.com/x/.config?x=65722f41f7edc17e\ndashboard link: https://syzkaller.appspot.com/bug?extid=d3a62bea0e61f9d121da\ncompiler:       Debian clang version 21.1.8 (++20251221033036+2078da43e25a-1~exp1~20251221153213.50), Debian LLD 21.1.8\nsyz repro:      https://syzkaller.appspot.com/x/repro.syz?x=1501dc02580000\nC reproducer:   https://syzkaller.appspot.com/x/repro.c?x=1357f652580000\n\nDownloadable assets:\ndisk image (non-bootable): https://storage.googleapis.com/syzbot-assets/d900f083ada3/non_bootable_disk-2b7a25df.raw.xz\nvmlinux: https://storage.googleapis.com/syzbot-assets/f3a54d09b17c/vmlinux-2b7a25df.xz\nkernel image: https://storage.googleapis.com/syzbot-assets/fb704901bce5/bzImage-2b7a25df.xz\nmounted in repro: https://storage.googleapis.com/syzbot-assets/b778b9903de5/mount_0.gz\n\nIMPORTANT: if you fix the issue, please add the following tag to the commit:\nReported-by: syzbot+d3a62bea0e61f9d121da@syzkaller.appspotmail.com\n\n------------[ cut here ]------------\nifs_is_fully_uptodate(folio, ifs) != folio_test_uptodate(folio)\nWARNING: fs/iomap/buffered-io.c:256 at ifs_free+0x358/0x420 fs/iomap/buffered-io.c:255, CPU#0: syz-executor/5453\nModules linked in:\nCPU: 0 UID: 0 PID: 5453 Comm: syz-executor Not tainted syzkaller #0 PREEMPT(full) \nHardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 1.16.3-debian-1.16.3-2 04/01/2014\nRIP: 0010:ifs_free+0x358/0x420 fs/iomap/buffered-io.c:255\nCode: 41 5f 5d e9 7a fb bd ff e8 45 5a 5e ff 90 0f 0b 90 e9 d0 fe ff ff e8 37 5a 5e ff 90 0f 0b 90 e9 0a ff ff ff e8 29 5a 5e ff 90 <0f> 0b 90 eb c3 44 89 e1 80 e1 07 80 c1 03 38 c1 0f 8c 06 fe ff ff\nRSP: 0018:ffffc9000dfcf688 EFLAGS: 00010293\nRAX: ffffffff82674207 RBX: 0000000000000008 RCX: ffff88801f834900\nRDX: 0000000000000000 RSI: 0000000000000008 RDI: 0000000000000000\nRBP: 000000008267bc01 R08: ffffea00010fb747 R09: 1ffffd400021f6e8\nR10: dffffc0000000000 R11: fffff9400021f6e9 R12: ffff888051c7da44\nR13: ffff888051c7da00 R14: ffffea00010fb740 R15: 1ffffd400021f6e9\nFS:  0000555586def500(0000) GS:ffff88808ca5b000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 0000555586e0aa28 CR3: 00000000591fe000 CR4: 0000000000352ef0\nCall Trace:\n <TASK>\n folio_invalidate mm/truncate.c:140 [inline]\n truncate_cleanup_folio+0xcb/0x190 mm/truncate.c:160\n truncate_inode_pages_range+0x2ce/0xe30 mm/truncate.c:404\n ntfs_evict_inode+0x19/0x40 fs/ntfs3/inode.c:1861\n evict+0x61e/0xb10 fs/inode.c:846\n dispose_list fs/inode.c:888 [inline]\n evict_inodes+0x75a/0x7f0 fs/inode.c:942\n generic_shutdown_super+0xaa/0x2d0 fs/super.c:632\n kill_block_super+0x44/0x90 fs/super.c:1725\n ntfs3_kill_sb+0x44/0x1c0 fs/ntfs3/super.c:1889\n deactivate_locked_super+0xbc/0x130 fs/super.c:476\n cleanup_mnt+0x437/0x4d0 fs/namespace.c:1312\n task_work_run+0x1d9/0x270 kernel/task_work.c:233\n resume_user_mode_work include/linux/resume_user_mode.h:50 [inline]\n __exit_to_user_mode_loop kernel/entry/common.c:67 [inline]\n exit_to_user_mode_loop+0xed/0x480 kernel/entry/common.c:98\n __exit_to_user_mode_prepare include/linux/irq-entry-common.h:226 [inline]\n syscall_exit_to_user_mode_prepare include/linux/irq-entry-common.h:256 [inline]\n syscall_exit_to_user_mode include/linux/entry-common.h:325 [inline]\n do_syscall_64+0x32d/0xf80 arch/x86/entry/syscall_64.c:100\n entry_SYSCALL_64_after_hwframe+0x77/0x7f\nRIP: 0033:0x7fb0f859d897\nCode: a2 c7 05 5c ee 24 00 00 00 00 00 eb 96 e8 e1 12 00 00 90 31 f6 e9 09 00 00 00 66 0f 1f 84 00 00 00 00 00 b8 a6 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 01 c3 48 c7 c2 e8 ff ff ff f7 d8 64 89 02 b8\nRSP: 002b:00007ffd23732b28 EFLAGS: 00000246 ORIG_RAX: 00000000000000a6\nRAX: 0000000000000000 RBX: 00007fb0f8631ef0 RCX: 00007fb0f859d897\nRDX: 0000000000000000 RSI: 0000000000000009 RDI: 00007ffd23732be0\nRBP: 00007ffd23732be0 R08: 00007ffd23733be0 R09: 00000000ffffffff\nR10: 0000000000000000 R11: 0000000000000246 R12: 00007ffd23733c70\nR13: 00007fb0f8631ef0 R14: 000000000001b126 R15: 00007ffd23733cb0\n </TASK>\n\n\n---\nIf you want syzbot to run the reproducer, reply with:\n#syz test: git://repo/address.git branch-or-commit-hash\nIf you attach or paste a git patch, syzbot will apply it before testing.\n",
          "reply_to": ""
        },
        {
          "author": "Joanne Koong",
          "summary": "Joanne Koong raised a concern that the ifs bitmap is not updated when ntfs3 handles writes for compressed files through its own interface, which doesn't go through iomap. She suggests either removing the WARN_ON_ONCE condition or making a modified version of iomap_set_range_uptodate() public.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "requested changes"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "On Thu, Feb 19, 2026 at 12:51â€¯PM syzbot\n<syzbot+d3a62bea0e61f9d121da@syzkaller.appspotmail.com> wrote:\n>\n> syzbot has found a reproducer for the following issue on:\n>\n> HEAD commit:    2b7a25df823d Merge tag 'mm-nonmm-stable-2026-02-18-19-56' ..\n> git tree:       upstream\n> console output: https://syzkaller.appspot.com/x/log.txt?x=10c21722580000\n> kernel config:  https://syzkaller.appspot.com/x/.config?x=65722f41f7edc17e\n> dashboard link: https://syzkaller.appspot.com/bug?extid=d3a62bea0e61f9d121da\n> compiler:       Debian clang version 21.1.8 (++20251221033036+2078da43e25a-1~exp1~20251221153213.50), Debian LLD 21.1.8\n> syz repro:      https://syzkaller.appspot.com/x/repro.syz?x=1501dc02580000\n> C reproducer:   https://syzkaller.appspot.com/x/repro.c?x=1357f652580000\n>\n> Downloadable assets:\n> disk image (non-bootable): https://storage.googleapis.com/syzbot-assets/d900f083ada3/non_bootable_disk-2b7a25df.raw.xz\n> vmlinux: https://storage.googleapis.com/syzbot-assets/f3a54d09b17c/vmlinux-2b7a25df.xz\n> kernel image: https://storage.googleapis.com/syzbot-assets/fb704901bce5/bzImage-2b7a25df.xz\n> mounted in repro: https://storage.googleapis.com/syzbot-assets/b778b9903de5/mount_0.gz\n>\n> IMPORTANT: if you fix the issue, please add the following tag to the commit:\n> Reported-by: syzbot+d3a62bea0e61f9d121da@syzkaller.appspotmail.com\n>\n> ------------[ cut here ]------------\n> ifs_is_fully_uptodate(folio, ifs) != folio_test_uptodate(folio)\n> WARNING: fs/iomap/buffered-io.c:256 at ifs_free+0x358/0x420 fs/iomap/buffered-io.c:255, CPU#0: syz-executor/5453\n> Modules linked in:\n> CPU: 0 UID: 0 PID: 5453 Comm: syz-executor Not tainted syzkaller #0 PREEMPT(full)\n> Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 1.16.3-debian-1.16.3-2 04/01/2014\n> RIP: 0010:ifs_free+0x358/0x420 fs/iomap/buffered-io.c:255\n> Code: 41 5f 5d e9 7a fb bd ff e8 45 5a 5e ff 90 0f 0b 90 e9 d0 fe ff ff e8 37 5a 5e ff 90 0f 0b 90 e9 0a ff ff ff e8 29 5a 5e ff 90 <0f> 0b 90 eb c3 44 89 e1 80 e1 07 80 c1 03 38 c1 0f 8c 06 fe ff ff\n> RSP: 0018:ffffc9000dfcf688 EFLAGS: 00010293\n> RAX: ffffffff82674207 RBX: 0000000000000008 RCX: ffff88801f834900\n> RDX: 0000000000000000 RSI: 0000000000000008 RDI: 0000000000000000\n> RBP: 000000008267bc01 R08: ffffea00010fb747 R09: 1ffffd400021f6e8\n> R10: dffffc0000000000 R11: fffff9400021f6e9 R12: ffff888051c7da44\n> R13: ffff888051c7da00 R14: ffffea00010fb740 R15: 1ffffd400021f6e9\n> FS:  0000555586def500(0000) GS:ffff88808ca5b000(0000) knlGS:0000000000000000\n> CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n> CR2: 0000555586e0aa28 CR3: 00000000591fe000 CR4: 0000000000352ef0\n> Call Trace:\n>  <TASK>\n>  folio_invalidate mm/truncate.c:140 [inline]\n>  truncate_cleanup_folio+0xcb/0x190 mm/truncate.c:160\n>  truncate_inode_pages_range+0x2ce/0xe30 mm/truncate.c:404\n>  ntfs_evict_inode+0x19/0x40 fs/ntfs3/inode.c:1861\n>  evict+0x61e/0xb10 fs/inode.c:846\n>  dispose_list fs/inode.c:888 [inline]\n>  evict_inodes+0x75a/0x7f0 fs/inode.c:942\n>  generic_shutdown_super+0xaa/0x2d0 fs/super.c:632\n>  kill_block_super+0x44/0x90 fs/super.c:1725\n>  ntfs3_kill_sb+0x44/0x1c0 fs/ntfs3/super.c:1889\n>  deactivate_locked_super+0xbc/0x130 fs/super.c:476\n>  cleanup_mnt+0x437/0x4d0 fs/namespace.c:1312\n>  task_work_run+0x1d9/0x270 kernel/task_work.c:233\n>  resume_user_mode_work include/linux/resume_user_mode.h:50 [inline]\n>  __exit_to_user_mode_loop kernel/entry/common.c:67 [inline]\n>  exit_to_user_mode_loop+0xed/0x480 kernel/entry/common.c:98\n>  __exit_to_user_mode_prepare include/linux/irq-entry-common.h:226 [inline]\n>  syscall_exit_to_user_mode_prepare include/linux/irq-entry-common.h:256 [inline]\n>  syscall_exit_to_user_mode include/linux/entry-common.h:325 [inline]\n>  do_syscall_64+0x32d/0xf80 arch/x86/entry/syscall_64.c:100\n>  entry_SYSCALL_64_after_hwframe+0x77/0x7f\n> RIP: 0033:0x7fb0f859d897\n> Code: a2 c7 05 5c ee 24 00 00 00 00 00 eb 96 e8 e1 12 00 00 90 31 f6 e9 09 00 00 00 66 0f 1f 84 00 00 00 00 00 b8 a6 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 01 c3 48 c7 c2 e8 ff ff ff f7 d8 64 89 02 b8\n> RSP: 002b:00007ffd23732b28 EFLAGS: 00000246 ORIG_RAX: 00000000000000a6\n> RAX: 0000000000000000 RBX: 00007fb0f8631ef0 RCX: 00007fb0f859d897\n> RDX: 0000000000000000 RSI: 0000000000000009 RDI: 00007ffd23732be0\n> RBP: 00007ffd23732be0 R08: 00007ffd23733be0 R09: 00000000ffffffff\n> R10: 0000000000000000 R11: 0000000000000246 R12: 00007ffd23733c70\n> R13: 00007fb0f8631ef0 R14: 000000000001b126 R15: 00007ffd23733cb0\n>  </TASK>\n>\n\nI ran the repro locally to see if it's the same issue fixed by [1] but\nthis is a different unrelated issue.\n\nThe folio is uptodate but the ifs uptodate bitmap is not reflected as\nfully uptodate. I think this is because ntfs3 handles writes for\ncompressed files through its own interface that doesn't go through\niomap where it calls folio_mark_uptodate() but the ifs bitmap doesn't\nget updated. fuse-blk servers that operate in writethrough mode run\ninto something like this as well [2].\n\nThis doesn't lead to any data corruption issues. Should we get rid of\nthe  WARN_ON_ONCE(ifs_is_fully_uptodate(folio, ifs) !=\nfolio_test_uptodate(folio))? The alternative is to make a modified\nversion of the functionality in \"iomap_set_range_uptodate()\" a public\napi callable by subsystems.\n\nThanks,\nJoanne\n\n[1] https://lore.kernel.org/linux-fsdevel/20260219003911.344478-1-joannelkoong@gmail.com/\n[2] https://lore.kernel.org/linux-fsdevel/20251223223018.3295372-2-sashal@kernel.org/\n",
          "reply_to": "syzbot"
        },
        {
          "author": "Christoph Hellwig",
          "summary": "Christoph Hellwig prefers that the NTFS3 filesystem explain their modifications to the buffered read code instead of having them 'papered over' in a patch.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "NEEDS_WORK"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "On Thu, Feb 19, 2026 at 04:46:58PM -0800, Joanne Koong wrote:\n> The folio is uptodate but the ifs uptodate bitmap is not reflected as\n> fully uptodate. I think this is because ntfs3 handles writes for\n> compressed files through its own interface that doesn't go through\n> iomap where it calls folio_mark_uptodate() but the ifs bitmap doesn't\n> get updated. fuse-blk servers that operate in writethrough mode run\n> into something like this as well [2].\n> \n> This doesn't lead to any data corruption issues. Should we get rid of\n> the  WARN_ON_ONCE(ifs_is_fully_uptodate(folio, ifs) !=\n> folio_test_uptodate(folio))? The alternative is to make a modified\n> version of the functionality in \"iomap_set_range_uptodate()\" a public\n> api callable by subsystems.\n\nI'd honestly rather have ntfs3 come along and explain what their\ndoing.  They've copy and pasted large chunks of the buffered\nread code for now reason, which already annoys me and I'd rather\nnot paper over random misuses.\n\n\n",
          "reply_to": "Joanne Koong"
        }
      ],
      "analysis_source": "llm-per-reviewer"
    }
  }
}
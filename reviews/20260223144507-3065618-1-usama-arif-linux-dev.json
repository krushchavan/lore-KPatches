{
  "thread_id": "20260223144507.3065618-1-usama.arif@linux.dev",
  "subject": "Re: [PATCH v1 01/11] relay: zero page->private when freeing pages",
  "url": "https://lore.kernel.org/all/20260223144507.3065618-1-usama.arif@linux.dev/",
  "dates": {
    "2026-02-22": {
      "report_file": "2026-02-23_ollama_llama3.1-8b.html",
      "developer": "Usama Arif",
      "reviews": [
        {
          "author": "Zi Yan (author)",
          "summary": "The author is addressing a concern about the relay code not zeroing page->private when freeing pages. They have added checks to set page-private to zero in the depopulate and relay_destroy_buf functions, which will be included in the upcoming patch.",
          "sentiment": "positive",
          "sentiment_signals": [
            "added checks",
            "included in upcoming patch"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "This prepares for upcoming page->private checks in page freeing path.\n\nSigned-off-by: Zi Yan <ziy@nvidia.com>\nCc: Jason Xing <kernelxing@tencent.com>\nCc: Yushan Zhou <katrinzhou@tencent.com>\nCc: \"Masami Hiramatsu (Google)\" <mhiramat@kernel.org>\n---\n kernel/relay.c | 8 ++++++--\n 1 file changed, 6 insertions(+), 2 deletions(-)\n\ndiff --git a/kernel/relay.c b/kernel/relay.c\nindex 5c665b729132..d16f9966817f 100644\n--- a/kernel/relay.c\n+++ b/kernel/relay.c\n@@ -131,8 +131,10 @@ static void *relay_alloc_buf(struct rchan_buf *buf, size_t *size)\n \treturn mem;\n \n depopulate:\n-\tfor (j = 0; j < i; j++)\n+\tfor (j = 0; j < i; j++) {\n+\t\tset_page_private(buf->page_array[i], 0);\n \t\t__free_page(buf->page_array[j]);\n+\t}\n \trelay_free_page_array(buf->page_array);\n \treturn NULL;\n }\n@@ -196,8 +198,10 @@ static void relay_destroy_buf(struct rchan_buf *buf)\n \n \tif (likely(buf->start)) {\n \t\tvunmap(buf->start);\n-\t\tfor (i = 0; i < buf->page_count; i++)\n+\t\tfor (i = 0; i < buf->page_count; i++) {\n+\t\t\tset_page_private(buf->page_array[i], 0);\n \t\t\t__free_page(buf->page_array[i]);\n+\t\t}\n \t\trelay_free_page_array(buf->page_array);\n \t}\n \t*per_cpu_ptr(chan->buf, buf->cpu) = NULL;\n-- \n2.51.0",
          "reply_to": "",
          "message_date": "2026-02-22"
        },
        {
          "author": "Zi Yan (author)",
          "summary": "Author addressed a concern about setting page->private to zero in the __free_pages_prepare() path and explained that this patch prepares for upcoming checks in the page freeing path.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "clarification",
            "preparation"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "This prepares for upcoming checks in page freeing path.\n\nSigned-off-by: Zi Yan <ziy@nvidia.com>\nCc: Vlastimil Babka <vbabka@kernel.org>\nCc: Christoph Lameter <cl@gentwo.org>\nCc: David Rientjes <rientjes@google.com>\nCc: Roman Gushchin <roman.gushchin@linux.dev>\nCc: Harry Yoo <harry.yoo@oracle.com>\nCc: linux-mm@kvack.org\n---\n mm/slub.c | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/mm/slub.c b/mm/slub.c\nindex 865bc050f654..012c71e7b488 100644\n--- a/mm/slub.c\n+++ b/mm/slub.c\n@@ -3511,6 +3511,7 @@ static void __free_slab(struct kmem_cache *s, struct slab *slab, bool allow_spin\n \n \t__slab_clear_pfmemalloc(slab);\n \tpage->mapping = NULL;\n+\tset_page_private(page, 0);\n \t__ClearPageSlab(page);\n \tmm_account_reclaimed_pages(pages);\n \tunaccount_slab(slab, order, s, allow_spin);\n-- \n2.51.0",
          "reply_to": "",
          "message_date": "2026-02-22"
        },
        {
          "author": "Zi Yan (author)",
          "summary": "The author is addressing a concern about the patch not zeroing page->private in all cases, specifically mentioning that upcoming checks will be added to the page freeing path.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "acknowledged fix needed"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "This prepares upcoming checks in page freeing path.\n\nSigned-off-by: Zi Yan <ziy@nvidia.com>\nCc: Christian Koenig <christian.koenig@amd.com>\nCc: Huang Rui <ray.huang@amd.com>\nCc: Matthew Auld <matthew.auld@intel.com>\nCc: Matthew Brost <matthew.brost@intel.com>\nCc: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>\nCc: Maxime Ripard <mripard@kernel.org>\nCc: Thomas Zimmermann <tzimmermann@suse.de>\nCc: David Airlie <airlied@gmail.com>\nCc: Simona Vetter <simona@ffwll.ch>\nCc: dri-devel@lists.freedesktop.org\n---\n drivers/gpu/drm/ttm/ttm_pool.c | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/drivers/gpu/drm/ttm/ttm_pool.c b/drivers/gpu/drm/ttm/ttm_pool.c\nindex 217e45958099..a85cf1582dc8 100644\n--- a/drivers/gpu/drm/ttm/ttm_pool.c\n+++ b/drivers/gpu/drm/ttm/ttm_pool.c\n@@ -210,6 +210,7 @@ static void ttm_pool_free_page(struct ttm_pool *pool, enum ttm_caching caching,\n #endif\n \n \tif (!pool || !ttm_pool_uses_dma_alloc(pool)) {\n+\t\tset_page_private(p, 0);\n \t\t__free_pages(p, order);\n \t\treturn;\n \t}\n-- \n2.51.0",
          "reply_to": "",
          "message_date": "2026-02-22"
        },
        {
          "author": "Zi Yan (author)",
          "summary": "The author is addressing a concern about the patch not preparing for upcoming checks in the page freeing path, and they confirm that their recent change prepares for these checks.",
          "sentiment": "positive",
          "sentiment_signals": [
            "acknowledged",
            "confirmed"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "This prepares for upcoming checks in page freeing path.\n\nSigned-off-by: Zi Yan <ziy@nvidia.com>\nCc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>\nCc: \"Arve Hjnnevg\" <arve@android.com>\nCc: Todd Kjos <tkjos@android.com>\nCc: Christian Brauner <brauner@kernel.org>\nCc: Carlos Llamas <cmllamas@google.com>\nCc: Alice Ryhl <aliceryhl@google.com>\n---\n drivers/android/binder_alloc.c | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/drivers/android/binder_alloc.c b/drivers/android/binder_alloc.c\nindex 67a068c075c0..5c960513c7bc 100644\n--- a/drivers/android/binder_alloc.c\n+++ b/drivers/android/binder_alloc.c\n@@ -306,6 +306,7 @@ static struct page *binder_page_alloc(struct binder_alloc *alloc,\n static void binder_free_page(struct page *page)\n {\n \tkfree((struct binder_shrinker_mdata *)page_private(page));\n+\tset_page_private(page, 0);\n \t__free_page(page);\n }\n \n-- \n2.51.0",
          "reply_to": "",
          "message_date": "2026-02-22"
        },
        {
          "author": "Zi Yan (author)",
          "summary": "The author is addressing a concern about the watch_queue.c patch, specifically that it doesn't zero page->private when freeing pages. The author has added code to set_page_private(0) before __free_page() in both watch_queue_set_size and __put_watch_queue functions.",
          "sentiment": "positive",
          "sentiment_signals": [
            "acknowledged fix needed",
            "added code"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "This prepares for upcoming checks in page freeing path.\n\nSigned-off-by: Zi Yan <ziy@nvidia.com>\nCc: Christian Brauner <brauner@kernel.org>\nCc: K Prateek Nayak <kprateek.nayak@amd.com>\nCc: Davidlohr Bueso <dave@stgolabs.net>\nCc: Eric Sandeen <sandeen@redhat.com>\n---\n kernel/watch_queue.c | 8 ++++++--\n 1 file changed, 6 insertions(+), 2 deletions(-)\n\ndiff --git a/kernel/watch_queue.c b/kernel/watch_queue.c\nindex 52f89f1137da..8f887eafd438 100644\n--- a/kernel/watch_queue.c\n+++ b/kernel/watch_queue.c\n@@ -301,8 +301,10 @@ long watch_queue_set_size(struct pipe_inode_info *pipe, unsigned int nr_notes)\n \treturn 0;\n \n error_p:\n-\twhile (--i >= 0)\n+\twhile (--i >= 0) {\n+\t\tset_page_private(pages[i], 0);\n \t\t__free_page(pages[i]);\n+\t}\n \tkfree(pages);\n error:\n \t(void) account_pipe_buffers(pipe->user, nr_pages, pipe->nr_accounted);\n@@ -398,8 +400,10 @@ static void __put_watch_queue(struct kref *kref)\n \tstruct watch_filter *wfilter;\n \tint i;\n \n-\tfor (i = 0; i < wqueue->nr_pages; i++)\n+\tfor (i = 0; i < wqueue->nr_pages; i++) {\n+\t\tset_page_private(wqueue->notes[i], 0);\n \t\t__free_page(wqueue->notes[i]);\n+\t}\n \tkfree(wqueue->notes);\n \tbitmap_free(wqueue->notes_bitmap);\n \n-- \n2.51.0",
          "reply_to": "",
          "message_date": "2026-02-22"
        },
        {
          "author": "Zi Yan (author)",
          "summary": "The author is addressing a concern about the patch not zeroing page->private in all cases when freeing pages, specifically in the block/blk-mq-tag.c file. The author has added checks to ensure that page->private is set to zero before freeing the page.",
          "sentiment": "positive",
          "sentiment_signals": [
            "added checks",
            "set_page_private"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "This prepares for upcoming checks in page freeing path.\n\nSigned-off-by: Zi Yan <ziy@nvidia.com>\nCc: Jens Axboe <axboe@kernel.dk>\nCc: linux-block@vger.kernel.org\n---\n block/blk-mq-tag.c | 6 +++++-\n 1 file changed, 5 insertions(+), 1 deletion(-)\n\ndiff --git a/block/blk-mq-tag.c b/block/blk-mq-tag.c\nindex 33946cdb5716..2d4bdf8df51d 100644\n--- a/block/blk-mq-tag.c\n+++ b/block/blk-mq-tag.c\n@@ -589,14 +589,18 @@ static void blk_mq_free_tags_callback(struct rcu_head *head)\n \tstruct page *page;\n \n \twhile (!list_empty(&tags->page_list)) {\n+\t\tint order;\n+\n \t\tpage = list_first_entry(&tags->page_list, struct page, lru);\n \t\tlist_del_init(&page->lru);\n+\t\torder = page->private;\n \t\t/*\n \t\t * Remove kmemleak object previously allocated in\n \t\t * blk_mq_alloc_rqs().\n \t\t */\n \t\tkmemleak_free(page_address(page));\n-\t\t__free_pages(page, page->private);\n+\t\tset_page_private(page, 0);\n+\t\t__free_pages(page, order);\n \t}\n \tkfree(tags);\n }\n-- \n2.51.0",
          "reply_to": "",
          "message_date": "2026-02-22"
        },
        {
          "author": "Zi Yan (author)",
          "summary": "The author is addressing a concern about the patch not zeroing page->private in all cases, specifically in the pcpu_free_pages function. The author has added code to set_page_private(page, 0) before freeing the page.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "acknowledged fix needed"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "This prepares for upcoming checks in page freeing path.\n\nSigned-off-by: Zi Yan <ziy@nvidia.com>\nCc: Dennis Zhou <dennis@kernel.org>\nCc: Tejun Heo <tj@kernel.org>\nCc: Christoph Lameter <cl@gentwo.org>\nCc: linux-mm@kvack.org\n---\n mm/percpu-vm.c | 4 +++-\n 1 file changed, 3 insertions(+), 1 deletion(-)\n\ndiff --git a/mm/percpu-vm.c b/mm/percpu-vm.c\nindex 4f5937090590..edc8f4448a8e 100644\n--- a/mm/percpu-vm.c\n+++ b/mm/percpu-vm.c\n@@ -61,8 +61,10 @@ static void pcpu_free_pages(struct pcpu_chunk *chunk,\n \t\tfor (i = page_start; i < page_end; i++) {\n \t\t\tstruct page *page = pages[pcpu_page_idx(cpu, i)];\n \n-\t\t\tif (page)\n+\t\t\tif (page) {\n+\t\t\t\tset_page_private(page, 0);\n \t\t\t\t__free_page(page);\n+\t\t\t}\n \t\t}\n \t}\n }\n-- \n2.51.0",
          "reply_to": "",
          "message_date": "2026-02-22"
        },
        {
          "author": "Zi Yan (author)",
          "summary": "The author is addressing a concern that the patch does not handle compound pages correctly. They responded by explaining that their patch only handles simple pages and that handling compound pages will be addressed in a future version of the patch.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "acknowledged fix needed"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "This prepares for upcoming checks in page freeing path.\n\nSigned-off-by: Zi Yan <ziy@nvidia.com>\nCc: Gao Xiang <xiang@kernel.org>\nCc: Yue Hu <zbestahu@gmail.com>\nCc: Jeffle Xu <jefflexu@linux.alibaba.com>\nCc: Sandeep Dhavale <dhavale@google.com>\nCc: Hongbo Li <lihongbo22@huawei.com>\nCc: Chunhai Guo <guochunhai@vivo.com>\nCc: linux-erofs@lists.ozlabs.org\n---\n fs/erofs/zutil.c | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/fs/erofs/zutil.c b/fs/erofs/zutil.c\nindex 55ff2ab5128e..94310b70e6af 100644\n--- a/fs/erofs/zutil.c\n+++ b/fs/erofs/zutil.c\n@@ -210,6 +210,7 @@ void erofs_release_pages(struct page **pagepool)\n \t\t\t}\n \t\t\tspin_unlock(&z_erofs_rsvbuf->lock);\n \t\t}\n+\t\tset_page_private(page, 0);\n \t\tput_page(page);\n \t}\n }\n-- \n2.51.0",
          "reply_to": "",
          "message_date": "2026-02-22"
        },
        {
          "author": "Zi Yan (author)",
          "summary": "Author acknowledged that the commit 4265d67e405a removed the setting of page->private in tail pages without a proper reason and added it back to fix this issue.",
          "sentiment": "positive",
          "sentiment_signals": [
            "acknowledged",
            "added it back"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "page->private should not be set in tail pages. Commit 4265d67e405a\n(\"mm/migrate_device: add THP splitting during migration\") removed it\nwithout a proper reason. Add it back.\n\nSigned-off-by: Zi Yan <ziy@nvidia.com>\nCc: David Hildenbrand <david@kernel.org>\nCc: Lorenzo Stoakes <lorenzo.stoakes@oracle.com>\nCc: Baolin Wang <baolin.wang@linux.alibaba.com>\nCc: \"Liam R. Howlett\" <Liam.Howlett@oracle.com>\nCc: Nico Pache <npache@redhat.com>\nCc: Ryan Roberts <ryan.roberts@arm.com>\nCc: Dev Jain <dev.jain@arm.com>\nCc: Barry Song <baohua@kernel.org>\nCc: Lance Yang <lance.yang@linux.dev>\nCc: linux-mm@kvack.org\n---\n mm/huge_memory.c | 10 ++++++++++\n 1 file changed, 10 insertions(+)\n\ndiff --git a/mm/huge_memory.c b/mm/huge_memory.c\nindex 27316d741927..6b57d219fc97 100644\n--- a/mm/huge_memory.c\n+++ b/mm/huge_memory.c\n@@ -3548,6 +3548,16 @@ static void __split_folio_to_order(struct folio *folio, int old_order,\n \t\tnew_folio->mapping = folio->mapping;\n \t\tnew_folio->index = folio->index + i;\n \n+\t\t/*\n+\t\t * page->private should not be set in tail pages. Fix up and warn once\n+\t\t * if private is unexpectedly set. Do it before swap.val assignment\n+\t\t * since private overlaps with swap.val.\n+\t\t */\n+\t\tif (unlikely(new_folio->private)) {\n+\t\t\tVM_WARN_ON_ONCE_PAGE(true, new_head);\n+\t\t\tnew_folio->private = NULL;\n+\t\t}\n+\n \t\tif (folio_test_swapcache(folio))\n \t\t\tnew_folio->swap.val = folio->swap.val + i;\n \n-- \n2.51.0",
          "reply_to": "",
          "message_date": "2026-02-22"
        },
        {
          "author": "Zi Yan (author)",
          "summary": "The author is addressing a concern about the VM_WARN_ON_ONCE check in __free_pages_prepare() not being sufficient to ensure page->private is zeroed, and they are adding an explicit zeroing of page->private before the check.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "acknowledges fix needed",
            "adds additional code"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "Any user is supposed to zero their allocated page->private at free time,\nincluding both head and tail pages if the freed page is compound. Add\nVM_WARN_ON_ONCE to check page->private.\n\nWhoever encountering warnings from this commit needs to fix code that\ndoes not zero ->private when freeing a page/folio.\n\nSigned-off-by: Zi Yan <ziy@nvidia.com>\nCc: Vlastimil Babka <vbabka@kernel.org>\nCc: Suren Baghdasaryan <surenb@google.com>\nCc: Michal Hocko <mhocko@suse.com>\nCc: Brendan Jackman <jackmanb@google.com>\nCc: Johannes Weiner <hannes@cmpxchg.org>\nCc: linux-mm@kvack.org\n---\n mm/page_alloc.c | 3 ++-\n 1 file changed, 2 insertions(+), 1 deletion(-)\n\ndiff --git a/mm/page_alloc.c b/mm/page_alloc.c\nindex d88c8c67ac0b..d8b7f36e9364 100644\n--- a/mm/page_alloc.c\n+++ b/mm/page_alloc.c\n@@ -1410,6 +1410,7 @@ __always_inline bool __free_pages_prepare(struct page *page,\n \t\t\t\t}\n \t\t\t}\n \t\t\t(page + i)->flags.f &= ~PAGE_FLAGS_CHECK_AT_PREP;\n+\t\t\tVM_WARN_ON_ONCE((page + i)->private);\n \t\t}\n \t}\n \tif (folio_test_anon(folio)) {\n@@ -1429,7 +1430,7 @@ __always_inline bool __free_pages_prepare(struct page *page,\n \n \tpage_cpupid_reset_last(page);\n \tpage->flags.f &= ~PAGE_FLAGS_CHECK_AT_PREP;\n-\tpage->private = 0;\n+\tVM_WARN_ON_ONCE(page->private);\n \treset_page_owner(page, order);\n \tpage_table_check_free(page, order);\n \tpgalloc_tag_sub(page, 1 << order);\n-- \n2.51.0",
          "reply_to": "",
          "message_date": "2026-02-22"
        },
        {
          "author": "Zi Yan (author)",
          "summary": "The author is addressing a concern about the patch not setting page-private to zero in all cases, specifically mentioning that it prepares for upcoming checks in the page freeing path.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "acknowledges fix needed"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "This prepares for upcoming checks in page freeing path.\n\nSigned-off-by: Zi Yan <ziy@nvidia.com>\nCc: Jens Axboe <axboe@kernel.dk>\nCc: Damien Le Moal <dlemoal@kernel.org>\nCc: Johannes Thumshirn <johannes.thumshirn@wdc.com>\nCc: linux-block@vger.kernel.org\n---\n drivers/block/null_blk/main.c | 1 +\n 1 file changed, 1 insertion(+)\n\ndiff --git a/drivers/block/null_blk/main.c b/drivers/block/null_blk/main.c\nindex 740a8ac42075..86ea2644080f 100644\n--- a/drivers/block/null_blk/main.c\n+++ b/drivers/block/null_blk/main.c\n@@ -886,6 +886,7 @@ static void null_free_page(struct nullb_page *t_page)\n \t__set_bit(NULLB_PAGE_FREE, t_page->bitmap);\n \tif (test_bit(NULLB_PAGE_LOCK, t_page->bitmap))\n \t\treturn;\n+\tset_page_private(t_page->page, 0);\n \t__free_page(t_page->page);\n \tkfree(t_page);\n }\n-- \n2.51.0",
          "reply_to": "",
          "message_date": "2026-02-22"
        }
      ],
      "analysis_source": "llm-per-reviewer"
    },
    "2026-02-23": {
      "report_file": "2026-02-23_ollama_llama3.1-8b.html",
      "developer": "Usama Arif",
      "reviews": [
        {
          "author": "Matthew Wilcox",
          "summary": "Matthew Wilcox questioned the necessity of zeroing out page->private before freeing, suggesting it's already cleared in the allocation path and should be split_page()'s responsibility.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "requested changes"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "Sorry, I didn't notice this conversation.  It seems entirely unnecessary\nto me to zero out page->private before freeing.\n\nI'm a bit confused that ac1ea219590c was needed too; I thought we\ncleared page->private in the allocation path, and I don't see why\nit needs to be cleared in the freeing path.  split_page() should be\nclearing page->private.\n\nCan we discuss this at the THP Cabal meeting on Wednesday?  I don't\nthink that introducing this new rule that page->private must be cleared\nby the users is a good idea.",
          "reply_to": "Zi Yan",
          "message_date": "2026-02-23"
        },
        {
          "author": "syzbot ci",
          "summary": "The reviewer (syzbot ci) reported a WARNING in __free_frozen_pages due to page->private not being zeroed when freeing pages, which was detected by syzkaller testing the patch series.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "WARNING",
            "NEEDS_WORK"
          ],
          "has_inline_review": true,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "syzbot ci has tested the following series\n\n[v1] Zero page->private when freeing pages\nhttps://lore.kernel.org/all/20260223032641.1859381-1-ziy@nvidia.com\n* [PATCH v1 01/11] relay: zero page->private when freeing pages\n* [PATCH v1 02/11] mm/slub: zero page->private when freeing pages\n* [PATCH v1 03/11] drm/ttm: zero page->private when freeing pages\n* [PATCH v1 04/11] blk-mq: zero page->private when freeing pages\n* [PATCH v1 05/11] watch_queue: zero page->private when freeing pages\n* [PATCH v1 06/11] binder: zero page->private when freeing pages\n* [PATCH v1 07/11] null_blk: zero page->private when freeing pages\n* [PATCH v1 08/11] percpu: zero page->private when freeing pages\n* [PATCH v1 09/11] erofs: zero page->private when freeing pages\n* [PATCH v1 10/11] mm/huge_memory: add page->private check back in __split_folio_to_order()\n* [PATCH v1 11/11] mm/page_alloc: check page->private upon page free\n\nand found the following issue:\nWARNING in __free_frozen_pages\n\nFull report is available here:\nhttps://ci.syzbot.org/series/10f470ac-46ac-4e38-902d-dc86ae743494\n\n***\n\nWARNING in __free_frozen_pages\n\ntree:      mm-new\nURL:       https://kernel.googlesource.com/pub/scm/linux/kernel/git/akpm/mm.git\nbase:      a6fdc327de4678e54b5122441c970371014117b0\narch:      amd64\ncompiler:  Debian clang version 21.1.8 (++20251221033036+2078da43e25a-1~exp1~20251221153213.50), Debian LLD 21.1.8\nconfig:    https://ci.syzbot.org/builds/0586347c-8ef1-427f-8a9c-7f6c08b616a9/config\n\nBluetooth: RFCOMM ver 1.11\nBluetooth: BNEP (Ethernet Emulation) ver 1.3\nBluetooth: BNEP filters: protocol multicast\nBluetooth: BNEP socket layer initialized\nBluetooth: HIDP (Human Interface Emulation) ver 1.2\nBluetooth: HIDP socket layer initialized\nNET: Registered PF_RXRPC protocol family\nKey type rxrpc registered\nKey type rxrpc_s registered\nNET: Registered PF_KCM protocol family\nlec:lane_module_init: lec.c: initialized\nmpoa:atm_mpoa_init: mpc.c: initialized\nl2tp_core: L2TP core driver, V2.0\nl2tp_ppp: PPPoL2TP kernel driver, V2.0\nl2tp_ip: L2TP IP encapsulation support (L2TPv3)\nl2tp_netlink: L2TP netlink interface\nl2tp_eth: L2TP ethernet pseudowire support (L2TPv3)\nl2tp_ip6: L2TP IP encapsulation support for IPv6 (L2TPv3)\nNET: Registered PF_PHONET protocol family\n8021q: 802.1Q VLAN Support v1.8\nsctp: Hash tables configured (bind 32/56)\nNET: Registered PF_RDS protocol family\nRegistered RDS/infiniband transport\nRegistered RDS/tcp transport\ntipc: Activated (version 2.0.0)\nNET: Registered PF_TIPC protocol family\ntipc: Started in single node mode\nsmc: adding smcd device lo without pnetid\nNET: Registered PF_SMC protocol family\n9pnet: Installing 9P2000 support\nNET: Registered PF_CAIF protocol family\nNET: Registered PF_IEEE802154 protocol family\nKey type dns_resolver registered\nKey type ceph registered\nlibceph: loaded (mon/osd proto 15/24)\nbatman_adv: B.A.T.M.A.N. advanced 2025.5 (compatibility version 15) loaded\nopenvswitch: Open vSwitch switching datapath\nNET: Registered PF_VSOCK protocol family\nmpls_gso: MPLS GSO support\nIPI shorthand broadcast: enabled\nsched_clock: Marking stable (19970046340, 93374727)->(20073238384, -9817317)\nregistered taskstats version 1\nLoading compiled-in X.509 certificates\nLoaded X.509 cert 'Build time autogenerated kernel key: 98092a222e11368da223b039d625e21c3e2e069c'\nzswap: loaded using pool 842\nDemotion targets for Node 0: null\nDemotion targets for Node 1: null\ndebug_vm_pgtable: [debug_vm_pgtable         ]: Validating architecture page table helpers\n------------[ cut here ]------------\npage->private\nWARNING: mm/page_alloc.c:1433 at __free_frozen_pages+0x78e/0xe10, CPU#0: swapper/0/1\nModules linked in:\nCPU: 0 UID: 0 PID: 1 Comm: swapper/0 Not tainted syzkaller #0 PREEMPT(full) \nHardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 1.16.2-debian-1.16.2-1 04/01/2014\nRIP: 0010:__free_frozen_pages+0x78e/0xe10\nCode: 5f 5d e9 05 1e 00 00 48 b8 00 00 00 00 00 fc ff df 0f b6 44 05 00 84 c0 0f 85 d7 02 00 00 c7 03 ff ff ff ff e9 22 fc ff ff 90 <0f> 0b 90 e9 8d fc ff ff bd 01 00 00 00 83 f8 05 0f 85 bb fe ff ff\nRSP: 0000:ffffc900000676e0 EFLAGS: 00010282\nRAX: 1ffffd4000bad935 RBX: ffffea0005d6c9a8 RCX: dffffc0000000000\nRDX: 0000000000000000 RSI: 0000000000000004 RDI: ffffea0005d6c9b4\nRBP: ffffea0005d6c9b8 R08: ffffea0005d6c9b7 R09: 1ffffd4000bad936\nR10: dffffc0000000000 R11: fffff94000bad937 R12: ffffea0005d6c980\nR13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000\nFS:  0000000000000000(0000) GS:ffff88818de64000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: ffff88823ffff000 CR3: 000000000e54c000 CR4: 00000000000006f0\nCall Trace:\n <TASK>\n destroy_args+0x15d/0x570\n debug_vm_pgtable+0x3f8/0x410\n do_one_initcall+0x250/0x8d0\n do_initcall_level+0x104/0x190\n do_initcalls+0x59/0xa0\n kernel_init_freeable+0x2a6/0x3e0\n kernel_init+0x1d/0x1d0\n ret_from_fork+0x51e/0xb90\n ret_from_fork_asm+0x1a/0x30\n </TASK>\n\n\n***\n\nIf these findings have caused you to resend the series or submit a\nseparate fix, please add the following tag to your commit message:\n  Tested-by: syzbot@syzkaller.appspotmail.com\n\n---\nThis report is generated by a bot. It may contain errors.\nsyzbot ci engineers can be reached at syzkaller@googlegroups.com.",
          "reply_to": "Zi Yan",
          "message_date": "2026-02-23"
        },
        {
          "author": "David (Arm)",
          "summary": "David (Arm) noted that the patch does not address the issue of compound pages, where both head and tail pages need to have ->private set to zero.\n\nThe reviewer notes that the patch's benefit lies in only zeroing out page->private for users who actually use it, implying that all pages entering and leaving the page allocator will have page->private initialized.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "compound page handling",
            "NEEDS_WORK"
          ],
          "has_inline_review": true,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "See discussion at \nhttps://lore.kernel.org/linux-mm/cbc3b5b3-09b5-4e3c-99f0-a1f67582afff@kernel.org/\n\n---\n\nThe benefit is that only the users that really use page->private will \nalso zero it out.\n\nThis implies that all pages that enter+leave the page allocator will \nhave page->private initialized and we can also likely do:\n\ndiff --git a/mm/internal.h b/mm/internal.h\nindex 9e0577413087..4ecdae78e0d2 100644\n--- a/mm/internal.h\n+++ b/mm/internal.h\n@@ -724,7 +724,6 @@ static inline void prep_compound_tail(struct page \n*head, int tail_idx)\n\n         p->mapping = TAIL_MAPPING;\n         set_compound_head(p, head);\n-       set_page_private(p, 0);\n  }\n\n  extern void prep_compound_page(struct page *page, unsigned int order);\n\n\nWhich is rather nice.\n\n-- \nCheers,\n\nDavid",
          "reply_to": "Matthew Wilcox",
          "message_date": "2026-02-23"
        },
        {
          "author": "Christian König",
          "summary": "Reviewer questioned the necessity of patch 11, suggesting that __free_pages() should be responsible for zeroing page->private",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "question",
            "potential duplication of effort"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Acked-by"
          ],
          "analysis_source": "llm",
          "raw_body": "Acked-by: Christian Knig <christian.koenig@amd.com>\n\nQuestion (which was potentially already discussed) why isn't __free_pages() doing that?\n\nRegards,\nChristian.",
          "reply_to": "Zi Yan",
          "message_date": "2026-02-23"
        },
        {
          "author": "Christoph Hellwig",
          "summary": "Reviewer Christoph Hellwig suggested avoiding requiring users to explicitly clear the private field before freeing pages, considering it an awkward interface.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "requested changes"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "Requiring the user to clear a field before freeing is just a way to\nawkward interface.  Don't do that.",
          "reply_to": "Zi Yan",
          "message_date": "2026-02-23"
        },
        {
          "author": "Zi Yan (author)",
          "summary": "The author acknowledges the reviewer's concern about requiring users to return a zero ->private when freeing pages and defends their approach by citing common standards in software development.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "acknowledges concern",
            "defends approach"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "Page allocator hands the user a zero ->private. I think it is reasonable\nto require the user to return a zero ->private. Restoring things back\nto their original states is a common standard, isn't it? And most of\nusers do that.\n\nDo you have any example that shows doing such a thing is difficult,\nif not impossible?\n\n\n--\nBest Regards,\nYan, Zi",
          "reply_to": "Christoph Hellwig",
          "message_date": "2026-02-23"
        },
        {
          "author": "Christoph Hellwig",
          "summary": "The reviewer pointed out that requiring private data pointers in all interfaces is unnecessary and would introduce numerous bugs.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "requested changes"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "No other relevant interface requires private data pointers, as that would\nbe silly and cause tons of bugs.",
          "reply_to": "Zi Yan",
          "message_date": "2026-02-23"
        },
        {
          "author": "Christian König",
          "summary": "Reviewer Christian König expressed concern that zeroing page->private upon freeing pages may not be necessary, as the cache lines backing this struct are likely accessed anyway on free/alloc operations.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "NEEDS_WORK"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "Completely agree. This is just asking for trouble.\n\nThe cache line(s) backing this struct page are most likely accessed anyway on free/alloc. So I don't see much extra overhead.\n\nRegards,\nChristian.",
          "reply_to": "Christoph Hellwig",
          "message_date": "2026-02-23"
        },
        {
          "author": "Zi Yan (author)",
          "summary": "Author asked Christoph Hellwig to provide a concrete example of how filesystems being affected by not zeroing page->private when freeing pages would cause bugs or make other functions hard to implement.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "request_for_clarification",
            "open_to_documentation"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "filesystems use ->private and zero it before freeing a page. Can you provide a concrete\nexample showing that requirement will cause bugs or make other functions hard to\nimplement? With good examples, we can document them and make sure MM handle them\nproperly (i.e., zeroing ->private for them).\n\n--\nBest Regards,\nYan, Zi",
          "reply_to": "Christoph Hellwig",
          "message_date": "2026-02-23"
        },
        {
          "author": "David (Arm)",
          "summary": "Reviewer David questioned whether the overhead of zeroing page->private in __free_pages_prepare() is tolerable, especially for larger orders, and noted that it's consistent with existing requirements to zero other fields.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "tolerable",
            "existing requirements"
          ],
          "has_inline_review": true,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "I think the question is more around handling non-head pages when freeing \nlarger orders. But maybe the overhead of zeroing page->private it there \nas well in __free_pages_prepare() is tolerable.\n\nI'll note, though, that we already require page->mapping and \npage->memcg_data of pages to be zeroed by the caller, so it's not \ncompletely crazy. (see page_expected_state)\n\n-- \nCheers,\n\nDavid",
          "reply_to": "Christian König",
          "message_date": "2026-02-23"
        },
        {
          "author": "Usama Arif",
          "summary": "Reviewer Usama Arif pointed out a potential indexing issue in the code, suggesting that the loop counter variable should be named 'j' instead of 'i', which is typically used for indexing into an array.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "question",
            "suggestion"
          ],
          "has_inline_review": true,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "Hi Zi,\n\nShould the index into page_array be j and not i over here?",
          "reply_to": "Zi Yan",
          "message_date": "2026-02-23"
        },
        {
          "author": "Christian König",
          "summary": "Reviewer Christian König expressed concern that the patch's approach of zeroing page->private upon freeing pages may not be effective, as it only addresses users who forget to do so, and suggested reconsidering this practice.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "concern about patch effectiveness",
            "suggestion for alternative approach"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "Well that's not defensive at all, basically everybody which forgets to do that can cause hard to debug trouble. Maybe that practice should be reconsidered.\n\nRegards,\nChristian.",
          "reply_to": "David (Arm)",
          "message_date": "2026-02-23"
        },
        {
          "author": "David (Arm)",
          "summary": "Reviewer noted that the patch's effort to clear page->private in __free_pages_prepare() may be redundant, as this function already iterates over all tail pages and clears their flags, including PAGE_FLAGS_CHECK_AT_PREP.\n\nThe reviewer pointed out that the patch already includes a mechanism to detect and handle issues like non-zero page->private when freeing pages, specifically through the check_pages= option and the page_expected_state() checks.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "requested_changes",
            "no clear signal"
          ],
          "has_inline_review": true,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "Right. We already iterate over all \"tail\" pages in \n__free_pages_prepare() to clear page flags\n\n\t(page + i)->flags.f &= ~PAGE_FLAGS_CHECK_AT_PREP;\n\nMaybe zeroing page->private there is not too bad.\n\n---\n\nRight, we do have check_pages= to activate the page_expected_state() \nchecks, where we will detect such problems.\n\n(including the mapcount being -1 etc.)\n\n-- \nCheers,\n\nDavid",
          "reply_to": "Christian König",
          "message_date": "2026-02-23"
        }
      ],
      "analysis_source": "llm-per-reviewer"
    }
  }
}
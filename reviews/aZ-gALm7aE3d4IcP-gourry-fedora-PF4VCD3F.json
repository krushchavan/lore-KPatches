{
  "thread_id": "aZ_gALm7aE3d4IcP@gourry-fedora-PF4VCD3F",
  "subject": "[LSF/MM/BPF TOPIC][RFC PATCH v4 00/27] Private Memory Nodes (w/ Compressed RAM)",
  "url": "https://lore.kernel.org/all/aZ_gALm7aE3d4IcP@gourry-fedora-PF4VCD3F/",
  "dates": {
    "2026-02-26": {
      "report_file": "2026-02-26_ollama_llama3.1-8b.html",
      "developer": "Gregory Price",
      "reviews": [
        {
          "author": "Gregory Price",
          "summary": "Raised concerns about the feasibility of a 1-to-1 mapping of node-to-pgmap for existing ZONE_DEVICE users, suggesting it may lead to performance issues on non-NUMA systems.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "NEEDS_WORK"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "On Thu, Feb 26, 2026 at 12:54:08AM -0500, Gregory Price wrote:\n> On Thu, Feb 26, 2026 at 02:27:24PM +1100, Alistair Popple wrote:\n> \n> > > If NUMA is the interface we want, then NODE_DATA is the right direction\n> > > regardless of struct page's future or what zone it lives in.\n> > > \n> > > There's no reason to keep per-page pgmap w/ device-to-node mappings.\n> > \n> > In reality I suspect that's already the case today. I'm not sure we need\n> > per-page pgmap.\n> >\n> \n> Probably, and maybe there's a good argument for stealing 80-90% of the\n> common surface here, shunting ZONE_DEVICE to use this instead of pgmap\n> before we go all the way to private nodes.\n> \n\nOut of curiosity i went digging through existing users, and it seems\nlike the average driver has 1-8 discrete pgmaps, with Nouveau being an\noutliar that does ad-hoc registering in 256MB chunks, with the relevant\nannoyance being the percpu_ref it uses to track lifetime of the pgmap,\nand the fact that they can be non-contiguous.\n\ntl;dr here:  a 1-to-1 mapping of node-to-pgmap isn't realistic for most\nexisting ZONE_DEVICE users, meaning a 1-op lookup (page->pgmap) turns\ninto a multi-op pointer chase on and range comparison.\n\nNot sure that turns out well for anyone (only on ZONE_DEVICE / managed\nnode users, all traditional nodes still have a simple pgdat or page->flag\nlookup to check membership).\n\nThere's an argument for trying to do this just for the sake of getting\npgmap out of struct page/folio, but this only deals with the problem on\nNUMA systems.\n\nFor non-numa systems the pgmap still probably ends up in folio_ext\n(assuming we get there), but even that might not be sufficient get LRU\nback.  Might need Willy's opinion here.\n\n~Gregory\n\n\n\n",
          "reply_to": "",
          "message_date": "2026-02-26",
          "message_id": ""
        }
      ],
      "analysis_source": "llm",
      "patch_summary": "The patch introduces Private Memory Nodes (PMNs) and Compressed RAM, aiming to improve memory management on NUMA systems."
    }
  }
}
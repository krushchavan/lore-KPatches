{
  "thread_id": "20260218111346.31243-1-mark@harmstone.com",
  "subject": "[PATCH] btrfs: fix error messages in btrfs_check_features()",
  "url": "https://lore.kernel.org/all/20260218111346.31243-1-mark@harmstone.com/",
  "dates": {
    "2026-02-18": {
      "report_file": "2026-02-18_ollama_llama3.1-8b.html",
      "developer": "Mark Harmstone",
      "reviews": [
        {
          "author": "Qu Wenruo",
          "summary": "Reviewed the patch and found it to be correct. The error handling in btrfs_check_features() now behaves as expected, only printing unrecognized flags.",
          "sentiment": "positive",
          "sentiment_signals": [
            "LGTM"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "\n\n\\u5728 2026/2/18 21:43, Mark Harmstone \\u5199\\u9053:\n> Commit d7f67ac9 introduced a regression when it comes to handling\n> unsupported incompat or compat_ro flags. Beforehand we only printed the\n> flags that we didn't recognize, afterwards we printed them all, which is\n> less useful. Fix the error handling so it behaves like it used to.\n> \n> Signed-off-by: Mark Harmstone <mark@harmstone.com>\n> Fixes: d7f67ac9a928 (\"btrfs: relax block-group-tree feature dependency checks\")\n\nReviewed-by: Qu Wenruo <wqu@suse.com>\n\nThanks,\nQu\n\n> ---\n>   fs/btrfs/disk-io.c | 6 +++---\n>   1 file changed, 3 insertions(+), 3 deletions(-)\n> \n> diff --git a/fs/btrfs/disk-io.c b/fs/btrfs/disk-io.c\n> index f39008591631..7478d1c50cca 100644\n> --- a/fs/btrfs/disk-io.c\n> +++ b/fs/btrfs/disk-io.c\n> @@ -3176,7 +3176,7 @@ int btrfs_check_features(struct btrfs_fs_info *fs_info, bool is_rw_mount)\n>   \tif (incompat & ~BTRFS_FEATURE_INCOMPAT_SUPP) {\n>   \t\tbtrfs_err(fs_info,\n>   \t\t\"cannot mount because of unknown incompat features (0x%llx)\",\n> -\t\t    incompat);\n> +\t\t    incompat & ~BTRFS_FEATURE_INCOMPAT_SUPP);\n>   \t\treturn -EINVAL;\n>   \t}\n>   \n> @@ -3208,7 +3208,7 @@ int btrfs_check_features(struct btrfs_fs_info *fs_info, bool is_rw_mount)\n>   \tif (compat_ro_unsupp && is_rw_mount) {\n>   \t\tbtrfs_err(fs_info,\n>   \t\"cannot mount read-write because of unknown compat_ro features (0x%llx)\",\n> -\t\t       compat_ro);\n> +\t\t       compat_ro_unsupp);\n>   \t\treturn -EINVAL;\n>   \t}\n>   \n> @@ -3221,7 +3221,7 @@ int btrfs_check_features(struct btrfs_fs_info *fs_info, bool is_rw_mount)\n>   \t    !btrfs_test_opt(fs_info, NOLOGREPLAY)) {\n>   \t\tbtrfs_err(fs_info,\n>   \"cannot replay dirty log with unsupported compat_ro features (0x%llx), try rescue=nologreplay\",\n> -\t\t\t  compat_ro);\n> +\t\t\t  compat_ro_unsupp);\n>   \t\treturn -EINVAL;\n>   \t}\n>   \n\n\n",
          "reply_to": ""
        }
      ],
      "analysis_source": "llm",
      "patch_summary": "This patch fixes a regression introduced by commit d7f67ac9, which caused btrfs_check_features() to print all unsupported incompat and compat_ro flags instead of just the unrecognized ones."
    },
    "2026-02-19": {
      "report_file": "2026-02-19_ollama_llama3.1-8b.html",
      "developer": "Mark Harmstone",
      "reviews": [
        {
          "author": "Qu Wenruo",
          "summary": "\\u5728 2026/2/18 21:43, Mark Harmstone \\u5199\\u9053:",
          "sentiment": "neutral",
          "sentiment_signals": [],
          "has_inline_review": true,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "heuristic",
          "raw_body": "\n\n\\u5728 2026/2/18 21:43, Mark Harmstone \\u5199\\u9053:\n> Commit d7f67ac9 introduced a regression when it comes to handling\n> unsupported incompat or compat_ro flags. Beforehand we only printed the\n> flags that we didn't recognize, afterwards we printed them all, which is\n> less useful. Fix the error handling so it behaves like it used to.\n> \n> Signed-off-by: Mark Harmstone <mark@harmstone.com>\n> Fixes: d7f67ac9a928 (\"btrfs: relax block-group-tree feature dependency checks\")\n\nReviewed-by: Qu Wenruo <wqu@suse.com>\n\nThanks,\nQu\n\n> ---\n>   fs/btrfs/disk-io.c | 6 +++---\n>   1 file changed, 3 insertions(+), 3 deletions(-)\n> \n> diff --git a/fs/btrfs/disk-io.c b/fs/btrfs/disk-io.c\n> index f39008591631..7478d1c50cca 100644\n> --- a/fs/btrfs/disk-io.c\n> +++ b/fs/btrfs/disk-io.c\n> @@ -3176,7 +3176,7 @@ int btrfs_check_features(struct btrfs_fs_info *fs_info, bool is_rw_mount)\n>   \tif (incompat & ~BTRFS_FEATURE_INCOMPAT_SUPP) {\n>   \t\tbtrfs_err(fs_info,\n>   \t\t\"cannot mount because of unknown incompat features (0x%llx)\",\n> -\t\t    incompat);\n> +\t\t    incompat & ~BTRFS_FEATURE_INCOMPAT_SUPP);\n>   \t\treturn -EINVAL;\n>   \t}\n>   \n> @@ -3208,7 +3208,7 @@ int btrfs_check_features(struct btrfs_fs_info *fs_info, bool is_rw_mount)\n>   \tif (compat_ro_unsupp && is_rw_mount) {\n>   \t\tbtrfs_err(fs_info,\n>   \t\"cannot mount read-write because of unknown compat_ro features (0x%llx)\",\n> -\t\t       compat_ro);\n> +\t\t       compat_ro_unsupp);\n>   \t\treturn -EINVAL;\n>   \t}\n>   \n> @@ -3221,7 +3221,7 @@ int btrfs_check_features(struct btrfs_fs_info *fs_info, bool is_rw_mount)\n>   \t    !btrfs_test_opt(fs_info, NOLOGREPLAY)) {\n>   \t\tbtrfs_err(fs_info,\n>   \"cannot replay dirty log with unsupported compat_ro features (0x%llx), try rescue=nologreplay\",\n> -\t\t\t  compat_ro);\n> +\t\t\t  compat_ro_unsupp);\n>   \t\treturn -EINVAL;\n>   \t}\n>   \n\n",
          "reply_to": "",
          "message_date": "2026-02-19",
          "message_id": ""
        }
      ],
      "analysis_source": "heuristic",
      "patch_summary": "Commit d7f67ac9 introduced a regression when it comes to handling unsupported incompat or compat_ro flags. Beforehand we only printed the flags that we didn't recognize, afterwards we printed them all, which is less useful. Fix the error handling so it behaves like it used to."
    },
    "2026-02-23": {
      "report_file": "2026-02-23.html",
      "developer": "Mark Harmstone",
      "reviews": [
        {
          "author": "David Sterba",
          "summary": "Please use full commit reference in changelog text at least for the first occurence, the format is the same as for the Fixes: line. Thanks.",
          "sentiment": "neutral",
          "sentiment_signals": [],
          "has_inline_review": true,
          "tags_given": [],
          "analysis_source": "heuristic",
          "raw_body": "On Wed, Feb 18, 2026 at 11:13:40AM +0000, Mark Harmstone wrote:\n> Commit d7f67ac9\n\nPlease use full commit reference in changelog text at least for the\nfirst occurence, the format is the same as for the Fixes: line. Thanks.\n\n> introduced a regression when it comes to handling\n> unsupported incompat or compat_ro flags. Beforehand we only printed the\n> flags that we didn't recognize, afterwards we printed them all, which is\n> less useful. Fix the error handling so it behaves like it used to.\n> \n> Signed-off-by: Mark Harmstone <mark@harmstone.com>\n> Fixes: d7f67ac9a928 (\"btrfs: relax block-group-tree feature dependency checks\")\n> ---\n>  fs/btrfs/disk-io.c | 6 +++---\n>  1 file changed, 3 insertions(+), 3 deletions(-)\n> \n> diff --git a/fs/btrfs/disk-io.c b/fs/btrfs/disk-io.c\n> index f39008591631..7478d1c50cca 100644\n> --- a/fs/btrfs/disk-io.c\n> +++ b/fs/btrfs/disk-io.c\n> @@ -3176,7 +3176,7 @@ int btrfs_check_features(struct btrfs_fs_info *fs_info, bool is_rw_mount)\n>  \tif (incompat & ~BTRFS_FEATURE_INCOMPAT_SUPP) {\n>  \t\tbtrfs_err(fs_info,\n>  \t\t\"cannot mount because of unknown incompat features (0x%llx)\",\n> -\t\t    incompat);\n> +\t\t    incompat & ~BTRFS_FEATURE_INCOMPAT_SUPP);\n>  \t\treturn -EINVAL;\n>  \t}\n>  \n> @@ -3208,7 +3208,7 @@ int btrfs_check_features(struct btrfs_fs_info *fs_info, bool is_rw_mount)\n>  \tif (compat_ro_unsupp && is_rw_mount) {\n>  \t\tbtrfs_err(fs_info,\n>  \t\"cannot mount read-write because of unknown compat_ro features (0x%llx)\",\n> -\t\t       compat_ro);\n> +\t\t       compat_ro_unsupp);\n>  \t\treturn -EINVAL;\n>  \t}\n>  \n> @@ -3221,7 +3221,7 @@ int btrfs_check_features(struct btrfs_fs_info *fs_info, bool is_rw_mount)\n>  \t    !btrfs_test_opt(fs_info, NOLOGREPLAY)) {\n>  \t\tbtrfs_err(fs_info,\n>  \"cannot replay dirty log with unsupported compat_ro features (0x%llx), try rescue=nologreplay\",\n> -\t\t\t  compat_ro);\n> +\t\t\t  compat_ro_unsupp);\n>  \t\treturn -EINVAL;\n>  \t}\n>  \n> -- \n> 2.52.0\n> \n",
          "reply_to": "",
          "message_date": "2026-02-23",
          "message_id": ""
        },
        {
          "author": "David Sterba",
          "summary": "Also please configure your git so the hashes are at least 12 characters, I've been using 14 and I think others do too. This is 'core.abbrev' config.",
          "sentiment": "neutral",
          "sentiment_signals": [],
          "has_inline_review": true,
          "tags_given": [],
          "analysis_source": "heuristic",
          "raw_body": "On Wed, Feb 18, 2026 at 11:13:40AM +0000, Mark Harmstone wrote:\n> Commit d7f67ac9\n\nAlso please configure your git so the hashes are at least 12 characters,\nI've been using 14 and I think others do too. This is 'core.abbrev'\nconfig.\n\n",
          "reply_to": "",
          "message_date": "2026-02-23",
          "message_id": ""
        }
      ],
      "analysis_source": "heuristic",
      "patch_summary": "Commit d7f67ac9 introduced a regression when it comes to handling unsupported incompat or compat_ro flags. Beforehand we only printed the flags that we didn't recognize, afterwards we printed them all, which is less useful. Fix the error handling so it behaves like it used to."
    }
  }
}
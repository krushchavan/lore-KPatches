{
  "thread_id": "20260221163043.GA35350@shakeel.butt@linux.dev",
  "subject": "Re: [RFC PATCH v2 0/5] mm/swap, memcg: Introduce swap tiers for cgroup based swap control",
  "url": "https://lore.kernel.org/all/20260221163043.GA35350@shakeel.butt@linux.dev/",
  "dates": {
    "2026-02-11": {
      "report_file": "2026-02-21_ollama_llama3.1-8b.html",
      "developer": "Shakeel Butt",
      "reviews": [
        {
          "author": "Chris Li",
          "summary": "Reviewer Chris Li noted that the swap_tier structure was simplified by replacing 'end prio' and priority lists with a standard list_head, as requested in his previous feedback.\n\nReviewer Chris Li suggested breaking down the patch series into smaller, more manageable steps, starting with defining the tiers bits without deleting any existing functionality, and then building upon that in subsequent steps.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "acknowledgment of previous feedback",
            "requested changes",
            "suggested improvements"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "Hi Youngjun,\n\nOn Sun, Jan 25, 2026 at 10:53 PM Youngjun Park <youngjun.park@lge.com> wrote:\n\n---\n\nThanks for the patches series.\n\nSorry for the late reply. I have been wanting to reply to it but get\nsuper busy at work.\n\nSome high level feedback for the series. Now that you demonstrated the\nwhole series, let's focus on making small mergiable baby steps. Just\nlike the swap table has different phases. Make each step minimal, each\nstep shows some value. Do the MVP, we can always add more features as\na follow up step.\n\nI suggest the first step is getting the tiers bits defined. Add only,\nno delete.  Get that reviewed and merged, then the next step is to use\nthose tiers.\n\nChris",
          "reply_to": "Youngjun Park",
          "message_date": "2026-02-11"
        },
        {
          "author": "Chris Li",
          "summary": "Reviewer Chris Li suggested replacing per-cpu allocation for each swap device with a global per-cpu cluster per tier, as the maximum number of tiers is smaller than the maximum number of swap devices, which could be more efficient.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "requested changes"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "One idea is that, instead of using percpu per swap device.\nYou can make the global percpu cluster per tier. Because the max tier\nnumber is smaller than the max number of swap devices. That is likely\na win.\n\nChris",
          "reply_to": "Youngjun Park",
          "message_date": "2026-02-11"
        }
      ],
      "analysis_source": "llm-per-reviewer"
    },
    "2026-02-12": {
      "report_file": "2026-02-21_ollama_llama3.1-8b.html",
      "developer": "Shakeel Butt",
      "reviews": [
        {
          "author": "Chris Li",
          "summary": "Reviewer Chris Li noted that the swap_tier structure simplification removed the 'end prio' and priority lists, which caused a loss of information about the tier's priority range, and requested reverting to the original implementation.\n\nReviewer Chris Li suggested introducing a CONFIG option to limit the maximum number of swap tiers, recommending a default value of 4.\n\nReviewer Chris Li noted that modifying a tier can cause swap files to move to a different tier, which may lead to issues, and requested further consideration of this scenario.\n\nReviewer Chris Li expressed concern about the complexity of the patch, specifically the need for save and restore operations, and requested a simpler design.\n\nReviewer Chris Li suggested that each tier have its own swap_active_head, so that different swap entries on different tiers do not compete for the same resource, and proposed that swapfiles should not be allowed to jump between tiers.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "requested changes"
          ],
          "has_inline_review": true,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "Hi Yongjun,\n\nOn Sun, Jan 25, 2026 at 10:53 PM Youngjun Park <youngjun.park@lge.com> wrote:\n\n---\n\nWe can have a CONFIG option for the MAX_SWAPTIER. I think the default\nshould be a small number like 4.\n\n---\n\nWhen we add, modify, remove a tier. The simple case is there is no\nswap file under any tiers.\nBut if the modification causes some swap files to jump to different\ntiers. That might be problematic.\n\n---\n\nI really hope we don't have to do the save and restore thing. Is there\nanother design we can simplify this?\n\n---\n\nOne idea is to make each tier have swap_active_head. So different swap\nentry releases on different tiers don't need to be competing on the\nsame swap_active_head.\n\nThat will require the swapfile don't jump to another tiers.\n\nChris",
          "reply_to": "Youngjun Park",
          "message_date": "2026-02-12"
        },
        {
          "author": "Chris Li",
          "summary": "Reviewer Chris Li initially suggested simplifying the swap_tier structure by replacing 'end prio' and priority lists with a standard list_head, but later retracted this suggestion stating that adding tier names alone does not add real value.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "retraction of previous suggestion"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "Just take a quick look at the series. I take that suggestion back.\nThis series is actually not too long. Adding the tiers name alone does\nnot add any real value. I actually need to look at the whole series\nrather than just the tier name alone.\n\nChris",
          "reply_to": "",
          "message_date": "2026-02-12"
        },
        {
          "author": "Nhat Pham",
          "summary": "Reviewer Nhat Pham questioned the continued mention of '+' in the documentation, pointing out that it has been removed from the code.\n\nReviewer Nhat Pham noted that the patch description's explanation of cgroup hierarchy principle is unclear, suggesting a simpler approach where child's allowed swap tiers are a subset of its ancestors.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "confusion",
            "questioning",
            "requested clarification",
            "suggested alternative"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "This comment seems a bit clunky to me. The \"+\" is removed, as noted\nabove, but then why are we saying \"even if a child re-enables a tier\nwith \"+\"\" here? Am I missing something?\n\n---\n\nBut otherwise, I assume you mean to restrict child's allowed swap\ntiers to be a subset of children and its ancestors? That seems more\nstraightforward to me than the last system :)",
          "reply_to": "Youngjun Park",
          "message_date": "2026-02-12"
        },
        {
          "author": "Shakeel Butt",
          "summary": "Reviewer Shakeel Butt noted that the patch does not handle the case where a child cgroup re-enables a tier with '+' that was excluded by its parent, and requested that the effective tier list be limited to the intersection of the parent's allowed subset and the child's selection.\n\nReviewer Shakeel Butt noted that adding a memcg interface for the Swap Tiers functionality is not necessary, suggesting instead that BPF could be used to achieve this goal. He expressed skepticism about allowing workloads to choose swap devices and believes this decision should be made by the job orchestator or node controller.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "requested changes",
            "suggested alternative approach"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "Hi Youngjun,\n\nOn Mon, Jan 26, 2026 at 03:52:37PM +0900, Youngjun Park wrote:\n\n---\n\nOne of the LPC feedback you missed is to not add memcg interface for\nthis functionality and explore BPF way instead.\n\nWe are normally very conservative to add new interfaces to cgroup.\nHowever I am not even convinced that memcg interface is the right way to\nexpose this functionality. Swap is currently global and the idea to\nlimit or assign specific swap devices to specific cgroups makes sense\nbut that is the decision for the job orchestator or node controller.\nAllowing workloads to pick and choose swap devices do not make sense to\nme.\n\nShakeel",
          "reply_to": "Youngjun Park",
          "message_date": "2026-02-12"
        }
      ],
      "analysis_source": "llm-per-reviewer"
    },
    "2026-02-13": {
      "report_file": "2026-02-21_ollama_llama3.1-8b.html",
      "developer": "Shakeel Butt",
      "reviews": [
        {
          "author": "YoungJun Park (author)",
          "summary": "Author addressed Chris Li's concern about the patch series being too large by proposing a modified roadmap to break it down into smaller, mergeable steps. The author suggests introducing the swap tier definitions first, followed by advanced control and external integration.",
          "sentiment": "positive",
          "sentiment_signals": [
            "agreed",
            "proposed"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "Hi Chris,\n\nThank you for the direction.\n\nI agree that breaking the series into smaller, mergeable steps is the\nright approach. However, since introducing the definitions alone might\nlack immediate usage, I propose a slightly\nmodified roadmap to ensure Step 1 demonstrates some value.\n\nHere is the plan I have in mind.\n\n1. Swap Tier Definition & Addition\n   - Introduce the concept, grouping logic, and the 'add' interface.\n   - Value: Enables basic exception handling within the swap device\n     itself using tiers.\n\n2. Advanced Control (Delete/Modify)\n   - Implement logic to remove or update tiers.\n   - Value: Enhances the usability and management of the tiers\n     established in Step 1.\n\n3. External Integration (memcg, bpf etc ... )\n   - Apply swap tiers for broader swap control.\n   - Value: Connects swap tiers to other subsystems like memcg.\n\nDoes this roadmap look reasonable to you? I will proceed with preparing\nthe real patch series based on this structure.\n\nBest regards,\nYoungjun",
          "reply_to": "Chris Li",
          "message_date": "2026-02-13"
        },
        {
          "author": "YoungJun Park (author)",
          "summary": "Author acknowledged the need to limit swap file size, agreed to add a configuration option to control this in the patch.\n\nAuthor addressed Chris Li's feedback on mixed operations in /sys/kernel/mm/swap/tiers, proposed restricting the interface to single operations due to error-prone and slow reversal of individual operations upon failure, and asked for reviewer thoughts.\n\nAuthor acknowledged that limiting contention to objects within the same tier is a benefit of the patch, and expressed agreement with the reviewer's suggestion.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "acknowledged",
            "agreed",
            "asked_for_clarification",
            "proposed_alternative",
            "agreement",
            "acknowledgment"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "Sounds good. I will add a CONFIG option for it and ensure it doesn't exceed\nMAX_SWAPFILE.\n\n---\n\nI have given this a lot of thought.\n\nSince the current interface allows mixing add (+), remove (-), and modify\noperations, we must either restore from a saved state or reverse the\nsuccessful individual operations upon failure.\n\nI implemented both approaches and concluded that reversing individual\noperations is error-prone. Also, it could be slow if there are many\noperations.\n\nAnother approach could be using a \"global clone tier\" strategy.\n(Because operation globally synchronized)\n\nTherefore, I would like to propose restricting the interface to handle a\nsingle operation at a time. What do you think?\n\n---\n\nI agree. With the tier structure, we can limit contention to objects within\nthe same tier.\n\nI also think swap_avail_list could be optimized in a similar way in the\nfuture.\n\nYoungjun",
          "reply_to": "Chris Li",
          "message_date": "2026-02-13"
        },
        {
          "author": "YoungJun Park (author)",
          "summary": "Author acknowledges that stripping out the remove/modify parts from the patch is a feasible direction, asking reviewer Chris Li for agreement on this approach.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "clarifying question",
            "no clear resolution signal"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "Oops, I replied to your previous email before seeing this one.\n\nStripping out the remove/modify parts is also feasible. Do you agree with\nthat direction?\n\nYoungjun",
          "reply_to": "Chris Li",
          "message_date": "2026-02-13"
        },
        {
          "author": "YoungJun Park (author)",
          "summary": "Author addressed Nhat Pham's concern about the default state of swap tiers and how '+' is interpreted, explaining that they are changing the model to a subtraction-based one where all tiers are selected by default and users use '-' to exclude specific ones.\n\nAuthor acknowledged a concern about the swapoff path and agreed to restructure it in v2.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "clarification",
            "explanation",
            "acknowledged",
            "agreed"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "To clarify, previously, the default state used all tiers. Using \"+\"              \nswitched to \"an exclusive mode\"  where only that specific tier was used.         \n                                                                                 \nI am changing this to a subtraction-based model. By default, all tiers           \nare selected, and users use \"-\" to exclude specific ones.                        \n(Then not \"removed\" but \"changed\" is more proper?)                               \n                                                                                 \nIn this context, I intended \"+\" to be used to restore a tier that was            \npreviously excluded by \"-\".\n\n---\n\nYes, that's right :)\n\nThanks \nYoungjun Park.",
          "reply_to": "Nhat Pham",
          "message_date": "2026-02-13"
        },
        {
          "author": "YoungJun Park (author)",
          "summary": "Author addressed a concern about using the BPF approach for swap device assignment, citing potential logical contradictions and hierarchy enforcement issues. They acknowledged the flexibility of BPF but expressed concerns that it would eliminate its primary advantage if strictly constrained to adhere to cgroup semantics. Instead, they prefer implementing the swap tier mechanism within the standard 'cgroup land' to ensure consistent enforcement of hierarchy and accounting rules.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "acknowledged a fix is needed",
            "expressed concerns about BPF approach"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "Apologies for overlooking the feedback regarding the BPF approach. Thank you\nfor the suggestion.\n\nI agree that using BPF would provide greater flexibility, allowing control not\njust at the memcg level, but also per-process or for complex workloads.\n(As like orchestrator and node controller)\n\nHowever, I am concerned that this level of freedom might introduce logical\ncontradictions, particularly regarding cgroup hierarchy semantics.\n\nFor example, BPF might allow a topology that violates hierarchical constraints\n(a concern that was also touched upon during LPC)\n\n  - Group A (Parent): Assigned to SSD1\n  - Group B (Child of A): Assigned to SSD2\n\nIf Group A has a `memory.swap.max` limit, and Group B swaps out to SSD2, it\ncreates a consistency issue. Group B consumes Group A's swap quota, but it is\nutilizing a device (SSD2) that is distinct from the Parent's assignment. This\ncould lead to situations where the Parent's limit is exhausted by usage on a\ndevice it effectively doesn't \"own\" or shouldn't be using.\n\nOne might suggest restricting BPF to strictly adhere to these hierarchical\nconstraints. However, doing so would effectively eliminate the primary\nadvantage of using BPF\\u2014its flexibility. If we are to enforce standard cgroup\nsemantics anyway, a native interface seems more appropriate than a constrained\nBPF hook.\n\nBeyond this specific example, I suspect that delegating this logic to BPF\nmight introduce other unforeseen edge cases regarding hierarchy enforcement.\nIn my view, the BPF approach seems more like a \"next step.\"\n\nSince you acknowledged that the idea of assigning swap devices to cgroups\n\"makes sense,\" I believe implementing this within the standard, strictly\nconstrained \"cgroup land\" is preferable. \n\nA strict cgroup interface ensures\nthat hierarchy and accounting rules are consistently enforced, avoiding the\npotential conflicts that the unrestricted freedom of BPF might create.\n\nUltimately, I hope this swap tier mechanism can serve as a foundation to be\nleveraged by other subsystems, such as BPF and DAMON. I view this proposal as\nthe necessary first step toward that future.\n\nYoungjun Park",
          "reply_to": "Shakeel Butt",
          "message_date": "2026-02-13"
        },
        {
          "author": "YoungJun Park (author)",
          "summary": "Author acknowledged that existing swapfiles' tier assignment is immutable and addressed the issue by removing tier reference, instead using operation-time validation to ensure invariant.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "acknowledged a fix is needed",
            "promised a revised approach"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "I missed one comment. \n\nThe tier of existing swapfiles is immutable once assigned at swapon.\nI removed tier reference.\nInstead of reference counting, each operation validates the tier\nrange at operation time to guarantee this invariant.\n\n- add:    Does not change existing swapfiles' tier. New tier may\n          split priority range, but existing assignments stay.\n- remove: Rejected with -EBUSY if any swapfile is attached.\n- modify: Rejected if the change would cause any swapfile to\n          move to a different tier.\n\nSo swapfiles never jump between tiers at runtime.\n\nYoungjun Park",
          "reply_to": "Chris Li",
          "message_date": "2026-02-13"
        }
      ],
      "analysis_source": "llm-per-reviewer"
    },
    "2026-02-20": {
      "report_file": "2026-02-21_ollama_llama3.1-8b.html",
      "developer": "Shakeel Butt",
      "reviews": [
        {
          "author": "Shakeel Butt",
          "summary": "Reviewer requested that further discussion be concluded on the previous patch series before a new version is submitted.\n\nReviewer Shakeel Butt expressed concerns about introducing stable interfaces for swap tiers, requesting a proof-of-concept using BPF before implementing hierarchical control\n\nReviewer Shakeel Butt noted that while BPF offers more flexibility, its control is limited to administrators who may inadvertently cause issues.\n\nReviewer Shakeel Butt requested clarification on the patch's use case, specifically asking about ordering policies between multiple assigned swap devices, the reason for using 'tiers' in the name, and how workloads partition/divide assigned devices to sub-workloads. He suggested brainstorming future use-cases to create a more future-proof solution.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "request for conclusion of previous discussion",
            "requested changes",
            "not convinced",
            "concerns about admin control",
            "requested clarification",
            "suggested brainstorming"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "Please don't send a new version of the series before concluding the discussion\non the previous one.\n\nOn Fri, Feb 13, 2026 at 12:58:40PM +0900, YoungJun Park wrote:\n\n---\n\nYes it provides the flexibility but that is not the main reason I am pushing for\nit. The reason I want you to first try the BPF approach without introducing any\nstable interfaces. Show how swap tiers will be used and configured in production\nenvironment and then we can talk if a stable interface is needed. I am still not\nconvinced that swap tiers need to be controlled hierarchically and the non-root\nshould be able to control it.\n\n---\n\nYes BPF provides more power but it is controlled by admin and admin can shoot\ntheir foot in multiple ways.\n\n---\n\nNo need to constraint anything.\n\nTaking a step back, can you describe your use-case a bit more and share\nrequirements?\n\nYou have multiple swap devices of different properties and you want to assign\nthose swap devices to different workloads. Now couple of questions:\n\n1. If more than one device is assign to a workload, do you want to have\n   some kind of ordering between them for the worklod or do you want option to\n   have round robin kind of policy?\n\n2. What's the reason to use 'tiers' in the name? Is it similar to memory tiers\n   and you want promotion/demotion among the tiers?\n\n3. If a workload has multiple swap devices assigned, can you describe the\n   scenario where such workloads need to partition/divide given devices to their\n   sub-workloads?\n\nLet's start with these questions. Please note that I want us to not just look at\nthe current use-case but brainstorm more future use-cases and then come up with\nthe solution which is more future proof.\n\nthanks,\nShakeel",
          "reply_to": "YoungJun Park",
          "message_date": "2026-02-20"
        },
        {
          "author": "Chris Li",
          "summary": "Reviewer Chris Li noted that the discussion on the patch had been ongoing for over a week without a response from YoungJun, and suggested that the reviewer should not take it as concluded, considering the difficulty of contributing to the kernel and the prevalence of differing opinions on the mailing list.\n\nReviewer Chris Li suggested that instead of blocking the patch, a config option could be added to protect the problematic feature and mark it as experimental, allowing for further testing and feedback.\n\nReviewer Chris Li confirmed their company's use case for controlling swap devices at different cgroup levels, emphasizing it as a real need.\n\nReviewer Chris Li noted that the swap device control concept in this patch is not generic enough, similar to zswap.writeback, and suggested that it could be improved further.\n\nChris Li expressed frustration about the lack of a long-standing thread on the linux-mm mailing list, which he believes would be helpful for reviewing the patch, and suggested that Shakeel Butt's team could share their internal cgroup swapfile control interface to simplify upstreaming.\n\nReviewer Chris Li noted that the swap tier system's performance is dependent on the number of devices within each tier, and suggested using a round-robin approach to distribute swap operations across devices within the same tier.\n\nReviewer Chris Li suggested renaming the 'tier' concept to something like 'swap.device_speed_classes', indicating that it's a distinct classification of swap speeds, and proposed alternative names.\n\nChris Li expressed concern that the patch does not account for multiple swap devices being used in a deployment, which can lead to lock contention and impact performance.\n\nReviewer Chris Li expressed a nuanced opinion on the patch, suggesting that starting from current needs and incremental improvements is a better approach than designing for future-proofing. He acknowledged the need to allow different cgroups to select different swap speeds but cautioned against over-engineering.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "NEEDS_WORK",
            "requested changes",
            "suggested alternative solution",
            "acknowledgment of specific use case",
            "frustration",
            "suggestion",
            "performance concern",
            "requested change",
            "open-ended question",
            "lock contention",
            "performance impact",
            "incremental progress",
            "future-proofing"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "In this case I think it is fine.  You haven't responded to YoungJun's\nlast response in over a week. He might have mistaken that the\ndiscussion concluded.\nConsider it is one of the iterations. It is hard enough to contribute\nto the kernel. Relax.\nPlus, much of the discussion on the mailing list always has differing\nopinions. So, it's hard to determine what is truly concluded.\nDifferent people might have different interitations of the same text.\n\n---\n\nIs that your biggest concern? Many different ways exist to solve that\nproblem. e.g. We can put a config option protecting it and mark it as\nexperimental. This will unblock the development allow experiment. We\ncan have more people to try it out and give feedback.\n\n---\n\nYes, my company uses a different swap device at different cgroup\nlevel. I did ask my coworker to confirm that usage. Control at the non\nroot level is a real need.\n\n---\n\nI think this swap device control is a very basic need. All your\nobjections to swapping control in the group can equally apply to\nzswap.writeback. Unlike zswap.writeback, which only control from the\nzswap behavior. This is a more generic version control swap device\nother than zswap as well. BTW, I raised that concern about\nzswap.writeback was not generic enough as swap control was limited\nwhen zswap was proposed. We did hold back zswap.writeback. The\nconsensers is interface can be improved as later iterations. So here\nwe are.\n\n---\n\nThere is a very long thread on the linux-mm maillist. I'm too lazy to dig it up.\n\nI can share our usage requirement to refresh your memory. We\ninternally use a cgroup swapfile control interface that has not been\nupstreamed. With this we can remove the need of that internal\ninterface and go upstream instead.\n\n---\n\nIt depends on the number of devices in the tiers. Different tiers\nmaintain an order. Within the same tier round robin.\n\n---\n\nI propose the tier name. Guilty. Yes, in was inpired by memory tiers.\nIt just different class of swap speeds. I am not fixed on the name. We\ncan also call it swap.device_speed_classes. You can suggest\nalternatives.\n\nPromotion / demotion is possible in the future. The current state,\nwithout promotion or demotion, already provides value. Our current\ndeployment uses only one class of swap device at a time. However I do\nknow other companies use  more than one class of swap device.\n\n---\n\nIn our deployment, we always use more than one swap device to reduce\nswap device lock contention.\nThe job config can describe the swap speed it can tolerate. Some jobs\ncan tolerate slower speeds, while others cannot.\n\n---\n\nTake zswap.writeback as example. We have a solution that worked for\nthe requirement at that time. Incremental improvement is fine as well.\nUsually, incremental progress is better. At least currently there is a\nreal need to allow different cgroups to select different swap speeds.\nThere is a risk in being too future-proof: we might design things that\npeople in the future don't use as we envisioned. I see that happen too\noften as well.\n\nSo starting from the current need is a solid starting point. It's just\na different design philosophy. Each to their own.\n\nThat is the only usage case I know. YoungJun feel free to add yours\nusage as well.\n\nChris",
          "reply_to": "Shakeel Butt",
          "message_date": "2026-02-20"
        }
      ],
      "analysis_source": "llm-per-reviewer"
    },
    "2026-02-21": {
      "report_file": "2026-02-21_ollama_llama3.1-8b.html",
      "developer": "Shakeel Butt",
      "reviews": [
        {
          "author": "YoungJun Park (author)",
          "summary": "Author acknowledged that they need to address concerns about swap device cluster allocation rule preservation and promised to restructure in v2\n\nAuthor acknowledged a concern about committing to a stable interface too early and proposed reducing the risk by adding a build-time config option or marking it as experimental, but also expressed uncertainty about whether a memcg interface would be needed if BPF becomes primary control mechanism.\n\nAuthor acknowledged that the swapoff path needs to drop the per-vswap spinlock before calling try_to_unmap(), but did not explicitly state a plan for addressing this issue in v2.\n\nAuthor suggests that introducing build-time config or runtime constraints can help define and predict usage of the swap tiers feature.\n\nAuthor addressed Shakeel Butt's concern about the patch's ability to handle complex use cases by explaining their initial proposal for per-cgroup swap device priorities and how they pivoted to the 'swap tier' mechanism due to its simplicity.\n\nThe author addressed Shakeel Butt's feedback about the swap device selection policy by explaining that if devices are in the same tier with the same priority, round robin is used, and if they have different priorities or are in different tiers, ordering applies.\n\nAuthor acknowledged that the swapoff path needs to drop the per-vswap spinlock before calling try_to_unmap(), agreed to restructure in v2, but did not provide a specific plan for addressing this issue.\n\nAuthor addressed Shakeel Butt's concern about reducing lock contention, suggesting a possible solution of partitioning swap devices between parent and child cgroups.\n\nAuthor addressed Shakeel Butt's concern about the patch's long-term maintainability by suggesting that a CONFIG option would allow them to move forward without committing to a stable interface, and they see BPF as a natural extension path for future use cases.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "acknowledged",
            "promised",
            "uncertainty",
            "concerns",
            "did not explicitly state a plan",
            "clarification",
            "explaining",
            "explanation",
            "acknowledged a fix is needed",
            "agreed to restructure",
            "partitioning swap devices",
            "possible scenario",
            "author acknowledges a fix is needed",
            "author suggests a temporary solution"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "Understood. Let's continue the discussion. :D\n\nChris has already provided a thorough response, but I would like to\nadd my perspective as well.\n\n---\n\nI understand your concern about committing to a stable interface too\nearly. As Chris suggested, we could reduce this concern by guarding\nthe interface behind a build-time config option or marking it as\nexperimental, which I will also touch on further below.\n\nOn that note, if BPF were to become the primary control mechanism,\nI am not sure a memcg interface would still be needed at all, since\nBPF already provides a high degree of freedom. However, that level\nof freedom is also what concerns me -- BPF-driven swap device\nassignments could subtly conflict with memcg hierarchy semantics in\nways that are hard to predict or debug. A more constrained memcg-based\napproach might actually be safer in that regard.\n\n---\n\nI think this concern is closely tied to your question #3 below about\nconcrete use cases for partitioning devices across sub-workloads.\nI hope my answer there helps clarify this.\n\n---\n\nAs I mentioned above, I think guarding the feature behind a build-time\nconfig or runtime constraints could keep the usage well-defined and\npredictable, while still being useful.\n\n---\n\nOur use case is simple at now. \nWe have two swap devices with different performance\ncharacteristics and want to assign different swap devices to different\nworkloads (cgroups).\n\nFor some background, when I initially proposed this, I suggested allowing\nper-cgroup swap device priorities so that it could also accommodate the\nbroader scenarios you mentioned. However, since even our own use case\ndoes not require reversing swap priorities within a cgroup, we pivoted\nto the \"swap tier\" mechanism that Chris proposed.\n\n---\n\nBoth. If devices are in the same tier with the same priority, round robin.\nIf they are in the same tier with different priorities, or in different\ntiers, ordering applies. The current tier structure should be able to\nsatisfy either preference.\n\n---\n\nThis was originally Chris's idea. I think he explained the rationale\nwell in his reply.\n\n---\n\nOne possible scenario is reducing lock contention by partitioning swap\ndevices between parent and child cgroups.\n\n---\n\nWe have clear production use cases from both us and Chris, and I also\npresented a deployment example in the cover letter.\n\nI think it is hard to design concretely for future use cases at this\npoint. When those needs become clearer, BPF with its flexibility\nwould be a better fit then. I see BPF as a natural extension path\nrather than a starting point.\n\nFor now, guarding the memcg & tier behind a CONFIG option would\nlet us move forward without committing to a stable interface, and\nwe can always pivot to BPF later if needed\n\nThanks,\nYoungJun Park",
          "reply_to": "Shakeel Butt",
          "message_date": "2026-02-21"
        },
        {
          "author": "Shakeel Butt",
          "summary": "Reviewer Shakeel Butt expressed concerns about the practical application of the patch, stating that he doesn't see the real use-case for controlling/partitioning swap devices among sub-workloads and believes adding a stable API is premature.\n\nReviewer Shakeel Butt questioned whether the patch's concept of swap tiers is a new feature or a reimplementation of an existing interface, specifically referencing Google's prodkernel team and their use of memory.swapfiles.\n\nReviewer Shakeel Butt expressed skepticism about the introduction of a new swap tier interface without a clear use case, prompting him to push back even harder on its addition.\n\nReviewer Shakeel Butt questioned the practicality of hierarchical swap device control, specifically asking for a real-world use case to justify this feature.\n\nReviewer Shakeel Butt noted that having multiple swap devices to reduce lock contention does not address the issue of controlling swap devices among sub-workloads, which is the purpose of the 'Swap Tiers' concept.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "requested changes",
            "uncertainty",
            "lack of clarity",
            "skepticism",
            "pushback"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "No, that is secondary because I am not seeing the real use-case of\ncontrolling/partitioning swap devices among sub-workloads. Until that is\nfigured out, adding a stable API is not good.\n\n---\n\nI am assuming you meant Google and particularly Prodkernel team and not\nAndroid or ChromeOS. Google's prodkernel used to have per-cgroup\nswapfiles exposed through memory.swapfiles (if I remember correctly\nSuleiman implemented this along with ghost swapfiles). Later this was\ndeprecated (by Yu Zhao) and global (ghost) swapfiles were being used.\nThe memory.swapfiles interface instead of supporting real swapfiles\nstarted having select options among default, ghost/zswap and real\n(something like that). However such interface was used to just disable\nor enable zswap for a workload and never about hierarchically\ncontrolling the swap devices (Google prodkernel only have zswap). Has\nsomething changed?\n\n---\n\nThis just motivates me to pushback even harder on adding a new interface\nwithout a clear use-case.\n\n---\n\nI already asked above but let me say it again. What's the actual real\nworld use-case to control/allow/disallow swap devices hierarchically?\n\n---\n\nHaving more than one swap devices to reduce lock contention is unrelated\nto hierarchically control swap devices among sub-workloads.",
          "reply_to": "Chris Li",
          "message_date": "2026-02-21"
        }
      ],
      "analysis_source": "llm-per-reviewer"
    },
    "2026-02-22": {
      "report_file": "2026-02-21_ollama_llama3.1-8b.html",
      "developer": "Shakeel Butt",
      "reviews": [
        {
          "author": "YoungJun Park (author)",
          "summary": "Author is addressing Shakeel Butt's feedback about the BPF-first approach, specifically questioning its practicality and feasibility in an embedded environment where kernel compile options are costly. Author asks clarifying questions and expresses difficulty understanding the motivation behind this approach.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "author is asking for clarification",
            "author is expressing skepticism"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "....\n\nAfter reading the reply and re-think more of it.\n\nI have a few questions regarding the BPF-first approach you\nsuggested, if you don't mind. Some of them I am re-asking\nbecause I feel they have not been clearly addressed yet.\n\n- We are in an embedded environment where enabling additional\n  kernel compile options is costly. BPF is disabled by\n  default in some of our production configurations. From a\n  trade-off perspective, does it make sense to enable BPF\n  just for swap device control?\n\n- You suggest starting with BPF and discussing a stable\n  interface later. I am genuinely curious, are there actual\n  precedents where a BPF prototype graduated into a stable\n  kernel interface? \n\n- You raised that stable interfaces are hard to remove. Would\n  gating it behind a CONFIG option or marking it experimental\n  be an acceptable compromise?\n\n- You already acknowledged the use-case for assigning\n  different swap devices to different workloads. Your\n  objection is specifically about hierarchical parent-child\n  partitioning. If the interface enforced uniform policy\n  within a subtree, would that be acceptable?\n\n- We already run a modified kernel with internal swap control\n  in production and have real feedback from it. Requiring BPF\n  as a prerequisite to gather production experience seems\n  unnecessary when we are already doing that.\n\nTo be honest, I am having trouble understanding the motivation\nbehind the BPF-first validation approach. If the real point is\nthat BPF enables more flexible swap-out policies than any fixed\ninterface can, that would make much more sense to me. I would\nappreciate it if you could share more on this.\n\nThanks,\nYoungjun Park",
          "reply_to": "Shakeel Butt",
          "message_date": "2026-02-22"
        },
        {
          "author": "Shakeel Butt",
          "summary": "Reviewer noted that the patch does not handle the case where a child cgroup re-enables a tier with '+' that was excluded by its parent, and requested clarification on how this is handled.\n\nReviewer Shakeel Butt requested additional information about the cgroup hierarchy structure of Youngjun Park's deployment, specifically asking if they use cgroup v1 or v2 in their production environment.\n\nReviewer Shakeel Butt questioned whether the proposed swap tiers concept is identical to existing swap priority behavior and requested clarification on this point.\n\nReviewer Shakeel Butt suggested that the patch should not be committed without first brainstorming all options and gathering their pros and cons, requesting an informed decision.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "requested clarification",
            "handling of tier selection",
            "request for clarification",
            "lack of technical disagreement",
            "requested changes"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "Hi YoungJun,\n\nI see you have sent a separate email on BPF specific questions to which I will\nrespond separately, here I will respond to other questions/comments.\n\nOn Sat, Feb 21, 2026 at 11:30:59PM +0900, YoungJun Park wrote:\n\n---\n\nIf you don't mind, can you share a bit more about the cgroup hierarchy structure\nof your deployment. Do you use cgroup v1 or v2 on your production environment?\n\n---\n\nI assume this is the same swap priorities as of today, right? You want similar\npriority behavior within a tier.\n\n---\n\nI think your use-case is very clear. Before committing to any options, I want us\nto brainstorm all options and gather pros/cons and then make an informed\ndecision. Anyways I will respond to your other email (in a day or two).\n\nShakeel",
          "reply_to": "YoungJun Park",
          "message_date": "2026-02-22"
        }
      ],
      "analysis_source": "llm-per-reviewer"
    }
  }
}
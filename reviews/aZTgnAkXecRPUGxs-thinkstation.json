{
  "thread_id": "aZTgnAkXecRPUGxs@thinkstation",
  "subject": "Re: [PATCH] mm: Add AnonZero accounting for zero-filled anonymous pages",
  "url": "https://lore.kernel.org/all/aZTgnAkXecRPUGxs@thinkstation/",
  "dates": {
    "2026-02-17": {
      "report_file": "2026-02-17_ollama_llama3.1-8b.html",
      "developer": "Kiryl Shutsemau",
      "reviews": [
        {
          "author": "Kiryl Shutsemau",
          "summary": "Reviewer Kiryl Shutsemau expressed concerns that the patch will slow down /proc/pid/smaps reads and proposed a more scalable solution using a syscall to return memory stats in binary form.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "performance concern",
            "scalability issue"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "On Sat, Feb 14, 2026 at 04:45:14PM +0800, Wenchao Hao wrote:\n> Add kernel command line option \"count_zero_page\" to track anonymous pages\n> have been allocated and mapped to userspace but zero-filled.\n> \n> This feature is mainly used to debug large folio mechanism, which\n> pre-allocates and map more pages than actually needed, leading to memory\n> waste from unaccessed pages.\n> \n> Export the result in /proc/pid/smaps as \"AnonZero\" field.\n\nI expect it to slowdown /proc/pid/smaps read substantially. I don't\nthink this line in smaps worth it.\n\n-- \n  Kiryl Shutsemau / Kirill A. Shutemov\n\n\n---\n\nOn Mon, Feb 16, 2026 at 12:45:13PM +0100, David Hildenbrand (Arm) wrote:\n> On 2/16/26 12:34, Kiryl Shutsemau wrote:\n> > On Sat, Feb 14, 2026 at 04:45:14PM +0800, Wenchao Hao wrote:\n> > > Add kernel command line option \"count_zero_page\" to track anonymous pages\n> > > have been allocated and mapped to userspace but zero-filled.\n> > > \n> > > This feature is mainly used to debug large folio mechanism, which\n> > > pre-allocates and map more pages than actually needed, leading to memory\n> > > waste from unaccessed pages.\n> > > \n> > > Export the result in /proc/pid/smaps as \"AnonZero\" field.\n> > \n> > I expect it to slowdown /proc/pid/smaps read substantially. I don't\n> > think this line in smaps worth it.\n> > \n> \n> That's why it's enabled through a command line parameter.\n\nOne users want the stat and all users on the machine pay the price?\nThat's a poor trade off.\n\nIn general, smaps scales poorly. It collects a lot of stats and most of\nthem are ignored by user. We need something like statx(2) where user can\ndeclare what he is interested in, so kernel won't waste cycles.\n\nKernel cmdline parameter is the wrong place to declare what stats you\nwant to see.\n\n-- \n  Kiryl Shutsemau / Kirill A. Shutemov\n\n\n---\n\nOn Mon, Feb 16, 2026 at 11:59:50PM +0800, Wenchao Hao wrote:\n> On Mon, Feb 16, 2026 at 7:58\\u202fPM Kiryl Shutsemau <kirill@shutemov.name> wrote:\n> >\n> > On Mon, Feb 16, 2026 at 12:45:13PM +0100, David Hildenbrand (Arm) wrote:\n> > > On 2/16/26 12:34, Kiryl Shutsemau wrote:\n> > > > On Sat, Feb 14, 2026 at 04:45:14PM +0800, Wenchao Hao wrote:\n> > > > > Add kernel command line option \"count_zero_page\" to track anonymous pages\n> > > > > have been allocated and mapped to userspace but zero-filled.\n> > > > >\n> > > > > This feature is mainly used to debug large folio mechanism, which\n> > > > > pre-allocates and map more pages than actually needed, leading to memory\n> > > > > waste from unaccessed pages.\n> > > > >\n> > > > > Export the result in /proc/pid/smaps as \"AnonZero\" field.\n> > > >\n> > > > I expect it to slowdown /proc/pid/smaps read substantially. I don't\n> > > > think this line in smaps worth it.\n> > > >\n> > >\n> > > That's why it's enabled through a command line parameter.\n> >\n> > One users want the stat and all users on the machine pay the price?\n> > That's a poor trade off.\n> >\n> > In general, smaps scales poorly. It collects a lot of stats and most of\n> > them are ignored by user. We need something like statx(2) where user can\n> > declare what he is interested in, so kernel won't waste cycles.\n> >\n> \n> I initially considered two approaches:\n> \n> First, exposing the needed information via smaps. This does incur some\n> performance cost but is the simplest to implement. The new feature can be\n> dynamically toggled via a command-line parameter. When disabled, the\n> overhead is negligible\\u2014only a minor if check, which is insignificant compared\n> to the full smaps cost.\n> \n> Second, adding a new system call or extending madvise with a new command\n> like MADV_GET_ZEROANON. Userspace tools can then use it to measure\n> memory waste from zero-filled anonymous huge pages.\n> \n> This is slightly more complex but minimizes system impact: environments that\n> don\\u2019t care about zero-filled anonymous pages pay zero overhead when the\n> command is not used.\n> \n> The exact implementation approach can be discussed after we confirm whether\n> the upstream kernel needs this debugging feature.\n\nWhat I would like to see in the kernel is a syscall that return the\nmemory stats in binary form. Something like\n\nsize_t memstat(int pidfd, struct memstat memstatbuf[], size_t n,\n\t\tunsigned long flags, unsigned long start, unsigned long end);\n\nThe syscall will fill up to n memstatbufs, one per-VMA. What exactly\nfilled there defined by flags. The return value is how many memstatbuf\nis populated. The caller can call it multiple times to walk address\nspace it is interested in.\n\nWe also can have a flag that mirrors smaps_rollup behaviour and collect\nall the data into a single memstatbuf.\n\nInternally, the kernel can use the infrastructure built for this syscall\nto provide /proc/<PID>/{maps,smaps,smaps_rollup}. This way we will not\nduplicate the code.\n\n-- \n  Kiryl Shutsemau / Kirill A. Shutemov\n\n\n---\n\nOn Mon, Feb 16, 2026 at 05:01:51PM +0000, Matthew Wilcox wrote:\n> On Mon, Feb 16, 2026 at 04:54:05PM +0000, Kiryl Shutsemau wrote:\n> > What I would like to see in the kernel is a syscall that return the\n> > memory stats in binary form. Something like\n> > \n> > size_t memstat(int pidfd, struct memstat memstatbuf[], size_t n,\n> > \t\tunsigned long flags, unsigned long start, unsigned long end);\n> > \n> > The syscall will fill up to n memstatbufs, one per-VMA. What exactly\n> > filled there defined by flags. The return value is how many memstatbuf\n> > is populated. The caller can call it multiple times to walk address\n> > space it is interested in.\n> > \n> > We also can have a flag that mirrors smaps_rollup behaviour and collect\n> > all the data into a single memstatbuf.\n> \n> But is that what we want?  Let's say a process allocates a 2MB THP, uses\n> 12kB of it and then forks.  A lot.  Now all children that haven't called\n> exec() see the wasted 2036kB.  Would we rather have something that scans\n> (say) the LRU list looking for zero memory?\n\nAre describing THP shrinker? :)\n\nI don't particular care about original poster use-case. I want to see\nmore scalable way to access memory statistic information in general.\nsmaps is slow, because it collects information user doesn't care about.\n\n-- \n  Kiryl Shutsemau / Kirill A. Shutemov\n"
        },
        {
          "author": "David (Arm)",
          "summary": "Reviewer David (Arm) raised concerns about the patch's design and functionality, questioning its usefulness beyond debugging and suggesting alternative approaches such as providing a system call for filtering specific stats or using a file-based solution.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "requested changes",
            "alternative approaches"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "On 2/16/26 12:34, Kiryl Shutsemau wrote:\n> On Sat, Feb 14, 2026 at 04:45:14PM +0800, Wenchao Hao wrote:\n>> Add kernel command line option \"count_zero_page\" to track anonymous pages\n>> have been allocated and mapped to userspace but zero-filled.\n>>\n>> This feature is mainly used to debug large folio mechanism, which\n>> pre-allocates and map more pages than actually needed, leading to memory\n>> waste from unaccessed pages.\n>>\n>> Export the result in /proc/pid/smaps as \"AnonZero\" field.\n> \n> I expect it to slowdown /proc/pid/smaps read substantially. I don't\n> think this line in smaps worth it.\n> \n\nThat's why it's enabled through a command line parameter.\n\n-- \nCheers,\n\nDavid\n\n\n---\n\nOn 2/14/26 09:45, Wenchao Hao wrote:\n> Add kernel command line option \"count_zero_page\" to track anonymous pages\n> have been allocated and mapped to userspace but zero-filled.\n\n\"count_zero_page\" is rather sub-optimal parameter name. \"anonzero_in_smaps\" or sth like that?\n\nStill wondering if there could be a better way to enable this dynamically.\n\nIn particular, not using a core parameter.\n\nIf you use a module parameter, you can just set on the cmdline\n\n\tproc.anonzero_in_smaps=1\n\nAnd dynamically set/observe it in\n\n\t/sys/module/proc/parameters/anonzero_in_smaps\n\n\ndiff --git a/fs/proc/task_mmu.c b/fs/proc/task_mmu.c\nindex d7d52e259055..0301b9cd28f8 100644\n--- a/fs/proc/task_mmu.c\n+++ b/fs/proc/task_mmu.c\n@@ -34,6 +34,10 @@\n  \n  #define SEQ_PUT_DEC(str, val) \\\n                 seq_put_decimal_ull_width(m, str, (val) << (PAGE_SHIFT-10), 8)\n+\n+static bool anonzero_in_smaps;\n+module_param(anonzero_in_smaps, bool, 0644);\n+\n  void task_mem(struct seq_file *m, struct mm_struct *mm)\n  {\n         unsigned long text, lib, swap, anon, file, shmem;\n\n\n> \n> This feature is mainly used to debug large folio mechanism, which\n> pre-allocates and map more pages than actually needed, leading to memory\n> waste from unaccessed pages.\n> \n> Export the result in /proc/pid/smaps as \"AnonZero\" field.\n> \n> Link: https://lore.kernel.org/linux-mm/20260210043456.2137482-1-haowenchao22@gmail.com/\n> Signed-off-by: Wenchao Hao <haowenchao22@gmail.com>\n> ---\n>   Documentation/filesystems/proc.rst |  5 +++++\n>   fs/proc/task_mmu.c                 | 10 ++++++++++\n>   2 files changed, 15 insertions(+)\n> \n> diff --git a/Documentation/filesystems/proc.rst b/Documentation/filesystems/proc.rst\n> index b0c0d1b45b99..573c8b015e39 100644\n> --- a/Documentation/filesystems/proc.rst\n> +++ b/Documentation/filesystems/proc.rst\n> @@ -545,6 +545,11 @@ replaced by copy-on-write) part of the underlying shmem object out on swap.\n>   does not take into account swapped out page of underlying shmem objects.\n>   \"Locked\" indicates whether the mapping is locked in memory or not.\n>   \n> +\"AnonZero\" shows the size of anonymous pages that have never been accessed\n> +after mapping, and it can reflect the memory waste caused by huge pages.\n\nThat's not correct. They could be read/written, but with zeroes.\n\n> +Implemented by scanning the size of zero-filled pages of the VMA. It\n> +is default disabled, and enabled via cmdline param \"count_zero_page=true\".\n\nProbably best to keep it simpler:\n\n\"AnonZero\" shows the size of anonymous pages that contain zeroes. Zero-filled\npages can indicate memory waste caused by memory-overallocation with (m)THPs.\nAvailability is controlled through XYZ.\n\n-- \nCheers,\n\nDavid\n\n\n---\n\nOn 2/16/26 12:58, Kiryl Shutsemau wrote:\n> On Mon, Feb 16, 2026 at 12:45:13PM +0100, David Hildenbrand (Arm) wrote:\n>> On 2/16/26 12:34, Kiryl Shutsemau wrote:\n>>>\n>>> I expect it to slowdown /proc/pid/smaps read substantially. I don't\n>>> think this line in smaps worth it.\n>>>\n>>\n>> That's why it's enabled through a command line parameter.\n> \n> One users want the stat and all users on the machine pay the price?\n> That's a poor trade off.\n> \n\nIt's a debug mechanism as stated in the patch description.\n\nSimilar to CONFIG_DEBUG_VM slowing your machine down.\n\n> In general, smaps scales poorly. It collects a lot of stats and most of\n> them are ignored by user. We need something like statx(2) where user can\n> declare what he is interested in, so kernel won't waste cycles.\n> \n> Kernel cmdline parameter is the wrong place to declare what stats you\n> want to see.\n\nIf you have a good idea, please shoot. I proposed using module parameter \nthat\ncan get toggled more easily by the admin that debugs something.\n\nIt's a good question of someone would want to use this mechanism not \njust for debugging. Then, indeed, a more selective (per-process) toggle \ncould be warranted. But likely the scanning would in any case be too \nexpensive for any non-debug case.\n\nSo let's not over-engineer a debug mechanism if this is intended to stay \na debug mechanism.\n\n-- \nCheers,\n\nDavid\n\n\n---\n\nOn 2/16/26 16:10, Wenchao Hao wrote:\n> On Mon, Feb 16, 2026 at 8:15\\u202fPM David Hildenbrand (Arm)\n> <david@kernel.org> wrote:\n>>\n>> On 2/14/26 09:45, Wenchao Hao wrote:\n>>> Add kernel command line option \"count_zero_page\" to track anonymous pages\n>>> have been allocated and mapped to userspace but zero-filled.\n>>\n>> \"count_zero_page\" is rather sub-optimal parameter name. \"anonzero_in_smaps\" or sth like that?\n>>\n> Your naming suggestion is indeed better than mine. If this patch is still needed\n> for further development, I will modify it according to your advice.\n> \n>> Still wondering if there could be a better way to enable this dynamically.\n>>\n>> In particular, not using a core parameter.\n>>\n>> If you use a module parameter, you can just set on the cmdline\n>>\n>>          proc.anonzero_in_smaps=1\n>>\n>> And dynamically set/observe it in\n>>\n>>          /sys/module/proc/parameters/anonzero_in_smaps\n>>\n> Regarding the use of module parameters versus core_param, I think\n> either approach is ok.\n> Currently, the core_param I'm using also supports two modification methods:\n> \n> 1. Command line parameter: count_zero_page=Y\n> 2. After system boot, view or modify it via\n> /sys/module/kernel/parameters/count_zero_page\n> \n> It is true that this modification would be more appropriately placed\n> in the proc module,\n> which aligns with your earlier suggestion.\n> \n> If there is a possibility of further iteration on this change, I will\n> move it to the proc module instead\n> of using a core_param\n> \n>>>\n>>> This feature is mainly used to debug large folio mechanism, which\n>>> pre-allocates and map more pages than actually needed, leading to memory\n>>> waste from unaccessed pages.\n>>>\n>>> Export the result in /proc/pid/smaps as \"AnonZero\" field.\n>>>\n>>> Link: https://lore.kernel.org/linux-mm/20260210043456.2137482-1-haowenchao22@gmail.com/\n>>> Signed-off-by: Wenchao Hao <haowenchao22@gmail.com>\n>>> ---\n>>>    Documentation/filesystems/proc.rst |  5 +++++\n>>>    fs/proc/task_mmu.c                 | 10 ++++++++++\n>>>    2 files changed, 15 insertions(+)\n>>>\n>>> diff --git a/Documentation/filesystems/proc.rst b/Documentation/filesystems/proc.rst\n>>> index b0c0d1b45b99..573c8b015e39 100644\n>>> --- a/Documentation/filesystems/proc.rst\n>>> +++ b/Documentation/filesystems/proc.rst\n>>> @@ -545,6 +545,11 @@ replaced by copy-on-write) part of the underlying shmem object out on swap.\n>>>    does not take into account swapped out page of underlying shmem objects.\n>>>    \"Locked\" indicates whether the mapping is locked in memory or not.\n>>>\n>>> +\"AnonZero\" shows the size of anonymous pages that have never been accessed\n>>> +after mapping, and it can reflect the memory waste caused by huge pages.\n>>\n>> That's not correct. They could be read/written, but with zeroes.\n>>\n>>> +Implemented by scanning the size of zero-filled pages of the VMA. It\n>>> +is default disabled, and enabled via cmdline param \"count_zero_page=true\".\n>>\n>> Probably best to keep it simpler:\n>>\n>> \"AnonZero\" shows the size of anonymous pages that contain zeroes. Zero-filled\n>> pages can indicate memory waste caused by memory-overallocation with (m)THPs.\n>> Availability is controlled through XYZ.\n>>\n> As with your earlier suggestion, if this change is to be iterated on\n> further, I will update it according\n> to your suggestion.\n\nLet's wait first for other opinions. Willy doesn't seem to like it if \nthere is no use case besides for limited experiments where you could \njust use the OOT patch, possibly.\n\n-- \nCheers,\n\nDavid\n\n\n---\n\nOn 2/16/26 17:42, Michal Hocko wrote:\n> On Mon 16-02-26 23:59:50, Wenchao Hao wrote:\n>> On Mon, Feb 16, 2026 at 7:58\\u202fPM Kiryl Shutsemau <kirill@shutemov.name> wrote:\n>>>\n>>>\n>>> One users want the stat and all users on the machine pay the price?\n>>> That's a poor trade off.\n>>>\n>>> In general, smaps scales poorly. It collects a lot of stats and most of\n>>> them are ignored by user. We need something like statx(2) where user can\n>>> declare what he is interested in, so kernel won't waste cycles.\n>>>\n>>\n>> I initially considered two approaches:\n>>\n>> First, exposing the needed information via smaps. This does incur some\n>> performance cost but is the simplest to implement. The new feature can be\n>> dynamically toggled via a command-line parameter. When disabled, the\n>> overhead is negligible\\u2014only a minor if check, which is insignificant compared\n>> to the full smaps cost.\n> \n> You are comparing content of all anon pages, aren't you? Depending on\n> the content this can add a lot of overhead.\n> \n>> Second, adding a new system call or extending madvise with a new command\n>> like MADV_GET_ZEROANON. Userspace tools can then use it to measure\n>> memory waste from zero-filled anonymous huge pages.\n> \n> MADV_GET_ZEROPAGE would make more sense to me. But a more fundamental\n> question is whether this metric is really what you want long term.\n> Kernel can do all sorts of optimizations behind userspace back - e.g.\n> map shared zero page - so just learning that a process has a lot of\n> pages filled up with zeroes doesn't tell you all that much. Or does it?\n\nIf a sysadmin wants to see where THP hurt (zero-filled pages), surely \nMADV_GET_ZEROPAGE is the wrong (ugly) interface.\n\nAll we want are per-process stats. What am I missing?\n\n\nKSM could deduplicate them, the deferred shrinker could remove them. \nUnless both mechanisms are not desired or are ineffective for another \nreason (e.g., page pinning).\n\n-- \nCheers,\n\nDavid\n\n\n---\n\nOn 2/16/26 18:01, Matthew Wilcox wrote:\n> On Mon, Feb 16, 2026 at 04:54:05PM +0000, Kiryl Shutsemau wrote:\n>> What I would like to see in the kernel is a syscall that return the\n>> memory stats in binary form. Something like\n>>\n>> size_t memstat(int pidfd, struct memstat memstatbuf[], size_t n,\n>> \t\tunsigned long flags, unsigned long start, unsigned long end);\n>>\n>> The syscall will fill up to n memstatbufs, one per-VMA. What exactly\n>> filled there defined by flags. The return value is how many memstatbuf\n>> is populated. The caller can call it multiple times to walk address\n>> space it is interested in.\n>>\n>> We also can have a flag that mirrors smaps_rollup behaviour and collect\n>> all the data into a single memstatbuf.\n> \n> But is that what we want?  Let's say a process allocates a 2MB THP, uses\n> 12kB of it and then forks.\nThat's just like all of these entries (Rss, Anonymous, KSM) except the \nPss ones behave.\n\n-- \nCheers,\n\nDavid\n\n\n---\n\nOn 2/16/26 18:10, Michal Hocko wrote:\n> On Mon 16-02-26 17:56:12, David Hildenbrand wrote:\n>> On 2/16/26 17:42, Michal Hocko wrote:\n>>>\n>>> You are comparing content of all anon pages, aren't you? Depending on\n>>> the content this can add a lot of overhead.\n>>>\n>>>\n>>> MADV_GET_ZEROPAGE would make more sense to me. But a more fundamental\n>>> question is whether this metric is really what you want long term.\n>>> Kernel can do all sorts of optimizations behind userspace back - e.g.\n>>> map shared zero page - so just learning that a process has a lot of\n>>> pages filled up with zeroes doesn't tell you all that much. Or does it?\n>>\n>> If a sysadmin wants to see where THP hurt (zero-filled pages), surely\n>> MADV_GET_ZEROPAGE is the wrong (ugly) interface.\n> \n> The question is whether sysadmin should really ask questions like that.\n> Without a deeper understanding of the workload the answer could be\n> misleading at best, no matter what interface is available.\n\nGiven the requests for per-process control of THPs I assume some \nsysadmins (at hyperscalers :) ) really care about the relevant processes \nand even the relevant memory areas (e.g., jmalloc area).\n\n> \n> If you know and understand the workload you already know that THP is not\n> a good fit and you do not need to ask about that. If you want to\n> understand whether your particular workload has a big internal\n> fragmentation due to THPs then MADV_GET_ZEROPAGE sounds like a\n> reasonable fit to me.\n\nYou could also just scan the pages yourself for 0-content, or what's the \nbenefit of letting the kernel do that?\n\n> \n>  From a sysadmin POV you care about the overall memory consuption, right?\n\nI'm not so sure about that.\n\n-- \nCheers,\n\nDavid\n\n\n---\n\nOn 2/17/26 16:22, Wenchao Hao wrote:\n> On Sat, Feb 14, 2026 at 4:45\\u202fPM Wenchao Hao <haowenchao22@gmail.com> wrote:\n>>\n>> Add kernel command line option \"count_zero_page\" to track anonymous pages\n>> have been allocated and mapped to userspace but zero-filled.\n>>\n>> This feature is mainly used to debug large folio mechanism, which\n>> pre-allocates and map more pages than actually needed, leading to memory\n>> waste from unaccessed pages.\n>>\n>> Export the result in /proc/pid/smaps as \"AnonZero\" field.\n>>\n>> Link: https://lore.kernel.org/linux-mm/20260210043456.2137482-1-haowenchao22@gmail.com/\n> \n> Sorry for the late reply. We are now on Chinese New Year holiday, so...\n> \n> The original goal of this patch is to measure memory waste from anonymous\n> THPs - pages pre-allocated on fault but never accessed.\n> \n> On memory-sensitive devices like mobile phones, this helps us make better\n> decisions about when and how to enable THP. I think this is useful for\n> guiding THP policies, even as a debugging feature.\n> \n> Let me summarize the discussion so far:\n> - Matthew Wilcox questioned the value and raised concerns fork but haven't\n>    exec path\n> - Michal Hocko criticized the inefficiency of scanning zero-filled pages.\n> - Kiryl Shutsemau prefers a system-call-based interface.\n> - David Hildenbrand acknowledged the value and suggested implementation\n>    improvements.\n> Please correct me if I missed or misrepresented anything.\n> \n> I suggest we first agree whether this functionality is useful for upstream,\n> before discussing implementation details.\n> \n> Reasons why this should go upstream from me:\n> \n> - Anonymous THP can introduce real memory waste, but we currently have no\n>    good way to measure it.\n> - With accurate metrics, we can make better THP policy: disable for\n>    low-utilization cases, or early-unmap to relieve memory pressure and so\n>    on. This is especially valuable for mobile/embedded devices.\n> \n> Possible implementations:\n> \n> 1. A new smaps counter (default-off) to count zero-filled pages.\n> 2. A new madvise command like MADV_GET_ZEROPAGE\n> 3. A dedicated system call\n\nI understand Kiyls point about smaps providing too much information \nusers might not be interested in already. So sorting that out might \nprovide a real benefit to other users that are only interested in \nspecific stats (e.g., Rss).\n\nProviding a system call where one can specify/filter in theory sounds \nlike a good idea. A syscall implies that one has to write a tool to \nobtain these metrics.\n\nThe nice thing about smaps/smaps_rollup is that it can be easily \nconsumed on any system while debugging.\n\nI wonder if there could be a way to achieve something similar with a \nfile. Likely not, but maybe someone reading along can surprise me :)\n\nOtherwise we'd have to go with a tool.\n\n-- \nCheers,\n\nDavid\n"
        },
        {
          "author": "Matthew Wilcox",
          "summary": "Reviewer Matthew Wilcox expressed strong disagreement and skepticism about the patch's usefulness, questioning its purpose and suggesting alternative approaches to tracking memory waste.",
          "sentiment": "contentious",
          "sentiment_signals": [
            "strong disagreement",
            "skeptical"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "On Sat, Feb 14, 2026 at 04:45:14PM +0800, Wenchao Hao wrote:\n> Add kernel command line option \"count_zero_page\" to track anonymous pages\n> have been allocated and mapped to userspace but zero-filled.\n> \n> This feature is mainly used to debug large folio mechanism, which\n> pre-allocates and map more pages than actually needed, leading to memory\n> waste from unaccessed pages.\n\nWhy are you trying to get this upstream when you admitted in an earlier\nemail this is just for your internal use?\n\nWhy do you think that \"unaccessed pages\" are the only, or even the\nlargest source of extra memory consumption?  The vast majority of files\nare never mmaped.\n\nThis just seems like a giant waste of time.\n\n\n---\n\nOn Mon, Feb 16, 2026 at 04:54:05PM +0000, Kiryl Shutsemau wrote:\n> What I would like to see in the kernel is a syscall that return the\n> memory stats in binary form. Something like\n> \n> size_t memstat(int pidfd, struct memstat memstatbuf[], size_t n,\n> \t\tunsigned long flags, unsigned long start, unsigned long end);\n> \n> The syscall will fill up to n memstatbufs, one per-VMA. What exactly\n> filled there defined by flags. The return value is how many memstatbuf\n> is populated. The caller can call it multiple times to walk address\n> space it is interested in.\n> \n> We also can have a flag that mirrors smaps_rollup behaviour and collect\n> all the data into a single memstatbuf.\n\nBut is that what we want?  Let's say a process allocates a 2MB THP, uses\n12kB of it and then forks.  A lot.  Now all children that haven't called\nexec() see the wasted 2036kB.  Would we rather have something that scans\n(say) the LRU list looking for zero memory?\n\n\n---\n\nOn Sat, Feb 14, 2026 at 04:45:14PM +0800, Wenchao Hao wrote:\n> +\t\tif (count_zero_page && pages_identical(page, ZERO_PAGE(0)))\n\nPretty sure you want memchr_inv() here?\n"
        },
        {
          "author": "Wenchao Hao (author)",
          "summary": "The reviewer, Wenchao Hao, discussed the usefulness of the patch for measuring memory waste from anonymous THPs and proposed three possible implementations: a new smaps counter, a new madvise command, or a dedicated system call.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "NEEDS_WORK",
            "POSITIVE"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "On Mon, Feb 16, 2026 at 8:15 PM David Hildenbrand (Arm)\n<david@kernel.org> wrote:\n>\n> On 2/14/26 09:45, Wenchao Hao wrote:\n> > Add kernel command line option \"count_zero_page\" to track anonymous pages\n> > have been allocated and mapped to userspace but zero-filled.\n>\n> \"count_zero_page\" is rather sub-optimal parameter name. \"anonzero_in_smaps\" or sth like that?\n>\nYour naming suggestion is indeed better than mine. If this patch is still needed\nfor further development, I will modify it according to your advice.\n\n> Still wondering if there could be a better way to enable this dynamically.\n>\n> In particular, not using a core parameter.\n>\n> If you use a module parameter, you can just set on the cmdline\n>\n>         proc.anonzero_in_smaps=1\n>\n> And dynamically set/observe it in\n>\n>         /sys/module/proc/parameters/anonzero_in_smaps\n>\nRegarding the use of module parameters versus core_param, I think\neither approach is ok.\nCurrently, the core_param I'm using also supports two modification methods:\n\n1. Command line parameter: count_zero_page=Y\n2. After system boot, view or modify it via\n/sys/module/kernel/parameters/count_zero_page\n\nIt is true that this modification would be more appropriately placed\nin the proc module,\nwhich aligns with your earlier suggestion.\n\nIf there is a possibility of further iteration on this change, I will\nmove it to the proc module instead\nof using a core_param\n\n> >\n> > This feature is mainly used to debug large folio mechanism, which\n> > pre-allocates and map more pages than actually needed, leading to memory\n> > waste from unaccessed pages.\n> >\n> > Export the result in /proc/pid/smaps as \"AnonZero\" field.\n> >\n> > Link: https://lore.kernel.org/linux-mm/20260210043456.2137482-1-haowenchao22@gmail.com/\n> > Signed-off-by: Wenchao Hao <haowenchao22@gmail.com>\n> > ---\n> >   Documentation/filesystems/proc.rst |  5 +++++\n> >   fs/proc/task_mmu.c                 | 10 ++++++++++\n> >   2 files changed, 15 insertions(+)\n> >\n> > diff --git a/Documentation/filesystems/proc.rst b/Documentation/filesystems/proc.rst\n> > index b0c0d1b45b99..573c8b015e39 100644\n> > --- a/Documentation/filesystems/proc.rst\n> > +++ b/Documentation/filesystems/proc.rst\n> > @@ -545,6 +545,11 @@ replaced by copy-on-write) part of the underlying shmem object out on swap.\n> >   does not take into account swapped out page of underlying shmem objects.\n> >   \"Locked\" indicates whether the mapping is locked in memory or not.\n> >\n> > +\"AnonZero\" shows the size of anonymous pages that have never been accessed\n> > +after mapping, and it can reflect the memory waste caused by huge pages.\n>\n> That's not correct. They could be read/written, but with zeroes.\n>\n> > +Implemented by scanning the size of zero-filled pages of the VMA. It\n> > +is default disabled, and enabled via cmdline param \"count_zero_page=true\".\n>\n> Probably best to keep it simpler:\n>\n> \"AnonZero\" shows the size of anonymous pages that contain zeroes. Zero-filled\n> pages can indicate memory waste caused by memory-overallocation with (m)THPs.\n> Availability is controlled through XYZ.\n>\nAs with your earlier suggestion, if this change is to be iterated on\nfurther, I will update it according\nto your suggestion.\n\nThanks.\n\n> --\n> Cheers,\n>\n> David\n\n\n---\n\nOn Mon, Feb 16, 2026 at 10:23 PM Matthew Wilcox <willy@infradead.org> wrote:\n>\n> On Sat, Feb 14, 2026 at 04:45:14PM +0800, Wenchao Hao wrote:\n> > Add kernel command line option \"count_zero_page\" to track anonymous pages\n> > have been allocated and mapped to userspace but zero-filled.\n> >\n> > This feature is mainly used to debug large folio mechanism, which\n> > pre-allocates and map more pages than actually needed, leading to memory\n> > waste from unaccessed pages.\n>\n> Why are you trying to get this upstream when you admitted in an earlier\n> email this is just for your internal use?\n>\n\nI see this as a debugging feature, not limited to internal use only.\n\nOur real goal is to gain more precise visibility into how system memory is used.\nA basic requirement is to measure the memory overhead caused by anonymous\nhugepages that have been pre-allocated but never accessed.\nWith this information, we can implement various policies:\n - Allocate only 4K pages for applications that suffer severe memory waste from\n   anonymous hugepages.\n- Evaluate per-process hugepage waste during low system load and proactively\n   split hugepages accordingly.\n\nSo I believe this debugging feature still provides value when merged upstream.\nCurrently, there is no effective way to account for memory waste from\npre-allocated\nbut unused anonymous hugepages, and this feature fills that gap. Or do you have\nany suggestions about how to get this info?\n\n> Why do you think that \"unaccessed pages\" are the only, or even the\n> largest source of extra memory consumption?  The vast majority of files\n> are never mmaped.\n>\n\nIn my view, memory waste from anonymous hugepages is less acceptable than that\nfrom file pages.\n\nAlthough file pages may also be unmapped, a cache hit can still reduce\nI/O overhead.\nBy contrast, pre-allocated anonymous hugepages that are never accessed represent\npure waste.\n\nFurthermore, the total number of unmapped file pages can already be\nestimated from\n/proc/meminfo, so we can already apply policies to control file page waste.\n\n>From my research, many memory-sensitive environments already apply\nspecial policies\nfor file pages—for example, the RFC patch from vivo that manages\nreadahead file pages\nseparately:\nhttps://lore.kernel.org/linux-mm/20250916072226.220426-1-liulei.rjpt@vivo.com/\n\nBut file page waste is not the main point I want to focus on here.\n\nThanks.\n\n\n---\n\nOn Mon, Feb 16, 2026 at 7:58 PM Kiryl Shutsemau <kirill@shutemov.name> wrote:\n>\n> On Mon, Feb 16, 2026 at 12:45:13PM +0100, David Hildenbrand (Arm) wrote:\n> > On 2/16/26 12:34, Kiryl Shutsemau wrote:\n> > > On Sat, Feb 14, 2026 at 04:45:14PM +0800, Wenchao Hao wrote:\n> > > > Add kernel command line option \"count_zero_page\" to track anonymous pages\n> > > > have been allocated and mapped to userspace but zero-filled.\n> > > >\n> > > > This feature is mainly used to debug large folio mechanism, which\n> > > > pre-allocates and map more pages than actually needed, leading to memory\n> > > > waste from unaccessed pages.\n> > > >\n> > > > Export the result in /proc/pid/smaps as \"AnonZero\" field.\n> > >\n> > > I expect it to slowdown /proc/pid/smaps read substantially. I don't\n> > > think this line in smaps worth it.\n> > >\n> >\n> > That's why it's enabled through a command line parameter.\n>\n> One users want the stat and all users on the machine pay the price?\n> That's a poor trade off.\n>\n> In general, smaps scales poorly. It collects a lot of stats and most of\n> them are ignored by user. We need something like statx(2) where user can\n> declare what he is interested in, so kernel won't waste cycles.\n>\n\nI initially considered two approaches:\n\nFirst, exposing the needed information via smaps. This does incur some\nperformance cost but is the simplest to implement. The new feature can be\ndynamically toggled via a command-line parameter. When disabled, the\noverhead is negligible—only a minor if check, which is insignificant compared\nto the full smaps cost.\n\nSecond, adding a new system call or extending madvise with a new command\nlike MADV_GET_ZEROANON. Userspace tools can then use it to measure\nmemory waste from zero-filled anonymous huge pages.\n\nThis is slightly more complex but minimizes system impact: environments that\ndon’t care about zero-filled anonymous pages pay zero overhead when the\ncommand is not used.\n\nThe exact implementation approach can be discussed after we confirm whether\nthe upstream kernel needs this debugging feature.\n\nThanks.\n\n> Kernel cmdline parameter is the wrong place to declare what stats you\n> want to see.\n>\n> --\n>   Kiryl Shutsemau / Kirill A. Shutemov\n\n\n---\n\nOn Sat, Feb 14, 2026 at 4:45 PM Wenchao Hao <haowenchao22@gmail.com> wrote:\n>\n> Add kernel command line option \"count_zero_page\" to track anonymous pages\n> have been allocated and mapped to userspace but zero-filled.\n>\n> This feature is mainly used to debug large folio mechanism, which\n> pre-allocates and map more pages than actually needed, leading to memory\n> waste from unaccessed pages.\n>\n> Export the result in /proc/pid/smaps as \"AnonZero\" field.\n>\n> Link: https://lore.kernel.org/linux-mm/20260210043456.2137482-1-haowenchao22@gmail.com/\n\nSorry for the late reply. We are now on Chinese New Year holiday, so...\n\nThe original goal of this patch is to measure memory waste from anonymous\nTHPs - pages pre-allocated on fault but never accessed.\n\nOn memory-sensitive devices like mobile phones, this helps us make better\ndecisions about when and how to enable THP. I think this is useful for\nguiding THP policies, even as a debugging feature.\n\nLet me summarize the discussion so far:\n- Matthew Wilcox questioned the value and raised concerns fork but haven't\n  exec path\n- Michal Hocko criticized the inefficiency of scanning zero-filled pages.\n- Kiryl Shutsemau prefers a system-call-based interface.\n- David Hildenbrand acknowledged the value and suggested implementation\n  improvements.\nPlease correct me if I missed or misrepresented anything.\n\nI suggest we first agree whether this functionality is useful for upstream,\nbefore discussing implementation details.\n\nReasons why this should go upstream from me:\n\n- Anonymous THP can introduce real memory waste, but we currently have no\n  good way to measure it.\n- With accurate metrics, we can make better THP policy: disable for\n  low-utilization cases, or early-unmap to relieve memory pressure and so\n  on. This is especially valuable for mobile/embedded devices.\n\nPossible implementations:\n\n1. A new smaps counter (default-off) to count zero-filled pages.\n2. A new madvise command like MADV_GET_ZEROPAGE\n3. A dedicated system call\n\nI welcome feedback on whether this is useful, and any better approaches.\n\nThank you.\n"
        },
        {
          "author": "Michal Hocko",
          "summary": "Reviewer Michal Hocko raised concerns about the overhead of tracking zero-filled anonymous pages and suggested alternative approaches such as using MADV_GET_ZEROPAGE or a high-level compression interface.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "overhead",
            "alternative approaches"
          ],
          "has_inline_review": true,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "On Mon 16-02-26 23:59:50, Wenchao Hao wrote:\n> On Mon, Feb 16, 2026 at 7:58\\u202fPM Kiryl Shutsemau <kirill@shutemov.name> wrote:\n> >\n> > On Mon, Feb 16, 2026 at 12:45:13PM +0100, David Hildenbrand (Arm) wrote:\n> > > On 2/16/26 12:34, Kiryl Shutsemau wrote:\n> > > > On Sat, Feb 14, 2026 at 04:45:14PM +0800, Wenchao Hao wrote:\n> > > > > Add kernel command line option \"count_zero_page\" to track anonymous pages\n> > > > > have been allocated and mapped to userspace but zero-filled.\n> > > > >\n> > > > > This feature is mainly used to debug large folio mechanism, which\n> > > > > pre-allocates and map more pages than actually needed, leading to memory\n> > > > > waste from unaccessed pages.\n> > > > >\n> > > > > Export the result in /proc/pid/smaps as \"AnonZero\" field.\n> > > >\n> > > > I expect it to slowdown /proc/pid/smaps read substantially. I don't\n> > > > think this line in smaps worth it.\n> > > >\n> > >\n> > > That's why it's enabled through a command line parameter.\n> >\n> > One users want the stat and all users on the machine pay the price?\n> > That's a poor trade off.\n> >\n> > In general, smaps scales poorly. It collects a lot of stats and most of\n> > them are ignored by user. We need something like statx(2) where user can\n> > declare what he is interested in, so kernel won't waste cycles.\n> >\n> \n> I initially considered two approaches:\n> \n> First, exposing the needed information via smaps. This does incur some\n> performance cost but is the simplest to implement. The new feature can be\n> dynamically toggled via a command-line parameter. When disabled, the\n> overhead is negligible\\u2014only a minor if check, which is insignificant compared\n> to the full smaps cost.\n\nYou are comparing content of all anon pages, aren't you? Depending on\nthe content this can add a lot of overhead.\n\n> Second, adding a new system call or extending madvise with a new command\n> like MADV_GET_ZEROANON. Userspace tools can then use it to measure\n> memory waste from zero-filled anonymous huge pages.\n\nMADV_GET_ZEROPAGE would make more sense to me. But a more fundamental\nquestion is whether this metric is really what you want long term.\nKernel can do all sorts of optimizations behind userspace back - e.g.\nmap shared zero page - so just learning that a process has a lot of\npages filled up with zeroes doesn't tell you all that much. Or does it?\n\nAlso think about what do you do with those numbers. Any action performed\nlater is inherently racy. Aren't you really looking for something like\nMADV_COMPACT or maybe even MADV_COMPRESS?\n-- \nMichal Hocko\nSUSE Labs\n\n\n---\n\nOn Mon 16-02-26 17:56:12, David Hildenbrand wrote:\n> On 2/16/26 17:42, Michal Hocko wrote:\n> > On Mon 16-02-26 23:59:50, Wenchao Hao wrote:\n> > > On Mon, Feb 16, 2026 at 7:58\\u202fPM Kiryl Shutsemau <kirill@shutemov.name> wrote:\n> > > > \n> > > > \n> > > > One users want the stat and all users on the machine pay the price?\n> > > > That's a poor trade off.\n> > > > \n> > > > In general, smaps scales poorly. It collects a lot of stats and most of\n> > > > them are ignored by user. We need something like statx(2) where user can\n> > > > declare what he is interested in, so kernel won't waste cycles.\n> > > > \n> > > \n> > > I initially considered two approaches:\n> > > \n> > > First, exposing the needed information via smaps. This does incur some\n> > > performance cost but is the simplest to implement. The new feature can be\n> > > dynamically toggled via a command-line parameter. When disabled, the\n> > > overhead is negligible\\u2014only a minor if check, which is insignificant compared\n> > > to the full smaps cost.\n> > \n> > You are comparing content of all anon pages, aren't you? Depending on\n> > the content this can add a lot of overhead.\n> > \n> > > Second, adding a new system call or extending madvise with a new command\n> > > like MADV_GET_ZEROANON. Userspace tools can then use it to measure\n> > > memory waste from zero-filled anonymous huge pages.\n> > \n> > MADV_GET_ZEROPAGE would make more sense to me. But a more fundamental\n> > question is whether this metric is really what you want long term.\n> > Kernel can do all sorts of optimizations behind userspace back - e.g.\n> > map shared zero page - so just learning that a process has a lot of\n> > pages filled up with zeroes doesn't tell you all that much. Or does it?\n> \n> If a sysadmin wants to see where THP hurt (zero-filled pages), surely\n> MADV_GET_ZEROPAGE is the wrong (ugly) interface.\n\nThe question is whether sysadmin should really ask questions like that.\nWithout a deeper understanding of the workload the answer could be\nmisleading at best, no matter what interface is available.\n\nIf you know and understand the workload you already know that THP is not\na good fit and you do not need to ask about that. If you want to\nunderstand whether your particular workload has a big internal\nfragmentation due to THPs then MADV_GET_ZEROPAGE sounds like a\nreasonable fit to me.\n\n>From a sysadmin POV you care about the overall memory consuption, right?\nAnd for that I believe you need some sort of high level compression or\nsimilar interface.\n\n-- \nMichal Hocko\nSUSE Labs\n\n\n---\n\nOn Tue 17-02-26 23:22:20, Wenchao Hao wrote:\n> On Sat, Feb 14, 2026 at 4:45\\u202fPM Wenchao Hao <haowenchao22@gmail.com> wrote:\n> >\n> > Add kernel command line option \"count_zero_page\" to track anonymous pages\n> > have been allocated and mapped to userspace but zero-filled.\n> >\n> > This feature is mainly used to debug large folio mechanism, which\n> > pre-allocates and map more pages than actually needed, leading to memory\n> > waste from unaccessed pages.\n> >\n> > Export the result in /proc/pid/smaps as \"AnonZero\" field.\n> >\n> > Link: https://lore.kernel.org/linux-mm/20260210043456.2137482-1-haowenchao22@gmail.com/\n> \n> Sorry for the late reply. We are now on Chinese New Year holiday, so...\n> \n> The original goal of this patch is to measure memory waste from anonymous\n> THPs - pages pre-allocated on fault but never accessed.\n\nI believe you wanted to say \"but never modified\". Unless you map THP\nthrough ptes you have simply do not have that information. Reading\nzeroes might be just what your workload needs (e.g. large sparce data\nstructures).\n\n> On memory-sensitive devices like mobile phones, this helps us make better\n> decisions about when and how to enable THP. I think this is useful for\n> guiding THP policies, even as a debugging feature.\n> \n> Let me summarize the discussion so far:\n> - Matthew Wilcox questioned the value and raised concerns fork but haven't\n>   exec path\n> - Michal Hocko criticized the inefficiency of scanning zero-filled pages.\n\nLet me clarify. I am not objecting the inefficiency. _If_ you need to\nrecognize zero content then there are no ways around. I have merely\nmentioned that the overhead is not negligible for /proc/<pid>/smaps as\nyou suggested.\n\n> - Kiryl Shutsemau prefers a system-call-based interface.\n> - David Hildenbrand acknowledged the value and suggested implementation\n>   improvements.\n> Please correct me if I missed or misrepresented anything.\n> \n> I suggest we first agree whether this functionality is useful for upstream,\n> before discussing implementation details.\n\nCompletely agreed!\n\n> Reasons why this should go upstream from me:\n> \n> - Anonymous THP can introduce real memory waste, but we currently have no\n>   good way to measure it.\n> - With accurate metrics, we can make better THP policy: disable for\n>   low-utilization cases, or early-unmap to relieve memory pressure and so\n>   on. This is especially valuable for mobile/embedded devices.\n\nWhile I agree with your first point I am not so sure about the second.\nYou can easily run the same workload with and without THP enabled and\ncompare the rss to learn about a typical internal fragmentation (there\nare several layers of precision you can influence - only for process,\nmadvise...). This is a very crude estimate but it gives you some\npicture. Is it convenient. Not at all but likely sufficient if you are\ndebugging a reproducible workload. \n\nSo I would start by explaining why this crude approach is not really\nfeasible. You are talking about early-unmap. How exactly do you envision\nthis to be done? I mean finding zero pages is one thing but how do you\nmake any educated guess that that particular sparsely used page needs to\nbe broken down and partially unmapped. What kind of interface do you\nwant to use for that? MADV_FREE for all zero subranges?\n-- \nMichal Hocko\nSUSE Labs\n\n"
        },
        {
          "author": "Kiryl Shutsemau",
          "summary": "Reviewer suggested that the patch could be improved by providing a tool for users to easily access and analyze the AnonZero data, possibly by integrating it into util-linux.",
          "sentiment": "needs_work",
          "sentiment_signals": [
            "requested changes"
          ],
          "has_inline_review": false,
          "tags_given": [
            "Reviewed-by"
          ],
          "analysis_source": "llm",
          "raw_body": "On Tue, Feb 17, 2026 at 09:29:02PM +0100, David Hildenbrand (Arm) wrote:\n> On 2/17/26 16:22, Wenchao Hao wrote:\n> > On Sat, Feb 14, 2026 at 4:45\\u202fPM Wenchao Hao <haowenchao22@gmail.com> wrote:\n> > > \n> > > Add kernel command line option \"count_zero_page\" to track anonymous pages\n> > > have been allocated and mapped to userspace but zero-filled.\n> > > \n> > > This feature is mainly used to debug large folio mechanism, which\n> > > pre-allocates and map more pages than actually needed, leading to memory\n> > > waste from unaccessed pages.\n> > > \n> > > Export the result in /proc/pid/smaps as \"AnonZero\" field.\n> > > \n> > > Link: https://lore.kernel.org/linux-mm/20260210043456.2137482-1-haowenchao22@gmail.com/\n> > \n> > Sorry for the late reply. We are now on Chinese New Year holiday, so...\n> > \n> > The original goal of this patch is to measure memory waste from anonymous\n> > THPs - pages pre-allocated on fault but never accessed.\n> > \n> > On memory-sensitive devices like mobile phones, this helps us make better\n> > decisions about when and how to enable THP. I think this is useful for\n> > guiding THP policies, even as a debugging feature.\n> > \n> > Let me summarize the discussion so far:\n> > - Matthew Wilcox questioned the value and raised concerns fork but haven't\n> >    exec path\n> > - Michal Hocko criticized the inefficiency of scanning zero-filled pages.\n> > - Kiryl Shutsemau prefers a system-call-based interface.\n> > - David Hildenbrand acknowledged the value and suggested implementation\n> >    improvements.\n> > Please correct me if I missed or misrepresented anything.\n> > \n> > I suggest we first agree whether this functionality is useful for upstream,\n> > before discussing implementation details.\n> > \n> > Reasons why this should go upstream from me:\n> > \n> > - Anonymous THP can introduce real memory waste, but we currently have no\n> >    good way to measure it.\n> > - With accurate metrics, we can make better THP policy: disable for\n> >    low-utilization cases, or early-unmap to relieve memory pressure and so\n> >    on. This is especially valuable for mobile/embedded devices.\n> > \n> > Possible implementations:\n> > \n> > 1. A new smaps counter (default-off) to count zero-filled pages.\n> > 2. A new madvise command like MADV_GET_ZEROPAGE\n> > 3. A dedicated system call\n> \n> I understand Kiyls point about smaps providing too much information users\n> might not be interested in already. So sorting that out might provide a real\n> benefit to other users that are only interested in specific stats (e.g.,\n> Rss).\n\nYou can also limit the range of virtual address space you want to look\nat.\n\n> Providing a system call where one can specify/filter in theory sounds like a\n> good idea. A syscall implies that one has to write a tool to obtain these\n> metrics.\n> \n> The nice thing about smaps/smaps_rollup is that it can be easily consumed on\n> any system while debugging.\n> \n> I wonder if there could be a way to achieve something similar with a file.\n> Likely not, but maybe someone reading along can surprise me :)\n\nI guess you can open a file write to it what you want to get and then\nread. It is awkward from shell to keep file descriptor around, but doable.\n\n> Otherwise we'd have to go with a tool.\n\nA tool might be more ergonomic.\n\nTo minimize friction, it would be nice to put the tool into util-linux\n(or whatever trendy Rust-rewrite called), so it would find its way to\nevery machine. Eventually.\n\n-- \n  Kiryl Shutsemau / Kirill A. Shutemov\n"
        }
      ],
      "analysis_source": "llm-per-reviewer"
    }
  }
}
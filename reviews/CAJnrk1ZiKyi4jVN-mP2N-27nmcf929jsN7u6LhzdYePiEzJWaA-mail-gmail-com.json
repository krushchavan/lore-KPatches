{
  "thread_id": "CAJnrk1ZiKyi4jVN=mP2N-27nmcf929jsN7u6LhzdYePiEzJWaA@mail.gmail.com",
  "subject": "[PATCH v6 3/3] fuse: add an implementation of open+getattr",
  "url": "https://lore.kernel.org/all/CAJnrk1ZiKyi4jVN=mP2N-27nmcf929jsN7u6LhzdYePiEzJWaA@mail.gmail.com/",
  "dates": {
    "2026-02-27": {
      "report_file": "2026-02-27_ollama_llama3.1-8b.html",
      "developer": "Joanne Koong",
      "reviews": [
        {
          "author": "Joanne Koong",
          "summary": "Identified a potential issue with the current implementation and suggested an alternative approach to improve efficiency.",
          "sentiment": "neutral",
          "sentiment_signals": [
            "NEEDS_WORK"
          ],
          "has_inline_review": false,
          "tags_given": [],
          "analysis_source": "llm",
          "raw_body": "On Fri, Feb 27, 2026 at 9:51 AM Joanne Koong <joannelkoong@gmail.com> wrote:\n>\n> On Thu, Feb 26, 2026 at 11:48 PM Horst Birthelmer <horst@birthelmer.de> wrote:\n> >\n> > On Thu, Feb 26, 2026 at 11:12:00AM -0800, Joanne Koong wrote:\n> > > On Thu, Feb 26, 2026 at 8:43 AM Horst Birthelmer <horst@birthelmer.com> wrote:\n> > > >\n> > > > From: Horst Birthelmer <hbirthelmer@ddn.com>\n> > > >\n> > > > The discussion about compound commands in fuse was\n> > > > started over an argument to add a new operation that\n> > > > will open a file and return its attributes in the same operation.\n> > > >\n> > > > Here is a demonstration of that use case with compound commands.\n> > > >\n> > > > Signed-off-by: Horst Birthelmer <hbirthelmer@ddn.com>\n> > > > ---\n> > > >  fs/fuse/file.c   | 111 +++++++++++++++++++++++++++++++++++++++++++++++--------\n> > > >  fs/fuse/fuse_i.h |   4 +-\n> > > >  fs/fuse/ioctl.c  |   2 +-\n> > > >  3 files changed, 99 insertions(+), 18 deletions(-)\n> > > >\n> > > > diff --git a/fs/fuse/file.c b/fs/fuse/file.c\n> > > > index a408a9668abbb361e2c1e386ebab9dfcb0a7a573..daa95a640c311fc393241bdf727e00a2bc714f35 100644\n> > > > --- a/fs/fuse/file.c\n> > > > +++ b/fs/fuse/file.c\n> > > >  struct fuse_file *fuse_file_open(struct fuse_mount *fm, u64 nodeid,\n> > > > -                                unsigned int open_flags, bool isdir)\n> > > > +                               struct inode *inode,\n> > >\n> > > As I understand it, now every open() is a opengetattr() (except for\n> > > the ioctl path) but is this the desired behavior? for example if there\n> > > was a previous FUSE_LOOKUP that was just done, doesn't this mean\n> > > there's no getattr that's needed since the lookup refreshed the attrs?\n> > > or if the server has reasonable entry_valid and attr_valid timeouts,\n> > > multiple opens() of the same file would only need to send FUSE_OPEN\n> > > and not the FUSE_GETATTR, no?\n> >\n> > So your concern is, that we send too many requests?\n> > If the fuse server implwments the compound that is not the case.\n> >\n>\n> My concern is that we're adding unnecessary overhead for every open\n> when in most cases, the attributes are already uptodate. I don't think\n> we can assume that the server always has attributes locally cached, so\n> imo the extra getattr is nontrivial (eg might require having to\n> stat()).\n\nLooking at where the attribute valid time gets set... it looks like\nthis gets stored in fi->i_time (as per\nfuse_change_attributes_common()), so maybe it's better to only send\nthe compound open+getattr if time_before64(fi->i_time,\nget_jiffies_64()) is true, otherwise only the open is needed. This\ndoesn't solve the O_APPEND data corruption bug seen in [1] but imo\nthis would be a more preferable way of doing it.\n\nThanks,\nJoanne\n\n[1] https://lore.kernel.org/linux-fsdevel/20240813212149.1909627-1-joannelkoong@gmail.com/\n\n>\n> Thanks,\n> Joanne\n\n",
          "reply_to": "",
          "message_date": "2026-02-27",
          "message_id": ""
        }
      ],
      "analysis_source": "llm",
      "patch_summary": "Joanne suggested a more efficient way to handle compound open+getattr by checking if the attribute valid time is before the current time, and only sending the compound operation if true."
    }
  }
}